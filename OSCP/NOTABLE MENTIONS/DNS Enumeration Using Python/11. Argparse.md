After determining that our script works properly, we can extend our code step by step and add more features. With the tool "dig," we have already seen that we can already define specific arguments in the terminal and pass them to the program. To avoid changing the code frequently, we can add the same function to our script and use it again when we need to. To include this function, we can use and import the standard module `argparse`.

Next, we define the arguments with the desired names in the Main function that our script should take from the terminal. It is highly recommended to test our script immediately if we have added anything new. Because if we add dozens of code lines with different dependencies and functions that affect others, it can significantly increase debugging time.

#### DNS-AXFR.py

Code: python

```python
<SNIP>
# Main
if __name__ == "__main__":

    # ArgParser - Define usage
    parser = argparse.ArgumentParser(prog="dns-axfr.py", epilog="DNS Zonetransfer Script", usage="dns-axfr.py [options] -d <DOMAIN>", prefix_chars='-', add_help=True)

<SNIP>
```

The passed arguments to the class `argparse` for the function "`ArgumentParser`" are "`prog`", "`usage`", "`prefix_chars`" and "`add_help`". The argument "`prog`" stands for the name of the script, which is then displayed in the help function ("`add_help`") with the usage example ("`usage`") if an argument is missing. The arguments are prefixed with the "`prefix_chars`" and are included in the script.

After initializing the parser, we can define the corresponding parameters, which we will define with our script's respective options. For this, we use the `add_argument()` method of the `ArgumentParser`. This method provides us with some parameters that we can use to define the option.

|**Parameter**|**Description**|
|---|---|
|[name or flag](https://docs.python.org/3/library/argparse.html#name-or-flags)|Either a name or a list of option strings.|
|[action](https://docs.python.org/3/library/argparse.html#action)|The basic type of action to be taken when this argument is encountered at the command line.|
|[nargs](https://docs.python.org/3/library/argparse.html#nargs)|The number of command-line arguments that should be consumed.|
|[const](https://docs.python.org/3/library/argparse.html#const)|A constant value required by some `action` and `nargs` selections.|
|[default](https://docs.python.org/3/library/argparse.html#default)|The value produced if the argument is absent from the command line.|
|[type](https://docs.python.org/3/library/argparse.html#type)|The type to which the command-line argument should be converted.|
|[choices](https://docs.python.org/3/library/argparse.html#choices)|A container of the allowable values for the argument.|
|[required](https://docs.python.org/3/library/argparse.html#required)|Whether or not the command-line option may be omitted (optionals only).|
|[help](https://docs.python.org/3/library/argparse.html#help)|A brief description of what the argument does.|
|[metavar](https://docs.python.org/3/library/argparse.html#metavar)|A name for the argument in usage messages.|
|[dest](https://docs.python.org/3/library/argparse.html#dest)|The name of the attribute to be added to the object returned by `parse_args()`.|

Source : [https://docs.python.org/3/library/argparse.html#the-add-argument-method](https://docs.python.org/3/library/argparse.html#the-add-argument-method)

Next, we define the target `domain` parameters and the `nameservers` on which we want to test the zone transfer. Since we can create another function later, which finds out the `nameservers` for the corresponding domain by itself, we define only the `domain` specification as `required`. Additionally, we add the script `version` to track later which version of the script we are using or editing. Finally, we assign the given arguments in the variable `args`.

#### DNS-AXFR.py

Code: python

```python
<SNIP>
# Main
if __name__ == "__main__":

    # ArgParser - Define usage
    parser = argparse.ArgumentParser(prog="dns-axfr.py", epilog="DNS Zonetransfer Script", usage="dns-axfr.py [options] -d <DOMAIN>", prefix_chars='-', add_help=True)
	
	# Positional Arguments
    parser.add_argument('-d', action='store', metavar='Domain', type=str, help='Target Domain.\tExample: inlanefreight.htb', required=True)
    parser.add_argument('-n', action='store', metavar='Nameserver', type=str, help='Nameservers separated by a comma.\tExample: ns1.inlanefreight.htb,ns2.inlanefreight.htb')
    parser.add_argument('-v', action='version', version='DNS-AXFR - v1.0', help='Prints the version of DNS-AXFR.py')

    # Assign given arguments
    args = parser.parse_args()

<SNIP>
```

Since we have replaced and extended the static definition of variables using `argparse`, we can remove the variable `domain` and `NS.nameservers` from the beginning of the script and adjust them in the `main`. To do this, we take the parameter `d` from the stored arguments in `args` ( = `args.d`), which stands for the variable `Domain`, and assign the passed argument to it.

The `NS.nameservers` variable can have several arguments, which we will separate with a comma (`,`). Therefore we create a `list`, which contains the arguments from `args.n` (nameservers) and separate them using the comma (`,`), if available.

#### DNS-AXFR.py

Code: python

```python
<SNIP>
# Main
if __name__ == "__main__":

    # ArgParser - Define usage
    parser = argparse.ArgumentParser(prog="dns-axfr.py", epilog="DNS Zonetransfer Script", usage="dns-axfr.py [options] -d <DOMAIN>", prefix_chars='-', add_help=True)
	
	# Positional Arguments
    parser.add_argument('-d', action='store', metavar='Domain', type=str, help='Target Domain.\tExample: inlanefreight.htb', required=True)
    parser.add_argument('-n', action='store', metavar='Nameserver', type=str, help='Nameservers separated by a comma.\tExample: ns1.inlanefreight.htb,ns2.inlanefreight.htb')
    parser.add_argument('-v', action='version', version='DNS-AXFR - v1.0', help='Prints the version of DNS-AXFR.py')

    # Assign given arguments
    args = parser.parse_args()

    # Variables
    Domain = args.d
    NS.nameservers = list(args.n.split(","))

    # Check if URL is given
    if not args.d:
        print('[!] You must specify target Domain.\n')
        print(parser.print_help())
        exit()

    if not args.n:
        print('[!] You must specify target nameservers.\n')
        print(parser.print_help())
        exit()

<SNIP>
```

The complete code would look like this.

#### DNS-AXFR.py - Complete Code

Code: python

```python
#!/usr/bin/env python3

# Dependencies:
# python3-dnspython

# Used Modules:
import dns.zone as dz
import dns.query as dq
import dns.resolver as dr
import argparse

# Initialize Resolver-Class from dns.resolver as "NS"
NS = dr.Resolver()

# List of found subdomains
Subdomains = []

# Define the AXFR Function
def AXFR(domain, nameserver):

    # Try zone transfer for given domain and namerserver
    try:
        # Perform the zone transfer
        axfr = dz.from_xfr(dq.xfr(nameserver, domain))

        # If zone transfer was successful
        if axfr:
            print('[*] Successful Zone Transfer from {}'.format(nameserver))

            # Add found subdomains to global 'Subdomain' list
            for record in axfr:
                Subdomains.append('{}.{}'.format(record.to_text(), domain))

    # If zone transfer fails
    except Exception as error:
        print(error)
        pass

# Main
if __name__ == "__main__":

    # ArgParser - Define usage
    parser = argparse.ArgumentParser(prog="dns-axfr.py", epilog="DNS Zonetransfer Script", usage="dns-axfr.py [options] -d <DOMAIN>", prefix_chars='-', add_help=True)

    # Positional Arguments
    parser.add_argument('-d', action='store', metavar='Domain', type=str, help='Target Domain.\tExample: inlanefreight.htb', required=True)
    parser.add_argument('-n', action='store', metavar='Nameserver', type=str, help='Nameservers separated by a comma.\tExample: ns1.inlanefreight.htb,ns2.inlanefreight.htb')
    parser.add_argument('-v', action='version', version='DNS-AXFR - v1.0', help='Prints the version of DNS-AXFR.py')

    # Assign given arguments
    args = parser.parse_args()

    # Variables
    Domain = args.d
    NS.nameservers = list(args.n.split(","))

    # Check if URL is given
    if not args.d:
        print('[!] You must specify target Domain.\n')
        print(parser.print_help())
        exit()

    if not args.n:
        print('[!] You must specify target nameservers.\n')
        print(parser.print_help())
        exit()

    # For each nameserver
    for nameserver in NS.nameservers:

        # Try AXFR
        AXFR(Domain, nameserver)

    # Print the results
    if Subdomains is not None:
        print('-------- Found Subdomains:')

        # Print each subdomain
        for subdomain in Subdomains:
            print('{}'.format(subdomain))

    else:
        print('No subdomains found.')
        exit()
```

First of all, we can give this script the appropriate privileges necessary to run it independently. If we now execute this script without passing the needed arguments, we get an error, which tells us which arguments are necessary.

#### DNS-AXFR.py - Execution without arguments

  Argparse

```shell-session
frodonomojo@htb[/htb]$ chmod +x dns-axfr.py
frodonomojo@htb[/htb]$ ./dns-axfr.py

usage: dns-axfr.py [options] -d <DOMAIN>
dns-axfr.py: error: the following arguments are required: -d
```

So when we test if we have set everything and do not give the script any arguments, we should get the error message as we expected. Next, we can check the `help` function by using "`-h`" as an argument.

#### DNS-AXFR.py - Help Message

  Argparse

```shell-session
frodonomojo@htb[/htb]$ ./dns-axfr.py -h

usage: dns-axfr.py [options] -d <DOMAIN>

optional arguments:
  -h, --help     show this help message and exit
  -d Domain      Target Domain. Example: inlanefreight.htb
  -n Nameserver  Nameservers separated by a comma. Example:
                 ns1.inlanefreight.htb,ns2.inlanefreight.htb
  -v             Prints the version of DNS-AXFR.py

DNS Zonetransfer Script
```

Now we can also check if the `version` for this script is displayed as desired.

#### DNS-AXFR.py - Version

  Argparse

```shell-session
frodonomojo@htb[/htb]$ ./dns-axfr.py -v

DNS-AXFR - v1.0
```

After we have verified that our script works, we can deploy it and test it on our target domain. In this example, our target domain is "inlanefreight.com."

#### DNS-AXFR.py - Example

  Argparse

```shell-session
frodonomojo@htb[/htb]$ ./dns-axfr.py -d inlanefreight.com -n ns1.inlanefreight.com,ns2.inlanefreight.com

[*] Successful Zone Transfer from ns1.inlanefreight.com
[*] Successful Zone Transfer from ns2.inlanefreight.com
-------- Found Subdomains:
adm.inlanefreight.com
blog.inlanefreight.com
wlan.inlanefreight.com
afdc0102.inlanefreight.com
autodiscover.inlanefreight.com
kfdcex07.inlanefreight.com
<SNIP>
```

**Credit:** This information was adapted from an excellent guide on [HTB Academy](https://academy.hackthebox.com/course/preview/dns-enumeration-using-python). Be sure to check out the original post for more details.

