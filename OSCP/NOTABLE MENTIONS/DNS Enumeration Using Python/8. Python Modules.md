Before we start coding our tool, we have to determine which modules we need and which are best suited for it. A quick search on Google will bring us to the module called "[dnspython](https://dnspython.readthedocs.io/en/latest/)". Our goal is to perform a zone transfer, and accordingly, we need to find the appropriate classes and functions to communicate with the DNS servers. Another extension that we can use to develop such tools with Python 3 is [IPython](https://ipython.org/install.html). It supports auto-completion and shows the different options in the corresponding classes and modules in an interactive Python shell.

After we have installed the module, we can import it. This module offers us the classes `Query`, `Resolver`, and `Zone`. The `dns.zone` module contains a "`from_xfr`" class. We can find this out by using the `help()` function in Python.

#### Python Help()

  Python Modules

```shell-session
frodonomojo@htb[/htb]$ ipython

In [1]: import dns.zone as dz

In [2]: help(dz.  #[1x Tab]

                 BadZone       dns           from_text()   generators    NoSOA         PY3           string_types  text_type     Zone
                 BytesIO       from_file()   from_xfr()    NoNS          os            re            sys           UnknownOrigin
```

#### Dns.Zone.From_XFR()

  Python Modules

```shell-session
In [2]: help(dz.from_xfr) 
```

#### From_XFR() - Documentation

  Python Modules

```shell-session
from_xfr(xfr, zone_factory=<class 'dns.zone.Zone'>, relativize=True, check_origin=True)
    Convert the output of a zone transfer generator into a zone object.

    @param xfr: The xfr generator
    @type xfr: generator of dns.message.Message objects
    @param relativize: should names be relativized?  The default is True.
    It is essential that the relativize setting matches the one specified
    to dns.query.xfr().
    @type relativize: bool
    @param check_origin: should sanity checks of the origin node be done?
    The default is True.
    @type check_origin: bool
    @raises dns.zone.NoSOA: No SOA RR was found at the zone origin
    @raises dns.zone.NoNS: No NS RRset was found at the zone origin
    @rtype: dns.zone.Zone object
```

We can also find the documentation for this on the [documentation page](https://dnspython.readthedocs.io/en/latest/zone-make.html) that describes the required parameters for the `from_xfr()` function. From the parameter "`xfr`," we will also need the `dns.query` class. So we should also note this class for later use.

#### Notes

Code: python

```python
# Notes
import dns.zone as dz
import dns.query as dq

# axfr = dz.from_xfr(dq.xfr())
```

We need to take a closer look at the `dns.query.xfr()` function to determine which parameters are required.

#### Dns.Query.XFR()

  Python Modules

```shell-session
In [3]: help(dq.xfr) 
```

#### XFR() - Documentation

  Python Modules

```shell-session
Help on function xfr in module dns.query:

xfr(where, zone, rdtype=252, rdclass=1, timeout=None, port=53, keyring=None, keyname=None, relativize=True, af=None, lifetime=None, source=None, source_port=0, serial=0, use_udp=False, keyalgorithm=<DNS name HMAC-MD5.SIG-ALG.REG.INT.>)
    Return a generator for the responses to a zone transfer.

    *where*.  If the inference attempt fails, AF_INET is used.  This
    parameter is historical; you need never set it.
<SNIP>
```

Here we can see that only two variables have no value and therefore need specific parameters to perform this function.

- `where`
- `zone`

We can also find out the required parameters by executing the function. Because if we do not output any parameters, an error will occur with the description that says which parameters are needed.

#### Required Parameters

  Python Modules

```shell-session
In [4]: dq.xfr()

---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-14-672b143b8cfc> in <module>
----> 1 dq.xfr()

TypeError: xfr() missing 2 required positional arguments: 'where' and 'zone'
```

In this case, the variable "`where`" stands for the DNS server and the variable "`zone`" for the domain. We note this as well.

#### Notes

Code: python

```python
# Notes
import dns.zone as dz
import dns.query as dq

# axfr = dz.from_xfr(dq.xfr(nameserver, domain))
```

---

## DNS Requests

We have to find out how to resolve our requests by using specific DNS servers. The easiest way with the necessary class would be "`dns.resolver`". In the [documentation](https://dnspython.readthedocs.io/en/latest/resolver-class.html), we can find the class "`Resolver`" which allows us to specify the DNS servers we want to send our requests to. Of course, we can also automatically find these DNS servers, so we do not have to change them manually. Nevertheless, we have to be careful because companies often use DNS servers from third party providers for which we usually do not have the permissions to test them. Therefore, we recommend that we specify them manually and preferably in the command line rather than in our code. To make this possible, we import another module called "`argparse`". Accordingly, we also add this information to our notes.

#### Notes

Code: python

```python
# Notes
import dns.zone as dz
import dns.query as dq
import dns.resolver as dr
import argparse

# axfr = dz.from_xfr(dq.xfr(nameserver, domain))

# NS = dr.Resolver()
# NS.nameservers = ['ns1', 'ns2']
```

---

We now have to find the "NS" records for this domain, and instead of using the `dig` tool, we do it with our Python modules. In this example, we still use the domain called:

- `inlanefreight.com`

The corresponding NS servers we found by using the following code:

#### NS Records - DNS.Resolver

  Python Modules

```shell-session
frodonomojo@htb[/htb]$ python3

>>> import dns.resolver
>>> 
>>> nameservers = dns.resolver.query('inlanefreight.com', 'NS')
>>> for ns in nameservers:
...    	print('NS:', ns)
...
NS: ns1.inlanefreight.com.
NS: ns2.inlanefreight.com.
```

In summary, we have the following information now:

Code: python

```python
Domain = 'inlanefreight.com'
DNS Servers = ['ns1.inlanefreight.com', 'ns2.inlanefreight.com']
```

Now we can summarize all our information and write the first lines of our code.

#### DNS-AXFR.py

Code: python

```python
#!/usr/bin/env python3

# Dependencies:
# python3-dnspython

# Used Modules:
import dns.zone as dz
import dns.query as dq
import dns.resolver as dr
import argparse

# Initialize Resolver-Class from dns.resolver as "NS"
NS = dr.Resolver()

# Target domain
Domain = 'inlanefreight.com'

# Set the nameservers that will be used
NS.nameservers = ['ns1.inlanefreight.com', 'ns2.inlanefreight.com']

# List of found subdomains
Subdomains = []
```

**Credit:** This information was adapted from an excellent guide on [HTB Academy](https://academy.hackthebox.com/course/preview/dns-enumeration-using-python). Be sure to check out the original post for more details.

